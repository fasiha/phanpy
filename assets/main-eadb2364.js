import{a as W,s as gn,I as w,M as Mt,b as I,A as Pt,h as Fe,e as de,E as Be,c as Rt,L as H,d as bn,n as Dt,f as X,u as yn,g as Ut,i as it,j as ft,k as vt,l as Ce,T as Oe,m as Wt,o as qe,p as wn,q as yt,r as He,t as Ve,S as wt,v as je,w as ye,x as pt,y as mt,N as we,z as We,R as ve,B as vn,C as Sn,D as kn,F as xe,G as In,H as Ge,J as Tn,K as Yt,O as Cn,P as $e,Q as xn,U as Le,V as $n,W as Ln}from"./useTitle-af4239f1.js";import{h as C,_,p as z,o as t,k as $,M as zt,a as et,b as Ct,S as Rn,s as se,u as xt,F as ut,y as Ht,g as Mn,m as Re,c as lt,l as Me,d as Je,e as An,J as Dn,C as Ke,f as Ye,i as Xe,T as ie,I as oe,j as Ft,n as Bt,q as En,r as Nn,x as Se,t as Ze,v as _n,A as Pn,w as ee,z as Un,B as Ae,D as zn,R as le,E as at,G as Fn,H as Bn}from"./vendor-5ba15347.js";function ke({list:e,onClose:n}){const{masto:l}=W(),[c,s]=C("default"),o=!!e,r=_(),a=_(),u=_();z(()=>{o&&(r.current.value=e.title,a.current.value=e.repliesPolicy,u.current&&(u.current.checked=e.exclusive))},[o]);const h=gn("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})})," ",t("header",{children:t("h2",{children:o?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:i=>{i.preventDefault();const m=new FormData(i.target),p=m.get("title"),d=m.get("replies_policy"),f=m.get("exclusive")==="on";s("loading"),(async()=>{try{let g;o?g=await l.v1.lists.update(e.id,{title:p,replies_policy:d,exclusive:f}):g=await l.v1.lists.create({title:p,replies_policy:d,exclusive:f}),s("default"),n==null||n({state:"success",list:g})}catch{s("error"),alert(o?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:r,type:"text",id:"list-title",name:"title",required:!0,disabled:c==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:a,name:"replies_policy",required:!0,disabled:c==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),h&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:u,type:"checkbox",name:"exclusive",disabled:c==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:c==="loading",children:o?"Save":"Create"}),o&&t(Mt,{disabled:c==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{s("loading"),(async()=>{try{await l.v1.lists.remove(e.id),s("default"),n==null||n({state:"deleted"})}catch{s("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:c==="loading",children:"Delete…"})})]})]})})]})}const On=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],De={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"};function Qe({account:e,fetchAccount:n=()=>{},standalone:l,instance:c,authenticated:s}){const[o,r]=C("default"),a=typeof e=="string",[u,h]=C(a?null:e);z(()=>{if(!a){h(e);return}r("loading"),(async()=>{try{const D=await n();I.accounts[`${D.id}@${c}`]=D,h(D),r("default")}catch{h(null),r("error")}})()},[a,e,n]);const{acct:i,avatar:m,avatarStatic:p,bot:d,createdAt:f,displayName:g,emojis:y,fields:b,followersCount:T,followingCount:S,group:v,id:R,lastStatusAt:x,locked:L,note:A,statusesCount:Y,url:j,username:E}=u||{};let P=!1,{header:Q,headerStatic:G}=u||{};(!Q||/missing\.png$/.test(Q))&&m&&!/missing\.png$/.test(m)&&(Q=m,P=!0,p&&!/missing\.png$/.test(p)&&(G=p));const[U,J]=C([]);return t("div",{class:`account-container  ${o==="loading"?"skeleton":""}`,style:{"--header-color-1":U[0],"--header-color-2":U[1],"--header-color-3":U[2],"--header-color-4":U[3]},children:[o==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:e,target:"_blank",children:["Go to account page ",t(w,{icon:"external"})]})})]}),o==="loading"?t($,{children:[t("header",{children:t(Pt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"████████ ███████"}),t("p",{children:"███████████████ ███████████████"})]}),t("p",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]}),t("div",{children:"Joined ██"})]})]})]}):u&&t($,{children:[Q&&!/missing\.png$/.test(Q)&&t("img",{src:Q,alt:"",class:`header-banner ${P?"header-is-avatar":""}`,onError:D=>{D.target.crossOrigin?D.target.src!==G?D.target.src=G:(D.target.removeAttribute("crossorigin"),D.target.src=Q):D.target.src!==G?D.target.src=G:D.target.remove()},crossOrigin:"anonymous",onLoad:D=>{D.target.classList.add("loaded");try{const ct=document.createElement("canvas"),ot=ct.getContext("2d");ct.width=D.target.width,ct.height=D.target.height,ot.drawImage(D.target,0,0);const tt=10,Tt=[ot.getImageData(0,0,tt,tt).data,ot.getImageData(D.target.width-tt,0,tt,tt).data,ot.getImageData(0,D.target.height-tt,tt,tt).data,ot.getImageData(D.target.width-tt,D.target.height-tt,tt,tt).data].map(dt=>{let gt=0,It=0,St=0,O=0;for(let k=0;k<dt.length;k+=4)gt+=dt[k],It+=dt[k+1],St+=dt[k+2],O+=dt[k+3];const M=dt.length/4;return[gt/M,It/M,St/M,O/M]}).map(dt=>{const[gt,It,St,O]=Hn(dt);return`rgba(${gt}, ${It}, ${St}, ${O})`});J(Tt)}catch{}}}),t("header",{children:t(Pt,{account:u,instance:c,avatarSize:"xxxl",external:l,internal:!l})}),t("main",{tabIndex:"-1",children:[d&&t($,{children:t("span",{class:"tag",children:[t(w,{icon:"bot"})," Automated"]})}),v&&t($,{children:t("span",{class:"tag",children:[t(w,{icon:"group"})," Group"]})}),t("div",{class:"note",onClick:Fe({instance:c}),dangerouslySetInnerHTML:{__html:de(A,{emojis:y})}}),(b==null?void 0:b.length)>0&&t("div",{class:"profile-metadata",children:b.map(({name:D,value:ct,verifiedAt:ot},tt)=>t("div",{class:`profile-field ${ot?"profile-verified":""}`,children:[t("b",{children:[t(Be,{text:D,emojis:y})," ",!!ot&&t(w,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:de(ct,{emojis:y})}})]},D+tt))}),t("p",{class:"stats",children:[t("div",{children:[t("span",{title:T,children:Rt(T)})," ","Followers"]}),t("div",{class:"insignificant",children:[t("span",{title:S,children:Rt(S)})," ","Following",t("br",{})]}),l?t("div",{class:"insignificant",children:[t("span",{title:Y,children:Rt(Y)})," ","Posts"]}):t(H,{class:"insignificant",to:c?`/${c}/a/${R}`:`/a/${R}`,onClick:()=>{bn()},children:[t("span",{title:Y,children:Rt(Y)})," ","Posts"]}),!!f&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:f,children:Dt(f,{hideTime:!0})})]})]}),t(qn,{info:u,instance:c,authenticated:s})]})]})]})}function qn({info:e,instance:n,authenticated:l}){var O;if(!e)return null;const{masto:c,instance:s,authenticated:o}=W(),r=n===s,[a,u]=C("default"),[h,i]=C(null),[m,p]=C([]),{id:d,acct:f,url:g,username:y,locked:b,lastStatusAt:T,note:S,fields:v}=e,R=_(d),{following:x,showingReblogs:L,notifying:A,followedBy:Y,blocking:j,blockedBy:E,muting:P,mutingNotifications:Q,requested:G,domainBlocking:U,endorsed:J}=h||{},[D,ct]=C(null),[ot,tt]=C(!1);z(()=>{if(e){const M=X.session.get("currentAccount");let k;(async()=>{if(r&&l)k=d;else if(!r&&o){const K=e.acct.includes("@");try{const Z=await c.v2.search({q:K?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});Z.accounts.length&&(k=Z.accounts[0].id,ct(Z.accounts[0]))}catch{}}if(!k)return;if(M===k){tt(!0);return}R.current=k,u("loading"),p([]);const N=c.v1.accounts.fetchRelationships([k]),B=c.v1.accounts.fetchFamiliarFollowers(k);try{const K=await N;if(K.length){const Z=K[0];if(i(Z),!Z.following)try{const q=await B;p(q[0].accounts.slice(0,10))}catch{}}u("default")}catch{u("error")}})()}},[e,l]),z(()=>{e&&ot&&yn(e)},[e,ot]);const kt=a==="loading",Tt=_(null),[dt,gt]=C(!1),[It,St]=C(!1);return t($,{children:[t("div",{class:"common-followers shazam-container no-animation",hidden:!(m!=null&&m.length),children:t("div",{class:"shazam-container-inner",children:t("p",{children:["Followed by"," ",t("span",{class:"ib",children:m.map(M=>t("a",{href:M.url,rel:"noopener noreferrer",onClick:k=>{k.preventDefault(),I.showAccount={account:M,instance:n}},children:t(Ut,{url:M.avatarStatic,size:"l",alt:`${M.displayName} @${M.acct}`,squircle:M==null?void 0:M.bot})}))})]})})}),t("p",{class:"actions",children:[t("span",{children:[Y?t("span",{class:"tag",children:"Following you"}):T?t("small",{class:"insignificant",children:["Last post:"," ",Dt(T,{hideTime:!0})]}):t("span",{}),P&&t("span",{class:"tag danger",children:"Muted"}),j&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[t(zt,{instanceRef:Tt,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:M=>{var k,N;M.target===M.currentTarget&&((N=(k=Tt.current)==null?void 0:k.closeMenu)==null||N.call(k))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:kt,children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[o&&!ot&&t($,{children:[t(et,{onClick:()=>{I.showCompose={draftStatus:{status:`@${(D==null?void 0:D.acct)||f} `}}},children:[t(w,{icon:"at"}),t("span",{children:["Mention @",y]})]}),t(et,{onClick:()=>{gt(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate bio"})]}),x&&t(et,{onClick:()=>{St(!0)},children:[t(w,{icon:"list"}),t("span",{children:"Add/remove from Lists"})]}),t(Ct,{})]}),t(et,{href:g,target:"_blank",children:[t(w,{icon:"external"}),t("small",{class:"menu-double-lines",children:Vn(g)})]}),t("div",{class:"menu-horizontal",children:[t(et,{onClick:()=>{try{navigator.clipboard.writeText(g),it("Link copied")}catch{it("Unable to copy link")}},children:[t(w,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((O=navigator==null?void 0:navigator.canShare)==null?void 0:O.call(navigator,{url:g}))&&t(et,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!h&&t($,{children:[t(Ct,{}),P?t(et,{onClick:()=>{u("loading"),(async()=>{try{const M=await c.v1.accounts.unmute((D==null?void 0:D.id)||d);i(M),u("default"),it(`Unmuted @${y}`)}catch{u("error")}})()},children:[t(w,{icon:"unmute"}),t("span",{children:["Unmute @",y]})]}):t(Rn,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t($,{children:[t(w,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",y,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(w,{icon:"time"}),t(w,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:On.map(M=>t(et,{onClick:()=>{u("loading"),(async()=>{try{const k=await c.v1.accounts.mute((D==null?void 0:D.id)||d,{duration:M});i(k),u("default"),it(`Muted @${y} for ${De[M]}`)}catch{u("error"),it(`Unable to mute @${y}`)}})()},children:De[M]}))})}),t(Mt,{subMenu:!0,confirm:!j,confirmLabel:t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",y,"?"]})]}),menuItemClassName:"danger",onClick:()=>{u("loading"),(async()=>{try{if(j){const M=await c.v1.accounts.unblock((D==null?void 0:D.id)||d);i(M),u("default"),it(`Unblocked @${y}`)}else{const M=await c.v1.accounts.block((D==null?void 0:D.id)||d);i(M),u("default"),it(`Blocked @${y}`)}}catch{u("error"),j?it(`Unable to unblock @${y}`):it(`Unable to block @${y}`)}})()},children:j?t($,{children:[t(w,{icon:"unblock"}),t("span",{children:["Unblock @",y]})]}):t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",y,"…"]})]})})]})]}),!h&&a==="loading"&&t(ft,{abrupt:!0}),!!h&&t(Mt,{confirm:x||G,confirmLabel:t("span",{children:G?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:kt,onClick:()=>{u("loading"),(async()=>{try{let M;x||G?M=await c.v1.accounts.unfollow(R.current):M=await c.v1.accounts.follow(R.current),M&&i(M),u("default")}catch(M){alert(M),u("error")}})()},children:t("button",{type:"button",class:`${x||G?"light swap":""}`,"data-swap-state":x||G?"danger":"",disabled:kt,children:x?t($,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):G?t($,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):b?t($,{children:[t(w,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!dt&&t(vt,{class:"light",onClick:M=>{M.target===M.currentTarget&&gt(!1)},children:t(jn,{note:S,fields:v,onClose:()=>gt(!1)})}),!!It&&t(vt,{class:"light",onClick:M=>{M.target===M.currentTarget&&St(!1)},children:t(Wn,{accountID:R.current,onClose:()=>St(!1)})})]})}function Hn([e,n,l]){const c=.2126*e+.7152*n+.0722*l;let s;return c>=220?s=1:c<=50?s=.1:s=c/255,s=Math.min(1,s),[e,n,l,s]}function Vn(e){if(!e)return;const n=new URL(e),{host:l,pathname:c}=n,s=c.replace(/\/$/,"").replace(/^\//,"");return t($,{children:[t("span",{class:"more-insignificant",children:[l,"/"]}),t("wbr",{}),t("span",{children:s})]})}function jn({note:e,fields:n,onClose:l}){const c=(n==null?void 0:n.map(({name:o,value:r})=>`${o}
${Ce(r)}`).join(`

`))||"",s=Ce(e)+(c?`

${c}`:"");return t("div",{class:"sheet",children:[!!l&&t("button",{type:"button",class:"sheet-close",onClick:l,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:s}),t(Oe,{forceTranslate:!0,text:s})]})]})}function Wn({accountID:e,onClose:n}){const{masto:l}=W(),[c,s]=C("default"),[o,r]=C([]),[a,u]=C([]),[h,i]=se(d=>d+1,0);z(()=>{s("loading"),(async()=>{try{const d=await l.v1.lists.list(),f=await l.v1.accounts.listLists(e);r(d),u(f),s("default")}catch{s("error")}})()},[h]);const[m,p]=C(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[o.length>0?t("ul",{class:"list-add-remove",children:o.map(d=>{const f=a.some(g=>g.id===d.id);return t("li",{children:t("button",{type:"button",class:`light ${f?"checked":""}`,disabled:c==="loading",onClick:()=>{s("loading"),(async()=>{try{f?await l.v1.lists.removeAccount(d.id,{accountIds:[e]}):await l.v1.lists.addAccount(d.id,{accountIds:[e]}),i()}catch{s("error"),alert(f?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(w,{icon:"check-circle"}),t("span",{children:d.title})]})})})}):c==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):c==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:c!=="default",children:[t(w,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),m&&t(vt,{class:"light",onClick:d=>{d.target===d.currentTarget&&p(!1)},children:t(ke,{list:m==null?void 0:m.list,onClose:d=>{d.state==="success"&&i(),p(!1)}})})]})}function Gn({account:e,instance:n,onClose:l}){const{masto:c,instance:s,authenticated:o}=W({instance:n}),r=typeof e=="string",a=xt("esc",l,[l]);return z(()=>{r||(I.accounts[`${e.id}@${s}`]=e)},[e]),t("div",{ref:a,class:"sheet",onClick:u=>{u.target.closest(".account-block")&&l({destination:"account-statuses"})},children:[!!l&&t("button",{type:"button",class:"sheet-close outer",onClick:l,children:t(w,{icon:"x"})}),t(Qe,{instance:s,authenticated:o,account:e,fetchAccount:async()=>{if(r)try{return await c.v1.accounts.lookup({acct:e,skip_webfinger:!1})}catch{const h=await c.v2.search({q:e,type:"accounts",limit:1,resolve:o});if(h.accounts.length)return h.accounts[0]}else return e}})]})}function Jn({onClose:e}){const{masto:n}=W(),[l,c]=C("default"),[s,o]=C([]),[r,a]=se(h=>h+1,0);z(()=>{c("loading"),(async()=>{try{const h=await Wt.drafts.keys();if(h.length){const i=qe(),m=h.filter(p=>p.startsWith(i));if(m.length){const p=await Wt.drafts.getMany(m);p.sort((d,f)=>new Date(f.updatedAt).getTime()-new Date(d.updatedAt).getTime()),o(p)}else o([])}else o([]);c("default")}catch{c("error")}})()},[r]);const u=(s==null?void 0:s.length)>0;return t("div",{class:"sheet",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:[t("h2",{children:["Unsent drafts ",t(ft,{abrupt:!0,hidden:l!=="loading"})]}),u&&t("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),t("main",{children:u?t($,{children:[t("ul",{class:"drafts-list",children:s.map(h=>{const{updatedAt:i,key:m,draftStatus:p,replyTo:d}=h,f=new Date(i);return t("li",{children:[t("div",{class:"mini-draft-meta",children:[t("b",{children:[t(w,{icon:d?"reply":"quill",size:"s"})," ",t("time",{children:[!!d&&t($,{children:["@",d.account.acct,t("br",{})]}),Dt(f)]})]}),t(Mt,{confirmLabel:t("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:l==="loading",onClick:()=>{(async()=>{try{await Wt.drafts.del(m),a()}catch{alert("Error deleting draft! Please try again.")}})()},children:t("button",{type:"button",class:"small light",disabled:l==="loading",children:"Delete…"})})]}),t("button",{type:"button",disabled:l==="loading",class:"draft-item",onClick:async()=>{let g;if(d){c("loading");try{g=await n.v1.statuses.fetch(d.id)}catch{alert("Error fetching reply-to status!"),c("default");return}c("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:g},I.showCompose=!0,I.showDrafts=!1},children:t(Kn,{draft:h})})]},i)})}),s.length>1&&t("p",{children:t(Mt,{confirmLabel:t("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:l==="loading",onClick:()=>{(async()=>{c("loading");try{await Wt.drafts.delMany(s.map(h=>h.key)),c("default"),a()}catch{alert("Error deleting drafts! Please try again."),c("error")}})()},children:t("button",{type:"button",class:"light danger",disabled:l==="loading",children:"Delete all…"})})})]}):t("p",{children:"No drafts found."})})]})}function Kn({draft:e}){var m;const{draftStatus:n,replyTo:l}=e,{status:c,spoilerText:s,poll:o,mediaAttachments:r}=n,a=((m=o==null?void 0:o.options)==null?void 0:m.length)>0,u=(r==null?void 0:r.length)>0,h=a||u,i=ut(()=>{if(!u)return;const p=r.find(g=>/image/.test(g.type));if(!p)return;const{file:d}=p;return URL.createObjectURL(d)},[u,r]);return t($,{children:t("div",{class:"mini-draft",children:[h&&t("div",{class:`mini-draft-aside ${i?"has-image":""}`,style:i?{"--bg-image":`url(${i})`}:{},children:[a&&t(w,{icon:"poll"}),u&&t("span",{children:[t(w,{icon:"attachment"})," ",t("small",{children:r==null?void 0:r.length})]})]}),t("div",{class:"mini-draft-main",children:[!!s&&t("div",{class:"mini-draft-spoiler",children:s}),!!c&&t("div",{class:"mini-draft-status",children:c})]})]})})}function tn({mediaAttachments:e,statusID:n,instance:l,index:c=0,onClose:s=()=>{}}){var f,g;const o=_(null),[r,a]=C(c),u=_(null);Ht(()=>{var y;(y=u.current)==null||y.scrollIntoView()},[]);const h=_(n);z(()=>{const y=c*o.current.clientWidth,b=h.current!==n;b&&(h.current=n),o.current.scrollTo({left:y,behavior:b?"auto":"smooth"}),o.current.focus()},[c,n]);const[i,m]=C(!0);z(()=>{let y=()=>{s()};return o.current&&o.current.addEventListener("swiped-down",y),()=>{o.current&&o.current.removeEventListener("swiped-down",y)}},[]),xt("esc",s,[s]);const[p,d]=C(!1);return z(()=>{let y=()=>{const{clientWidth:b,scrollLeft:T}=o.current,S=Math.round(T/b);a(S)};return o.current&&o.current.addEventListener("scroll",y,{passive:!0}),()=>{o.current&&o.current.removeEventListener("scroll",y)}},[]),z(()=>{let y=setTimeout(()=>{var b,T;(T=(b=o.current)==null?void 0:b.focus)==null||T.call(b)},100);return()=>clearTimeout(y)},[]),t("div",{class:"media-modal-container",children:[t("div",{ref:o,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:y=>{(y.target.classList.contains("carousel-item")||y.target.classList.contains("media")||y.target.classList.contains("media-zoom"))&&s()},children:e==null?void 0:e.map((y,b)=>{const{blurhash:T}=y,S=T?Mn(T):null;return t("div",{class:"carousel-item",style:{"--average-color":`rgb(${S==null?void 0:S.join(",")})`,"--average-color-alpha":`rgba(${S==null?void 0:S.join(",")}, .5)`},tabindex:"0",ref:b===r?u:null,onClick:v=>{v.target!==v.currentTarget&&m(!i)},children:[!!y.description&&t("button",{type:"button",class:"media-alt",hidden:!i,onClick:()=>{d(y.description)},children:[t(w,{icon:"info"}),t("span",{class:"media-alt-desc",children:y.description})]}),t(wn,{media:y,showOriginal:!0})]},y.id)})}),t("div",{class:"carousel-top-controls",hidden:!i,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:t(w,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((y,b)=>t("button",{type:"button",disabled:b===r,class:`carousel-dot ${b===r?"active":""}`,onClick:T=>{T.preventDefault(),T.stopPropagation(),o.current.scrollTo({left:o.current.clientWidth*b,behavior:"smooth"}),o.current.focus()},children:t(w,{icon:"round",size:"s"})},y.id))}):t("span",{}),t("span",{children:[t(zt,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(w,{icon:"more",alt:"More"})}),children:t(yt,{href:((f=e[r])==null?void 0:f.remoteUrl)||((g=e[r])==null?void 0:g.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(w,{icon:"popout"}),t("span",{children:"Open original media"})]})})," ",t(H,{to:`${l?`/${l}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${r+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!i,children:[t("button",{type:"button",class:"carousel-button",hidden:r===0,onClick:y=>{y.preventDefault(),y.stopPropagation(),o.current.focus(),o.current.scrollTo({left:o.current.clientWidth*(r-1),behavior:"smooth"})},children:t(w,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:r===e.length-1,onClick:y=>{y.preventDefault(),y.stopPropagation(),o.current.focus(),o.current.scrollTo({left:o.current.clientWidth*(r+1),behavior:"smooth"})},children:t(w,{icon:"arrow-right"})})]}),!!p&&t(vt,{class:"light",onClick:y=>{y.target===y.currentTarget&&(d(!1),o.current.focus())},children:t(Yn,{alt:p,onClose:()=>d(!1)})})]})}function Yn({alt:e,onClose:n}){const[l,c]=C(!1);return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close outer",onClick:n,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:[t("h2",{children:"Media description"}),t("div",{class:"header-side",children:t(zt,{align:"end",menuButton:t("button",{type:"button",class:"plain4",children:t(w,{icon:"more",alt:"More",size:"xl"})}),children:t(et,{disabled:l,onClick:()=>{c(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate"})]})})})]}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:e}),l&&t(Oe,{forceTranslate:l,text:e})]})]})}const Xn="/phanpy/assets/floating-button-ef345856.svg",Zn="/phanpy/assets/multi-column-d7f22033.svg",Qn="/phanpy/assets/tab-menu-bar-0b1df8b5.svg";function he({children:e}){if(typeof e=="string")return e;const[n,l]=C("");return z(()=>{Promise.resolve(e).then(l)},[e]),n}const qt=9,ts=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],en={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Qt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},ne={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Re(async({id:e})=>(await W().masto.v1.lists.fetch(e)).title,{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||W().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||W().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e,path:({query:e})=>`/search?q=${e}`,icon:"search"},"account-statuses":{id:"account-statuses",title:Re(async({id:e})=>{const n=await W().masto.v1.accounts.fetch(e);return n.username||n.acct||n.displayName},{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||W().instance,path:({hashtag:e,instance:n})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}`,icon:"hashtag"}};function es({onClose:e}){const n=lt(I),{masto:l}=W(),{shortcuts:c}=n,[s,o]=C([]),[r,a]=C([]),[u,h]=C(!1),[i,m]=C(!1);return z(()=>{(async()=>{try{const p=await l.v1.lists.list();o(p)}catch{}})(),(async()=>{try{const p=l.v1.followedTags.list(),d=[];do{const{value:f,done:g}=await p.next();if(g||(f==null?void 0:f.length)===0)break;d.push(...f)}while(!0);a(d)}catch{}})()},[]),t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[t(w,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:["Specify a list of shortcuts that'll appear as:",t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Xn},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Qn},{value:"multi-column",label:"Multi-column",imgURL:Zn}].map(({value:p,label:d,imgURL:f})=>t("label",{children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:p,checked:n.settings.shortcutsViewMode===p||p==="float-button"&&!n.settings.shortcutsViewMode,onChange:g=>{I.settings.shortcutsViewMode=g.target.value}})," ",t("img",{src:f,alt:"",width:"80",height:"58"})," ",t("span",{children:d})]}))})]}),c.length>0?t("ol",{class:"shortcuts-list",children:c.filter(Boolean).map((p,d)=>{const f=d+Object.values(p),{type:g}=p;if(!ne[g])return null;let{icon:y,title:b,subtitle:T}=ne[g];return typeof b=="function"&&(b=b(p,d)),typeof T=="function"&&(T=T(p,d)),typeof y=="function"&&(y=y(p,d)),t("li",{children:[t(w,{icon:y}),t("span",{class:"shortcut-text",children:[t(he,{children:b}),T&&t($,{children:[" ",t("small",{class:"ib insignificant",children:T})]})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:d===0,onClick:()=>{const S=Array.from(I.shortcuts);if(d>0){const v=I.shortcuts[d-1];S[d-1]=p,S[d]=v,I.shortcuts=S}},children:t(w,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:d===c.length-1,onClick:()=>{const S=Array.from(I.shortcuts);if(d<I.shortcuts.length-1){const v=I.shortcuts[d+1];S[d+1]=p,S[d]=v,I.shortcuts=S}},children:t(w,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{h({shortcut:p,shortcutIndex:d})},children:t(w,{icon:"pencil",alt:"Edit"})})]})]},f)})}):t("div",{class:"ui-state insignificant",children:[t("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:p=>{p.preventDefault(),I.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:c.length>=qt&&`Max ${qt} shortcuts`}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>m(!0),children:"Import/export"}),t("button",{type:"button",disabled:c.length>=qt,onClick:()=>h(!0),children:[t(w,{icon:"plus"})," ",t("span",{children:"Add shortcut"})]})]})]}),u&&t(vt,{class:"light",onClick:p=>{p.target===p.currentTarget&&h(!1)},children:t(ns,{shortcut:u.shortcut,shortcutIndex:u.shortcutIndex,lists:s,followedHashtags:r,onSubmit:({result:p,mode:d})=>{d==="edit"?I.shortcuts[u.shortcutIndex]=p:I.shortcuts.push(p)},onClose:()=>h(!1)})}),i&&t(vt,{class:"light",onClick:p=>{p.target===p.currentTarget&&m(!1)},children:t(ss,{shortcuts:c,onClose:()=>m(!1)})})]})}function ns({lists:e,followedHashtags:n,onSubmit:l,disabled:c,shortcut:s,shortcutIndex:o,onClose:r}){var m,p;const a=!!s,[u,h]=C((s==null?void 0:s.type)||null),i=_();return z(()=>{if(a&&u&&Qt[u]){const d=i.current;Qt[u].forEach(({name:f,type:g})=>{const y=d.querySelector(`[name="${f}"]`);y&&s[f]&&(g==="checkbox"?y.checked=s[f]==="on":y.value=s[f])})}},[a,u]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!r&&t("button",{type:"button",class:"sheet-close",onClick:r,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[a?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:i,onSubmit:d=>{d.preventDefault();const f=new FormData(d.target),g={};f.forEach((y,b)=>{g[b]=y==null?void 0:y.trim(),b==="instance"&&(g[b]=g[b].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[b]=g[b].replace(/^@?[^@]+@/,""))}),g.type&&(l({result:g,mode:a?"edit":"add"}),d.target.reset(),h(null),r==null||r())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:c,onChange:d=>{h(d.target.value)},defaultValue:a?s.type:void 0,name:"type",children:[t("option",{}),ts.map(d=>t("option",{value:d,children:en[d]}))]})]})}),(p=(m=Qt[u])==null?void 0:m.map)==null?void 0:p.call(m,({text:d,name:f,type:g,placeholder:y,pattern:b,notRequired:T})=>u==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!T,disabled:c,children:e.map(S=>t("option",{value:S.id,children:S.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:d})," ",t("input",{type:g,name:f,placeholder:y,required:g==="text"&&!T,disabled:c,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:b}),u==="hashtag"&&n.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>t("option",{value:S.name}))})]})})),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:c,children:a?"Save":"Add"}),a&&t("button",{type:"button",class:"light danger",onClick:()=>{I.shortcuts.splice(o,1),r==null||r()},children:"Remove"})]})]})})]})}function ss({shortcuts:e,onClose:n}){var h;const l=ut(()=>!e||!e.filter(Boolean).length?"":Me.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[c,s]=C(""),[o,r]=C("default"),a=ut(()=>{if(!c)return r("default"),null;try{const i=JSON.parse(Me.decompressFromEncodedURIComponent(c));if(!Array.isArray(i))throw new Error("Not an array");return r("default"),i}catch{try{const m=JSON.parse(c);if(!Array.isArray(m))throw new Error("Not an array");return r("default"),m}catch{return r("error"),null}}},[c]),u=I.shortcuts.length>0;return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{children:t("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:i=>{s(i.target.value)}})}),!!a&&Array.isArray(a)&&t($,{children:[t("p",{children:[t("b",{children:a.length})," shortcut",a.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",c.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:a.map(i=>{var m,p;return t("li",{children:[t("span",{style:{opacity:e.some(d=>Object.keys(d).every(f=>d[f]===i[f]))?1:0},children:"*"}),t("span",{children:[en[i.type],i.type==="list"&&" ⚠️"," ",(p=(m=Qt[i.type])==null?void 0:m.map)==null?void 0:p.call(m,({text:d,name:f,type:g})=>i[f]?t($,{children:[t("span",{class:"tag collapsed insignificant",children:[d,":"," ",g==="checkbox"?i[f]==="on"?"✅":"❌":i[f]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),o==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[u&&t($,{children:[t(Mt,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const i=a.filter(d=>!I.shortcuts.some(f=>Object.keys(f).every(g=>f[g]===d[g])));if(!i.length){it("No new shortcuts to import");return}let m=[...I.shortcuts,...i];const p=m.length>qt;p&&(m=m.slice(0,qt)),I.shortcuts=m,it(p?`Shortcuts imported. Exceeded max ${qt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:"Import & append…"})})," "]}),t(Mt,{confirmLabel:u?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:u?"danger":void 0,onClick:()=>{I.shortcuts=a,it("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:u?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:l,readOnly:!0,onClick:i=>{if(i.target.value){i.target.select();try{navigator.clipboard.writeText(i.target.value),it("Shortcuts copied")}catch{it("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.clipboard.writeText(l),it("Shortcut settings copied")}catch{it("Unable to copy shortcut settings")}},children:[t(w,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((h=navigator==null?void 0:navigator.canShare)==null?void 0:h.call(navigator,{text:l}))&&t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.share({text:l})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"})," ",t("span",{children:"Share"})]})," ",l.length>0&&t("small",{class:"insignificant",children:[l.length," characters"]})]}),!!l&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]})]})]})}function is(){const{instance:e}=W(),n=lt(I),{shortcuts:l}=n;if(!l.length)return null;const c=_(),s=ut(()=>l.map((r,a)=>{const{type:u,...h}=r;if(!ne[u])return null;let{id:i,path:m,title:p,subtitle:d,icon:f}=ne[u];return typeof i=="function"&&(i=i(h,a)),typeof m=="function"&&(m=m({...h,instance:h.instance||e},a)),typeof p=="function"&&(p=p(h,a)),typeof d=="function"&&(d=d(h,a)),typeof f=="function"&&(f=f(h,a)),{id:i,path:m,title:p,subtitle:d,icon:f}}).filter(Boolean),[l]),o=Je();return xt(["1","2","3","4","5","6","7","8","9"],(r,a)=>{var h,i;const u=parseInt(a.keys[0],10)-1;if(u<s.length){const{path:m}=s[u];m&&(o(m),(i=(h=c.current)==null?void 0:h.closeMenu)==null||i.call(h))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",children:t("ul",{children:s.map(({id:r,path:a,title:u,subtitle:h,icon:i},m)=>t("li",{children:t(H,{class:h?"has-subtitle":"",to:a,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const d=document.getElementById(`${r}-page`);if(d){d.scrollTop=0;const f=d.querySelector(".updates-button");f&&f.click()}}},children:[t(w,{icon:i,size:"xl",alt:u}),t("span",{children:[t(he,{children:u}),h&&t($,{children:[t("br",{}),t("small",{children:h})]})]})]})},m+u))})}):t(zt,{instanceRef:c,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var a,u;try{const{target:h}=r;getComputedStyle(h).pointerEvents==="none"&&((u=(a=c.current)==null?void 0:a.closeMenu)==null||u.call(a))}catch{}},children:t(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({path:r,title:a,subtitle:u,icon:h},i)=>t(yt,{to:r,class:"glass-menu-item",children:[t(w,{icon:h,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(he,{children:a})}),u&&t($,{children:[" ",t("small",{class:"more-insignificant",children:u})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:i+1})]},i+a))})})}function Jt(e){const{containerProps:n}=e,l=An(),c=_();return t(zt,{boundingBoxPadding:He(),repositionFlag:`${l.width}x${l.height}`,...e,instanceRef:c,containerProps:{onClick:s=>{var o,r,a;s.target===s.currentTarget&&((r=(o=c.current)==null?void 0:o.closeMenu)==null||r.call(o)),(a=n==null?void 0:n.onClick)==null||a.call(n,s)},...n}})}function os(e){var s;let n=[],l=[],c=0;for(let o=0;o<e.length;o++){const r=e[o];r.reblog&&!((s=r.account)!=null&&s.group)?(l.push(r),c++):(n.push(r),c<3&&(c=0))}if(e.length>10&&(l.length>e.length/4||c>=3)){const o=l.map(r=>r.id);if(l.length>e.length*3/4)n=[...n,{id:o,items:l,type:"boosts"}];else{const r=Math.floor(n.length/2);n=[...n.slice(0,r),{id:o,items:l,type:"boosts"},...n.slice(r)]}return n}else return e}function Ee(e,n){const l=X.account.get("boostedStatusIDs")||{},c=e.filter(o=>{if(!o.reblog)return!0;const r=`${n}-${o.reblog.id}`,a=l[r];return a&&a!==o.id?!1:(l[r]=o.id,!0)}),s=Object.keys(l);return s.length>50&&s.slice(0,s.length-50).forEach(o=>{delete l[o]}),X.account.set("boostedStatusIDs",l),c}function cs(e){const n=[];let l=0;e.forEach(o=>{for(let a=0;a<n.length;a++){if(n[a].find(u=>u.id===o.id))return;if(n[a].find(u=>u.id===o.inReplyToId)||n[a].find(u=>u.inReplyToId===o.id)){n[a].push(o);return}}const r=e.find(a=>a.id===o.inReplyToId);r&&(n[l++]=[o,r])});for(let o=0;o<n.length;o++)for(let r=o+1;r<n.length;r++)n[o].find(u=>n[r].includes(u))&&(n[o]=[...n[o],...n[r]],n[o]=n[o].filter((u,h,i)=>i.findIndex(m=>m.id===u.id)===h),n.splice(r,1),r--);n.forEach(o=>{o.sort((r,a)=>!r.inReplyToId&&!a.inReplyToId?new Date(r.createdAt)-new Date(a.createdAt):r.inReplyToId===a.id?1:a.inReplyToId===r.id||!r.inReplyToId?-1:a.inReplyToId?new Date(r.createdAt)-new Date(a.createdAt):1)}),n.forEach(o=>{const r=o[0].account.id;o.forEach(a=>{a.account.id!==r&&(a._differentAuthor=!0)})}),n.length;const c=[],s=[];return e.forEach(o=>{if(o.reblog){c.push(o);return}for(let r=0;r<n.length;r++)if(n[r].find(a=>a.id===o.id)){if(s.includes(r))return;const a=n[r];a.sort((h,i)=>{const m=new Date(h.createdAt),p=new Date(i.createdAt);return m-p});const u=a[0].account.id;c.push({id:a.map(h=>h.id),items:a,type:a.every(h=>h.account.id===u)?"thread":"conversation"}),s.push(r);return}c.push(o)}),c}function ue(e=()=>{},n=[]){const l=_(e);z(()=>{l.current=e},[n]),z(()=>{const c=()=>{const s=document.hidden||document.visibilityState==="hidden";l.current(!s)};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[])}function ce({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:l=1,scrollThresholdStart:c=10,scrollThresholdEnd:s=10,direction:o="vertical",distanceFromStartPx:r,distanceFromEndPx:a}={}){const[u,h]=C(null),[i,m]=C(!1),[p,d]=C(!1),[f,g]=C(!1),[y,b]=C(!1),T=o==="vertical";return Ht(()=>{const S=e.current;if(!S)return{};let v=T?S.scrollTop:S.scrollLeft;function R(){const{scrollTop:x,scrollLeft:L,scrollHeight:A,scrollWidth:Y,clientHeight:j,clientWidth:E}=S,P=T?x:L,Q=T?A:Y,G=T?j:E,U=Math.abs(P-v),J=r||Math.min(G*n,Q,P),D=a||Math.min(G*l,Q,Q-P-G);U>=(v<P?s:c)&&(h(v<P?"end":"start"),v=P),m(P<=0),d(P+G>=Q),g(P<=J),b(P+G>=Q-D)}return S.addEventListener("scroll",R,{passive:!0}),()=>S.removeEventListener("scroll",R)},[n,l,c,s]),{scrollDirection:u,reachStart:i,reachEnd:p,nearReachStart:f,nearReachEnd:y,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function Kt(e){var f,g,y,b,T;const n=lt(I),{instance:l,authenticated:c}=W(),[s,o]=C(),[r,a]=C(!1);z(()=>{const S=X.local.getJSON("accounts")||[],v=S.find(R=>R.info.id===X.session.get("currentAccount"));v&&o(v),a(S.length>1)},[]);const u=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(S=>S.type==="following"),h=Dn(()=>{I.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),i=_(),[m,p]=C(void 0),d=He([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]);return t($,{children:[t("button",{ref:i,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{p(S=>S?void 0:"open")},onContextMenu:S=>{S.preventDefault(),I.showAccounts=!0},...h(),children:[r&&t(Ut,{url:((f=s==null?void 0:s.info)==null?void 0:f.avatar)||((g=s==null?void 0:s.info)==null?void 0:g.avatarStatic),size:"l",squircle:(y=s==null?void 0:s.info)==null?void 0:y.bot}),t(w,{icon:"menu",size:r?"s":"l"})]}),t(Ke,{menuClassName:"nav-menu",state:m,anchorRef:i,onClose:()=>{p(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{p(void 0)}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:d,unmountOnClose:!0,children:[t("section",{children:[!!((b=n.appVersion)!=null&&b.commitHash)&&n.appVersion.commitHash!=="c645553"&&t($,{children:[t(et,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(w,{icon:"sparkles",size:"l"})," ",t("span",{children:"New update available…"})]}),t(Ct,{})]}),t(yt,{to:"/",children:[t(w,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),c&&t($,{children:[u&&t(yt,{to:"/following",children:[t(w,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(yt,{to:"/mentions",children:[t(w,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(yt,{to:"/notifications",children:[t(w,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(Ct,{}),t(yt,{to:"/l",children:[t(w,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(yt,{to:"/ft",children:[t(w,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(yt,{to:"/b",children:[t(w,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(yt,{to:"/f",children:[t(w,{icon:"heart",size:"l"})," ",t("span",{children:"Favourites"})]})]}),t(Ct,{}),t(yt,{to:"/search",children:[t(w,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(yt,{to:`/${l}/p/l`,children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Local"})]}),t(yt,{to:`/${l}/p`,children:[t(w,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),t(yt,{to:`/${l}/trending`,children:[t(w,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]})]}),t("section",{children:c?t($,{children:[t(Ct,{}),((T=s==null?void 0:s.info)==null?void 0:T.id)&&t(yt,{to:`/${l}/a/${s.info.id}`,children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(et,{onClick:()=>{I.showAccounts=!0},children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]}),t(et,{onClick:()=>{I.showShortcutsSettings=!0},children:[t(w,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts Settings…"})]}),t(et,{onClick:()=>{I.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t($,{children:[t(Ct,{}),t(yt,{to:"/login",children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})})]})]})}function At({title:e,titleComponent:n,id:l,instance:c,emptyText:s,errorText:o,useItemID:r,boostsCarousel:a,fetchItems:u=()=>{},checkForUpdates:h=()=>{},checkForUpdatesInterval:i=6e4,headerStart:m,headerEnd:p,timelineStart:d,allowFilters:f,refresh:g}){const y=lt(I),[b,T]=C([]),[S,v]=C("default"),[R,x]=C(!1),[L,A]=C(!1),[Y,j]=C(!0),E=_(),P=Ye(O=>{A(!1),S!=="loading"&&(v("loading"),(async()=>{try{let{done:M,value:k}=await u(O);Array.isArray(k)?(a&&(k=os(k)),k=cs(k),T(O?k:N=>[...N,...k]),k.length||(M=!0),x(!M)):x(!1),v("default")}catch{v("error")}finally{P.cancel()}})())},1500,{leading:!0,trailing:!1}),Q=".timeline-item, .timeline-item-alt",G=xt("j, shift+j",(O,M)=>{var K,Z;const k=document.activeElement.closest(Q),N=k==null?void 0:k.getBoundingClientRect(),B=Array.from(E.current.querySelectorAll(Q));if(k&&N.top<E.current.clientHeight&&N.bottom>0){const q=B.indexOf(k);let F=B[q+1];M.shift&&(F=B.find((nt,Lt)=>Lt>q&&!nt.classList.contains("timeline-item-alt"))),F&&(F.focus(),(K=F.scrollIntoViewIfNeeded)==null||K.call(F))}else{const q=B.find(F=>{const nt=F.getBoundingClientRect();return nt.top>=44&&nt.left>=0});q&&(q.focus(),(Z=q.scrollIntoViewIfNeeded)==null||Z.call(q))}}),U=xt("k, shift+k",(O,M)=>{var K,Z;const k=document.activeElement.closest(Q),N=k==null?void 0:k.getBoundingClientRect(),B=Array.from(E.current.querySelectorAll(Q));if(k&&N.top<E.current.clientHeight&&N.bottom>0){const q=B.indexOf(k);let F=B[q-1];M.shift&&(F=B.findLast((nt,Lt)=>Lt<q&&!nt.classList.contains("timeline-item-alt"))),F&&(F.focus(),(K=F.scrollIntoViewIfNeeded)==null||K.call(F))}else{const q=B.find(F=>{const nt=F.getBoundingClientRect();return nt.top>=44&&nt.left>=0});q&&(q.focus(),(Z=q.scrollIntoViewIfNeeded)==null||Z.call(q))}}),J=xt(["enter","o"],()=>{const O=document.activeElement.closest(Q);O&&O.click()}),{scrollDirection:D,nearReachStart:ct,nearReachEnd:ot,reachStart:tt,reachEnd:kt}=ce({scrollableRef:E,distanceFromEnd:2,scrollThresholdStart:44});z(()=>{var O;(O=E.current)==null||O.scrollTo({top:0}),P(!0)},[]),z(()=>{P(!0)},[g]),z(()=>{tt&&P(!0)},[tt]),z(()=>{(ot||kt&&R)&&P()},[ot,R]);const Tt=_(!1),dt=Xe(5e3),gt=ie(async({disableHoverCheck:O=!1}={})=>{y.settings.autoRefresh&&E.current.scrollTop===0&&(O||dt)&&!rs()?P(!0):await h()&&A(!0)},[l,dt,P,h,y.settings.autoRefresh]),It=_();ue(O=>{if(O){const M=Date.now()-It.current;(!It.current||M>1e3*60)&&gt({disableHoverCheck:!0})}else It.current=Date.now();j(O)},[h,gt,y.settings.autoRefresh]),Ve(gt,Y&&!L?i:null);const St=D==="end"&&!ct;return t("div",{id:`${l}-page`,class:"deck-container",ref:O=>{E.current=O,G.current=O,U.current=O,J.current=O},tabIndex:"-1",onPointerEnter:O=>{Tt.current=!0},onPointerLeave:()=>{Tt.current=!1},children:t("div",{class:"timeline-deck deck",children:[t("header",{hidden:St,onClick:O=>{var M;O.target.closest("a, button")||(M=E.current)==null||M.scrollTo({top:0,behavior:"smooth"})},onDblClick:O=>{O.target.closest("a, button")||P(!0)},class:S==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Kt,{}),m??t(H,{to:"/",class:"button plain home-button",children:t(w,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!p&&p})]}),b.length>0&&S!=="loading"&&!St&&L&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var O;P(!0),(O=E.current)==null||O.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New posts"]})]}),!!d&&t("div",{class:"timeline-start",children:d}),b.length?t($,{children:[t("ul",{class:"timeline",children:[b.map(O=>{const{id:M,reblog:k,items:N,type:B,_pinned:K}=O,Z=(k==null?void 0:k.id)||M,q=c?`/${c}/s/${Z}`:`/s/${Z}`;let F="";B==="boosts"?F=`${N.length} Boosts`:B==="pinned"&&(F="Pinned posts");const nt=B==="boosts"||B==="pinned";if(N){if(nt)return N.sort((st,rt)=>st._filtered&&!rt._filtered?1:!st._filtered&&rt._filtered?-1:0),t("li",{class:"timeline-item-carousel",children:t(as,{title:F,class:`${B}-carousel`,children:N.map(st=>{const{id:rt,reblog:bt}=st,$t=(bt==null?void 0:bt.id)||rt,Nt=c?`/${c}/s/${$t}`:`/s/${$t}`;return t("li",{children:t(H,{class:"status-carousel-link timeline-item-alt",to:Nt,children:r?t(wt,{statusID:rt,instance:c,size:"s",contentTextWeight:!0}):t(wt,{status:st,instance:c,size:"s",contentTextWeight:!0})})},rt)})})},`timeline-${M}`);const Lt=N.length>3;return N.map((st,rt)=>{const{id:bt,_differentAuthor:$t}=st,Nt=c?`/${c}/s/${bt}`:`/s/${bt}`,ae=rt>0&&rt<N.length-1,Vt=st.sensitive&&!!st.spoilerText&&rt>0||Lt&&ae&&B==="thread";return t("li",{class:`timeline-item-container timeline-item-container-type-${B} timeline-item-container-${rt===0?"start":rt===N.length-1?"end":"middle"} ${$t?"timeline-item-diff-author":""}`,children:t(H,{class:"status-link timeline-item",to:Nt,children:Vt?t(ls,{status:st,instance:c}):r?t(wt,{statusID:bt,instance:c,allowFilters:f}):t(wt,{status:st,instance:c,allowFilters:f})})},`timeline-${bt}`)})}return t("li",{children:t(H,{class:"status-link timeline-item",to:q,children:r?t(wt,{statusID:M,instance:c,allowFilters:f}):t(wt,{status:O,instance:c,allowFilters:f})})},`timeline-${M+K}`)}),R&&S==="loading"&&t($,{children:[t("li",{style:{height:"20vh"},children:t(wt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(wt,{skeleton:!0})})]})]}),S==="default"&&(R?t(oe,{onChange:O=>{O&&P()},children:t("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((O,M)=>t("li",{children:t(wt,{skeleton:!0})},M))}):S!=="error"&&t("p",{class:"ui-state",children:s}),S==="error"&&t("p",{class:"ui-state",children:[o,t("br",{}),t("br",{}),t("button",{class:"button plain",onClick:()=>P(!b.length),children:"Try again"})]})]})})}function as({title:e,class:n,children:l}){const c=_(),{reachStart:s,reachEnd:o,init:r}=ce({scrollableRef:c,direction:"horizontal"});return z(()=>{r==null||r()},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var a,u;(u=c.current)==null||u.scrollBy({left:-Math.min(320,(a=c.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-left"})})," ",t("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var a,u;(u=c.current)==null||u.scrollBy({left:Math.min(320,(a=c.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-right"})})]})]}),t("ul",{ref:c,children:l})]})}function ls({status:e,instance:n}){const l=lt(I),{id:c}=e,s=je(e),o=ye(c,n);return t("article",{class:"status compact-thread",tabindex:"-1",children:[l.statusThreadNumber[o]?t("div",{class:"status-thread-badge",children:[t(w,{icon:"thread",size:"s"}),l.statusThreadNumber[o]?` ${l.statusThreadNumber[o]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(w,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:s,children:[s,e.sensitive&&e.spoilerText&&t($,{children:[" ",t("span",{class:"spoiler-badge",children:t(w,{icon:"eye-close",size:"s"})})]})]})]})}function rs(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ds=20;function hs(){const e=lt(I),{id:n,...l}=Ft(),[c,s]=Bt(),o=!c.get("replies"),r=!!c.get("boosts"),a=c.get("tagged"),u=!!c.get("media"),{masto:h,instance:i,authenticated:m}=W({instance:l.instance}),p=_();async function d(j){const E=[];if(j){const{value:G}=await h.v1.accounts.listStatuses(n,{pinned:!0}).next();if(G!=null&&G.length&&!a&&!u)if(G.forEach(U=>{U._pinned=!0,pt(U,i)}),G.length>=3){const U=G.map(J=>J.id);E.push({id:U,items:G,type:"pinned"})}else E.push(...G)}(j||!p.current)&&(p.current=h.v1.accounts.listStatuses(n,{limit:ds,exclude_replies:o,exclude_reblogs:r,only_media:u,tagged:a}));const{value:P,done:Q}=await p.current.next();return P!=null&&P.length&&(E.push(...P),P.forEach(G=>{pt(G,i)})),{value:E,done:Q}}const[f,g]=C(),[y,b]=C([]);mt(`${f!=null&&f.displayName?f.displayName+" ":""}@${f!=null&&f.acct?f.acct:"Account posts"}`,"/:instance?/a/:id"),z(()=>{(async()=>{try{const j=await h.v1.accounts.fetch(n);g(j)}catch{}try{const j=await h.v1.accounts.listFeaturedTags(n);b(j)}catch{}})()},[n]);const{displayName:T,acct:S,emojis:v}=f||{},R=_(),x=ut(()=>{const j=e.accounts[`${n}@${i}`],E=!o||r||a||u;return t($,{children:[t(Qe,{instance:i,account:j||n,fetchAccount:()=>h.v1.accounts.fetch(n),authenticated:m,standalone:!0}),t("div",{class:"filter-bar",ref:R,children:[E?t(H,{to:`/${i}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(w,{icon:"x",size:"l"})}):t(w,{icon:"filter",class:"insignificant",size:"l"}),t(H,{to:`/${i}/a/${n}${o?"?replies=1":""}`,onClick:()=>{o&&it("Showing post with replies")},class:o?"":"is-active",children:"+ Replies"}),t(H,{to:`/${i}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||it("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),t(H,{to:`/${i}/a/${n}${u?"":"?media=1"}`,onClick:()=>{u||it("Showing posts with media")},class:u?"is-active":"",children:"Media"}),y.map(P=>t(H,{to:`/${i}/a/${n}${a===P.name?"":`?tagged=${encodeURIComponent(P.name)}`}`,onClick:()=>{a!==P.name&&it(`Showing posts tagged with #${P.name}`)},class:a===P.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),P.name]})}))]})]})},[n,i,m,o,r,y,a,u]);z(()=>{var E;const j=(E=R.current)==null?void 0:E.querySelector(".is-active");j&&R.current.scrollTo({behavior:"smooth",left:j.offsetLeft-(R.current.offsetWidth-j.offsetWidth)/2})},[y,a,u,o,r]);const L=ut(()=>f!=null&&f.url?new URL(f.url).hostname:null,[f]),Y=!!f&&!(i===L);return t(At,{title:`${f!=null&&f.acct?"@"+f.acct:"Posts"}`,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:t(Be,{text:T,emojis:v})}),t("div",{children:t("span",{children:["@",S]})})]}),id:"account-statuses",instance:i,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:d,useItemID:!0,boostsCarousel:e.settings.boostsCarousel,timelineStart:x,refresh:o+r+a+u,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(et,{disabled:!Y,onClick:()=>{(async()=>{try{const{masto:j}=W({instance:L}),E=await j.v1.accounts.lookup({acct:f.acct}),{id:P}=E;location.hash=`/${L}/a/${P}`}catch{alert("Unable to fetch account info")}})()},children:[t(w,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:L}),")"]})]})})},n)}function us({onClose:e}){const{masto:n}=W(),l=X.local.getJSON("accounts"),c=X.session.get("currentAccount"),s=l.length>1,[o,r]=C(0),[a,u]=se(h=>h+1,0);return t("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:t("h2",{children:"Accounts"})}),t("main",{children:t("section",{children:[t("ul",{class:"accounts-list",children:l.map((h,i)=>{const m=h.info.id===c,p=i===(o||0);return t("li",{children:[t("div",{children:[s&&t("span",{class:`current ${m?"is-current":""}`,children:t(w,{icon:"check-circle",alt:"Current"})}),t(Ut,{url:h.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(m)try{const d=await n.v1.accounts.fetch(h.info.id);h.info=d,X.local.setJSON("accounts",l),u()}catch{}}}),t(we,{account:s?{...h.info,acct:/@/.test(h.info.acct)?h.info.acct:`${h.info.acct}@${h.instanceURL}`}:h.info,showAcct:!0,onClick:()=>{m?I.showAccount=`${h.info.username}@${h.instanceURL}`:(X.session.set("currentAccount",h.info.id),location.reload())}})]}),t("div",{class:"actions",children:[p&&s&&t($,{children:[t("span",{class:"tag",children:"Default"})," "]}),t(zt,{align:"end",menuButton:t("button",{type:"button",title:"More",class:"plain more-button",children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[t(et,{onClick:()=>{I.showAccount=`${h.info.username}@${h.instanceURL}`},children:[t(w,{icon:"user"}),t("span",{children:"View profile…"})]}),t(Ct,{}),s&&t(et,{disabled:p,onClick:()=>{l.splice(i,1),l.unshift(h),X.local.setJSON("accounts",l),r(i)},children:[t(w,{icon:"check-circle"}),t("span",{children:"Set as default"})]}),t(Mt,{subMenu:!0,confirmLabel:t($,{children:[t(w,{icon:"exit"}),t("span",{children:["Log out @",h.info.acct,"?"]})]}),disabled:!m,menuItemClassName:"danger",onClick:()=>{l.splice(i,1),X.local.setJSON("accounts",l),location.href="/"},children:[t(w,{icon:"exit"}),t("span",{children:"Log out…"})]})]})]})]},i+h.id)})}),t("p",{children:t(H,{to:"/login",class:"button plain2",onClick:e,children:[t(w,{icon:"plus"})," ",t("span",{children:"Add an existing account"})]})}),s&&t("p",{children:t("small",{children:["Note: ",t("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const fs=20;function nn(){mt("Bookmarks","/b");const{masto:e,instance:n}=W(),l=_();async function c(s){return(s||!l.current)&&(l.current=e.v1.bookmarks.list({limit:fs})),await l.current.next()}return t(At,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:c})}const ps=20;function sn(){mt("Favourites","/f");const{masto:e,instance:n}=W(),l=_();async function c(s){return(s||!l.current)&&(l.current=e.v1.favourites.list({limit:ps})),await l.current.next()}return t(At,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:c})}const ms=200;function gs(){const{masto:e,instance:n}=W();mt("Followed Hashtags","/ft");const[l,c]=C("default"),[s,o]=C([]);return z(()=>{c("loading"),(async()=>{try{const r=e.v1.followedTags.list({limit:ms}),a=[];do{const{value:u,done:h}=await r.next();if(h||(u==null?void 0:u.length)===0)break;a.push(...u)}while(!0);a.sort((u,h)=>u.name.localeCompare(h.name)),o(a),c("default")}catch{c("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Kt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:s.length>0?t("ul",{class:"link-list",children:s.map(r=>t("li",{children:t(H,{to:n?`/${n}/t/${r.name}`:`/t/${r.name}`,children:[t(w,{icon:"hashtag"})," ",t("span",{children:r.name})]})}))}):l==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):l==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function bs(e,n,l){var u;const{filtered:c}=e;if(!(c!=null&&c.length)||l&&((u=e.account)==null?void 0:u.id)===l)return!0;const o=c.filter(h=>{const{filter:i}=h,m=i.context.includes(n);return m?i.expiresAt?new Date(i.expiresAt)>new Date:m:!1});if(!o.length)return!0;if(o.some(h=>h.filter.filterAction==="hide"))return!1;const a=o.some(h=>h.filter.filterAction==="warn");if(a){const h=o.map(i=>i.filter.title);e._filtered={titles:h,titlesStr:h.join(" • ")}}return a}function Et(e,n){if(!(e!=null&&e.length))return[];if(!n)return e;const l=X.session.get("currentAccount");return e.filter(c=>bs(c,n,l))}const ys=20;function Ie({title:e,path:n,id:l,...c}){mt(e||"Following",n||"/following");const{masto:s,instance:o}=W(),r=lt(I),a=_(),u=_();async function h(d){(d||!a.current)&&(a.current=s.v1.timelines.listHome({limit:ys}));const f=await a.current.next();let{value:g}=f;return g!=null&&g.length&&(d&&(u.current=g[0].id),g=Et(g,"home"),g.forEach(y=>{pt(y,o)}),g=Ee(g,o),g.sort((y,b)=>{const T=new Date(y.createdAt);return new Date(b.createdAt)-T})),{...f,value:g}}async function i(){try{const d=await s.v1.timelines.listHome({limit:5,since_id:u.current}).next();let{value:f}=d;return!!(f!=null&&f.length&&(u.current=f[0].id,f=Ee(f,o),f=Et(f,"home"),f.some(g=>!g.reblog)))}catch{return!1}}const m=_(),p=async()=>{if(m.current&&(m.current.readyState===WebSocket.CONNECTING||m.current.readyState===WebSocket.OPEN))return;const d=await s.v1.stream.streamUser();return m.current=d.ws,m.current.__id=Math.random(),d.on("status.update",f=>{pt(f,o)}),d.on("delete",f=>{const g=We(f,o);g&&(g._deleted=!0)}),d.ws.onclose=()=>{},d};return z(()=>{let d;return(async()=>d=await p())(),()=>{d&&(d.ws.close(),m.current=null)}},[]),t(At,{title:e||"Following",id:l||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:o,fetchItems:h,checkForUpdates:i,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...c,allowFilters:!0})}const ws=20,vs=4,Ne=vs+1;function on({columnMode:e,...n}){let{hashtag:l,...c}=e?{}:Ft();n.hashtag&&(l=n.hashtag);let s=l.trim().split(/[\s+]+/);s.sort(),l=s[0];const{masto:o,instance:r,authenticated:a}=W({instance:(n==null?void 0:n.instance)||c.instance}),{authenticated:u}=W(),h=s.map(v=>`#${v}`).join(" "),i=r?`${h} on ${r}`:h;mt(i,"/:instance?/t/:hashtag");const m=_(),p=_(void 0);async function d(v){const R=await o.v1.timelines.listHashtag(l,{limit:ws,any:s.slice(1),maxId:v?void 0:p.current}).next(),{value:x}=R;return x!=null&&x.length&&(v&&(m.current=x[0].id),x.forEach(L=>{pt(L,r)}),p.current=x[x.length-1].id),{...R,value:x}}async function f(){try{const v=await o.v1.timelines.listHashtag(l,{limit:1,any:s.slice(1),since_id:m.current}).next(),{value:R}=v;return!!(R!=null&&R.length)}catch{return!1}}const[g,y]=C("default"),[b,T]=C();z(()=>{(async()=>{try{const v=await o.v1.tags.fetch(l);T(v)}catch{}})()},[l]);const S=s.length>=Ne;return t(At,{title:i,titleComponent:!!r&&t("h1",{class:"header-account",children:[t("b",{children:h}),t("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:d,checkForUpdates:f,useItemID:!0,headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[!!b&&s.length===1&&t($,{children:[t(Mt,{subMenu:!0,confirm:b.following,confirmLabel:`Unfollow #${l}?`,disabled:g==="loading"||!a,onClick:()=>{y("loading"),b.following?o.v1.tags.unfollow(l).then(()=>{T({...b,following:!1}),it(`Unfollowed #${l}`)}).catch(v=>{alert(v)}).finally(()=>{y("default")}):o.v1.tags.follow(l).then(()=>{T({...b,following:!0}),it(`Followed #${l}`)}).catch(v=>{alert(v)}).finally(()=>{y("default")})},children:b.following?t($,{children:[t(w,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t($,{children:[t(w,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(Ct,{})]}),t(En,{className:"menu-field",disabled:S,children:({ref:v})=>t("form",{onSubmit:R=>{var L,A;R.preventDefault();const x=(A=(L=R.target[0].value)==null?void 0:L.trim)==null?void 0:A.call(L);x&&!s.some(Y=>Y.toLowerCase()===x.toLowerCase())&&(s.push(x),s.sort(),location.hash=r?`/${r}/t/${s.join("+")}`:`/t/${s.join("+")}`)},children:[t(w,{icon:"hashtag"}),t("input",{ref:v,type:"text",placeholder:S?`Max ${Ne} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),t(Nn,{takeOverflow:!0,children:s.map((v,R)=>t(et,{disabled:s.length===1,onClick:x=>{s.splice(R,1),s.sort(),navigate(r?`/${r}/t/${s.join("+")}`:`/t/${s.join("+")}`)},children:[t(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),v]})]},v))}),t(Ct,{}),t(et,{disabled:!u,onClick:()=>{const v={type:"hashtag",hashtag:s.join(" "),instance:r};I.shortcuts.some(x=>x.type===v.type&&x.hashtag.split(/[\s+]+/).sort().join(" ")===v.hashtag.split(/[\s+]+/).sort().join(" ")&&(x.instance?x.instance===v.instance:!0))?alert("This shortcut already exists"):(I.shortcuts.push(v),it("Hashtag shortcut added"))},children:[t(w,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(et,{onClick:()=>{let v=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(v)){v&&alert("Invalid instance");return}v&&(v=v.toLowerCase().trim(),navigate(`/${v}/t/${s.join("+")}`))},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},r+h)}const Ss=20;function cn(e){var g;const n=lt(I),{masto:l,instance:c}=W(),s=(e==null?void 0:e.id)||((g=Ft())==null?void 0:g.id),o=_(),r=_();async function a(y){(y||!r.current)&&(r.current=l.v1.timelines.listList(s,{limit:Ss}));const b=await r.current.next();let{value:T}=b;return T!=null&&T.length&&(y&&(o.current=T[0].id),T=Et(T,"home"),T.forEach(S=>{pt(S,c)})),{...b,value:T}}async function u(){try{const y=await l.v1.timelines.listList(s,{limit:1,since_id:o.current});let{value:b}=y;return b=Et(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[h,i]=C({title:"List"});mt(h.title,"/l/:id"),z(()=>{(async()=>{try{const y=await l.v1.lists.fetch(s);i(y)}catch{}})()},[s]);const[m,p]=C(!1),[d,f]=C(!1);return t($,{children:[t(At,{title:h.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:c,fetchItems:a,checkForUpdates:u,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:t(H,{to:"/l",class:"button plain",children:t(w,{icon:"list",size:"l"})}),headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(et,{onClick:()=>p({list:h}),children:[t(w,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(et,{onClick:()=>f(!0),children:[t(w,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},s),m&&t(vt,{class:"light",onClick:y=>{y.target===y.currentTarget&&p(!1)},children:t(ke,{list:m==null?void 0:m.list,onClose:y=>{y.state==="success"&&y.list?i(y.list):y.state==="deleted"&&(location.hash="/l"),p(!1)}})}),d&&t(vt,{class:"light",onClick:y=>{y.target===y.currentTarget&&f(!1)},children:t(Is,{listID:s,onClose:()=>f(!1)})})]})}const ks=40;function Is({listID:e,onClose:n}){const{masto:l,instance:c}=W(),[s,o]=C([]),[r,a]=C("default"),[u,h]=C(!1),i=_();async function m(p){h(!1),a("loading"),(async()=>{try{(p||!i.current)&&(i.current=l.v1.lists.listAccounts(e,{limit:ks}));const d=await i.current.next();let{done:f,value:g}=d;g!=null&&g.length?(o(p?g:s.concat(g)),h(!f)):h(!1),a("default")}catch{a("error")}})()}return z(()=>{m(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[s.map(p=>t("li",{children:[t(Pt,{account:p,instance:c}),t(Ts,{account:p,listID:e})]},p.id)),u&&r==="default"&&t(oe,{as:"li",onChange:p=>p&&m(),children:t("button",{type:"button",class:"light block",onClick:m,children:"Show more…"})})]})})]})}function Ts({account:e,listID:n}){const{masto:l}=W(),[c,s]=C("default"),[o,r]=C(!1);return t(Mt,{confirm:!o,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{o?(s("loading"),(async()=>{try{await l.v1.lists.addAccount(n,{accountIds:[e.id]}),s("default"),r(!1)}catch{s("error")}})()):(s("loading"),(async()=>{try{await l.v1.lists.removeAccount(n,{accountIds:[e.id]}),s("default"),r(!0)}catch{s("error")}})())},children:t("button",{type:"button",class:`light ${o?"":"danger"}`,disabled:c==="loading",children:o?"Add":"Remove…"})})}const _e=20,Cs=new URLSearchParams;function an({columnMode:e,...n}){mt("Mentions","/mentions");const{masto:l,instance:c}=W(),[s]=e?[Cs]:Bt(),[o,r]=C(null),a=(n==null?void 0:n.type)||s.get("type")||o,u=_(),h=_();async function i(b){(b||!u.current)&&(u.current=l.v1.notifications.list({limit:_e,types:["mention"]}));const T=await u.current.next();let{value:S}=T;return S!=null&&S.length&&(b&&(h.current=S[0].id),S.forEach(({status:v})=>{pt(v,c)})),{...T,value:S==null?void 0:S.map(v=>v.status)}}const m=_(),p=_();async function d(b){(b||!m.current)&&(m.current=l.v1.conversations.list({limit:_e}));const T=await m.current.next();let{value:S}=T;return S=S==null?void 0:S.filter(v=>v.lastStatus),S!=null&&S.length&&(b&&(p.current=S[0].lastStatus.id),S.forEach(({lastStatus:v})=>{pt(v,c)})),{...T,value:S==null?void 0:S.map(v=>v.lastStatus)}}function f(...b){return a==="private"?d(...b):i(...b)}async function g(){if(a==="private")try{const b=await l.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:T}=b;return T!=null&&T.length?(p.current=T[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await l.v1.notifications.list({limit:1,types:["mention"],since_id:h.current}).next();let{value:T}=b;return T!=null&&T.length?(h.current=T[0].id,!0):!1}catch{return!1}}const y=ut(()=>t("div",{class:"filter-bar centered",children:[t(H,{to:"/mentions",class:a?"":"is-active",onClick:b=>{e&&(b.preventDefault(),r(null))},children:"All"}),t(H,{to:"/mentions?type=private",class:a==="private"?"is-active":"",onClick:b=>{e&&(b.preventDefault(),r("private"))},children:"Private"})]}),[a]);return t(At,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:c,fetchItems:f,checkForUpdates:g,useItemID:!0,timelineStart:y,refresh:a})}function fe({accountID:e,onChange:n}){const{masto:l}=W(),[c,s]=C("default"),[o,r]=C(null),[a,u]=C(null),h=a!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:c==="loading",onClick:()=>{s("loading"),r("accept"),(async()=>{try{const i=await l.v1.followRequests.authorize(e);if(!(i!=null&&i.followedBy))throw new Error("Follow request not accepted");u(i),n()}catch{}s("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:c==="loading",class:"light danger",onClick:()=>{s("loading"),r("reject"),(async()=>{try{const i=await l.v1.followRequests.reject(e);if(i!=null&&i.followedBy)throw new Error("Follow request not rejected");u(i),n()}catch{s("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:h&&o?o==="accept"?t(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(ft,{hidden:c!=="loading"})})]})}const Pe={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil"},jt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":e=>`favourited ${e} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":e=>`boosted & favourited ${e} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply."};function ln({notification:e,instance:n,reload:l}){var b,T,S,v,R;const{id:c,status:s,account:o,_accounts:r,_statuses:a}=e;let{type:u}=e;const h=((b=s==null?void 0:s.reblog)==null?void 0:b.id)||(s==null?void 0:s.id),i=X.session.get("currentAccount"),m=i===(o==null?void 0:o.id),p=(T=s==null?void 0:s.poll)==null?void 0:T.voted,d=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==i&&((S=s==null?void 0:s.account)==null?void 0:S.id)===i;let f=0,g=0;if(u==="favourite+reblog"){for(const x of r)(v=x._types)!=null&&v.includes("favourite")&&f++,(R=x._types)!=null&&R.includes("reblog")&&g++;!g&&f&&(u="favourite"),!f&&g&&(u="reblog")}let y;return u==="poll"?y=jt[m?"poll-self":p?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(a==null?void 0:a.length)>1?y=jt[`${u}+account`]:d?y=jt[`${u}_reply`]:y=jt[u]:y=jt[u],typeof y=="function"&&(y=y((a==null?void 0:a.length)||(r==null?void 0:r.length))),u==="mention"&&!s?null:t("div",{class:`notification notification-${u}`,tabIndex:"0",children:[t("div",{class:`notification-type notification-${u}`,title:new Date(e.createdAt).toLocaleString(),children:u==="favourite+reblog"?t($,{children:[t(w,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),t(w,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):t(w,{icon:Pe[u]||"notification",size:"xl",alt:u})}),t("div",{class:"notification-content",children:[u!=="mention"&&t($,{children:[t("p",{children:[!/poll|update/i.test(u)&&t($,{children:(r==null?void 0:r.length)>1?t($,{children:[t("b",{children:[r.length," people"]})," "]}):t($,{children:[t(we,{account:o,showAvatar:!0})," "]})}),y,u==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(ve,{datetime:e.createdAt,format:"micro"})]})]}),u==="follow_request"&&t(fe,{accountID:o.id,onChange:()=>{}})]}),(r==null?void 0:r.length)>1&&t("p",{class:"avatars-stack",children:r.map((x,L)=>t($,{children:[t("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:A=>{A.preventDefault(),I.showAccount=x},children:[t(Ut,{url:x.avatarStatic,size:r.length<=10?"xxl":r.length<100?"xl":r.length<1e3?"l":r.length<2e3?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),u==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:x._types.map(A=>t(w,{icon:Pe[A],size:"s",class:`${A}-icon`}))})]})," "]}))}),(a==null?void 0:a.length)>1&&t("ul",{class:"notification-group-statuses",children:a.map(x=>t("li",{children:t(H,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:t(wt,{status:x,size:"s"})})},x.id))}),s&&(!(a!=null&&a.length)||(a==null?void 0:a.length)<=1)&&t(H,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${h}`:`/s/${h}`,children:t(wt,{statusID:h,size:"s"})})]})]})}function rn(e){const n={},l=[];for(let o=0,r=0;o<e.length;o++){const a=e[o],{status:u,account:h,type:i,createdAt:m}=a,p=new Date(m).toLocaleDateString();let d=i;(i==="favourite"||i==="reblog")&&(d="favourite+reblog");const f=`${u==null?void 0:u.id}-${d}-${p}`,g=n[f];if(d==="follow_request")l[r++]=a;else if(g!=null&&g.account){const y=g._accounts.find(b=>b.id===h.id);y?(y._types.push(i),y._types.sort().reverse()):(h._types=[i],g._accounts.push(h))}else{h._types=[i];let y=n[f]={...a,type:d,_accounts:[h]};l[r++]=y}}const c={},s=[];for(let o=0,r=0;o<l.length;o++){const a=l[o],{account:u,_accounts:h,type:i,createdAt:m}=a,p=new Date(m).toLocaleDateString();if(i==="favourite+reblog"&&u&&h.length===1){const d=`${u==null?void 0:u.id}-${i}-${p}`,f=c[d];if(f)f._statuses.push(a.status);else{let g=c[d]={...a,type:i,_statuses:[a.status]};s[r++]=g}}else s[r++]=a}return s}const xs=30;function $s(){mt("Notifications","/notifications");const{masto:e,instance:n}=W(),l=lt(I),[c,s]=C("default"),[o,r]=C(!1),a=_(),{nearReachEnd:u,scrollDirection:h,reachStart:i,nearReachStart:m}=ce({scrollableRef:a}),p=h==="end"&&!m,[d,f]=C([]),[g,y]=C([]),b=_();async function T(U){(U||!b.current)&&(b.current=e.v1.notifications.list({limit:xs,excludeTypes:["follow_request"]}));const J=await b.current.next(),D=J.value;if(D!=null&&D.length){D.forEach(ot=>{pt(ot.status,n,{skipThreading:!0})});const ct=rn(D);U?(I.notificationsLast=D[0],I.notifications=ct):I.notifications.push(...ct)}return I.notificationsShowNew=!1,I.notificationsLastFetchTime=Date.now(),J}function S(){return e.v1.followRequests.list({limit:80})}const v=()=>{s("loading"),(async()=>{try{const U=await S();f(U),s("default")}catch{s("error")}})()};function R(){return e.v1.announcements.list()}const x=U=>{s("loading"),(async()=>{try{const J=T(U),D=S(),ct=R();if(U){const tt=await ct;tt.sort((Tt,dt)=>{const gt=new Date(Tt.updatedAt||Tt.createdAt);return new Date(dt.updatedAt||dt.createdAt)-gt}),y(tt);const kt=await D;f(kt)}const{done:ot}=await J;r(!ot),s("default")}catch{s("error")}})()};z(()=>{x(!0)},[]),z(()=>{i&&x(!0)},[i]),z(()=>{u&&o&&x()},[u,o]);const L=_(!1),A=Xe(5e3),Y=ie(()=>{var U;l.settings.autoRefresh&&((U=a.current)==null?void 0:U.scrollTop)===0&&(!L.current||A)&&!Ls()&&l.notificationsShowNew&&c!=="loading"&&x(!0)},[A,l.notificationsShowNew,l.settings.autoRefresh,c]);z(Y,[l.notificationsShowNew]);const j=new Date,E=new Date(j-24*60*60*1e3);let P=new Date;const Q=!l.notifications.some(U=>new Date(U.createdAt).toDateString()===j.toDateString()),G=_();return t("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",onPointerEnter:()=>{L.current=!0},onPointerLeave:()=>{L.current=!1},children:t("div",{class:`timeline-deck deck ${l.settings.onlyMentions?"only-mentions":""}`,children:[t("header",{hidden:p,onClick:U=>{var J;U.target.closest("a, button")||(J=a.current)==null||J.scrollTo({top:0,behavior:"smooth"})},class:c==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Kt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),l.notificationsShowNew&&c!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var U;x(!0),(U=a.current)==null||U.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New notifications"]})]}),g.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",g.length>1?"s":""]})," ",t("small",{class:"insignificant",children:n})]}),g.length>1&&t("span",{class:"announcements-nav-buttons",children:g.map((U,J)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var D;(D=G.current)==null||D.children[J].scrollIntoView({behavior:"smooth",block:"nearest"})},children:J+1}))})]}),t("ul",{class:`announcements-list-${g.length>1?"multiple":"single"}`,ref:G,children:g.map(U=>t("li",{children:t(Rs,{announcement:U})}))})]})})}),d.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),d.length>5?t("details",{children:[t("summary",{children:[d.length," follow requests"]}),t("ul",{children:d.map(U=>t("li",{children:[t(Pt,{account:U}),t(fe,{accountID:U.id,onChange:()=>{}})]},U.id))})]}):t("ul",{children:d.map(U=>t("li",{children:[t(Pt,{account:U}),t(fe,{accountID:U.id,onChange:()=>{}})]},U.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:l.settings.onlyMentions,onChange:U=>{I.settings.onlyMentions=U.target.checked}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Q&&!!l.notifications.length&&t("p",{class:"ui-state insignificant",children:c==="default"?"You're all caught up.":t($,{children:"…"})}),l.notifications.length?t($,{children:l.notifications.map(U=>{if(l.settings.onlyMentions&&U.type!=="mention")return null;const J=new Date(U.createdAt),D=J.toDateString()!==P.toDateString();D&&(P=J);const ct=J.toDateString()===E.toDateString()?"Yesterday":Dt(P,{hideTime:!0});return t($,{children:[D&&t("h2",{class:"timeline-header",children:ct}),t(ln,{instance:n,notification:U,reload:()=>{x(!0),v()}},U.id)]})})}):t($,{children:[c==="loading"&&t($,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((U,J)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(w,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),c==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>x(!0),children:"Try again"})]})]}),o&&t("button",{type:"button",class:"plain block",disabled:c==="loading",onClick:()=>x(),style:{marginBlockEnd:"6em"},children:c==="loading"?t(ft,{abrupt:!0}):t($,{children:"Show more…"})})]})})}function Ls(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Rs({announcement:e}){const{instance:n}=W(),{contact:l}=vn(),c=l==null?void 0:l.account,{id:s,content:o,startsAt:r,endsAt:a,published:u,allDay:h,publishedAt:i,updatedAt:m,read:p,mentions:d,statuses:f,tags:g,emojis:y,reactions:b}=e,T=new Date(i),S=Dt(T),v=new Date(m),R=Dt(v);return t("div",{class:"announcement-block",children:[t(Pt,{account:c}),t("div",{class:"announcement-content",onClick:Fe({mentions:d,instance:n}),dangerouslySetInnerHTML:{__html:de(o,{emojis:y})}}),t("p",{class:"insignificant",children:[t("time",{datetime:T.toISOString(),children:Dt(T)}),m&&R!==S&&t($,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:v.toISOString(),children:Dt(v)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:b.map(x=>{const{name:L,count:A,me:Y,staticUrl:j,url:E}=x;return t("button",{type:"button",class:`plain4 small ${Y?"reacted":""}`,children:[E||j?t("img",{src:E||j,alt:L,width:"16",height:"16"}):t("span",{children:L})," ",t("span",{class:"count",children:Rt(A)})]})})})]})}const dn=Se($s),Ms=20;function pe({local:e,columnMode:n,...l}){const c=lt(I),s=!!e,o=n?{}:Ft(),{masto:r,instance:a}=W({instance:(l==null?void 0:l.instance)||o.instance}),u=`${s?"Local":"Federated"} timeline (${a})`;mt(u,s?"/:instance?/p/l":"/:instance?/p");const h=_(),i=_();async function m(d){(d||!i.current)&&(i.current=r.v1.timelines.listPublic({limit:Ms,local:s}));const f=await i.current.next();let{value:g}=f;return g!=null&&g.length&&(d&&(h.current=g[0].id),g=Et(g,"public"),g.forEach(y=>{pt(y,a)})),{...f,value:g}}async function p(){try{const d=await r.v1.timelines.listPublic({limit:1,local:s,since_id:h.current}).next();let{value:f}=d;return f=Et(f,"public"),!!(f!=null&&f.length)}catch{return!1}}return t(At,{title:u,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:s?"Local timeline":"Federated timeline"}),t("div",{children:a})]}),id:"public",instance:a,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:p,useItemID:!0,headerStart:t($,{}),boostsCarousel:c.settings.boostsCarousel,allowFilters:!0,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(et,{href:s?`/#/${a}/p`:`/#/${a}/p/l`,children:s?t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(Ct,{}),t(et,{onClick:()=>{let d=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(d)){d&&alert("Invalid instance");return}d&&(d=d.toLowerCase().trim(),location.hash=s?`/${d}/p/l`:`/${d}/p`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},a+s)}const As=20;function hn({columnMode:e,...n}){const l=lt(I),c=e?{}:Ft(),{masto:s,instance:o}=W({instance:(n==null?void 0:n.instance)||c.instance}),r=`Trending (${o})`;mt(r,"/:instance?/trending");const a=_(),[u,h]=C([]),i=_();async function m(f){if(f||!i.current){i.current=s.v1.trends.listStatuses({limit:As});try{const b=s.v1.trends.listTags(),{value:T}=await b.next();h(T)}catch{}}const g=await i.current.next();let{value:y}=g;return y!=null&&y.length&&(f&&(a.current=y[0].id),y=Et(y,"public"),y.forEach(b=>{pt(b,o)})),{...g,value:y}}async function p(){try{const f=await s.v1.trends.listStatuses({limit:1}).next();let{value:g}=f;return g=Et(g,"public"),g!=null&&g.length&&g[0].id!==a.current?(a.current=g[0].id,!0):!1}catch{return!1}}const d=ut(()=>u.length?t("div",{class:"filter-bar",children:[t(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((f,g)=>{const{name:y,history:b}=f,T=b.reduce((S,v)=>S+ +v.uses,0);return t(H,{to:`/${o}/t/${y}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),y]}),t("span",{class:"filter-count",children:T.toLocaleString()})]})})]}):null,[u]);return t(At,{title:r,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:"Trending"}),t("div",{children:o})]}),id:"trending",instance:o,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:p,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t($,{}),boostsCarousel:l.settings.boostsCarousel,allowFilters:!0,timelineStart:d,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(et,{onClick:()=>{let f=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(f)){f&&alert("Invalid instance");return}f&&(f=f.toLowerCase().trim(),location.hash=`/${f}/trending`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})})},o)}function Ds(){mt("Home","/");const e=lt(I),{shortcuts:n}=e,l=n.map(c=>{if(!c)return null;const{type:s,...o}=c,r={following:Ie,notifications:dn,list:cn,public:pe,bookmarks:nn,favourites:sn,hashtag:on,mentions:an,trending:hn}[s];return r?t(r,{...o,columnMode:!0},s+JSON.stringify(o)):null});return xt(["1","2","3","4","5","6","7","8","9"],(c,s)=>{try{const o=parseInt(s.keys[0],10)-1;document.querySelectorAll("#columns > *")[o].focus()}catch{}}),t("div",{id:"columns",children:l})}function Es(){var n;const e=lt(I);return z(()=>{(async()=>{const l=await Wt.drafts.keys();if(l.length){const c=qe();l.filter(o=>o.startsWith(c)).length&&(I.showDrafts=!0)}})()},[]),t($,{children:(e.settings.shortcutsColumnsMode||e.settings.shortcutsViewMode==="multi-column")&&((n=e.shortcuts)!=null&&n.length)?t(Ds,{}):t(Ie,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(Ns,{})})})}function Ns(){const e=lt(I),n=_(),[l,c]=C(void 0);return t($,{children:[t(H,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${l}`,onClick:s=>{s.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(s.preventDefault(),c(o=>o?void 0:"open"))},children:t(w,{icon:"notification",size:"l",alt:"Notifications"})}),t(Us,{state:l,anchorRef:n,onClose:()=>c(void 0)})]})}const _s=30,Ps=5;function Us({anchorRef:e,state:n,onClose:l}){const{masto:c,instance:s}=W(),o=lt(I),[r,a]=C("default"),u=c.v1.notifications.list({limit:_s});async function h(){const f=await u.next(),g=f.value;if(g!=null&&g.length){g.forEach(b=>{pt(b.status,s,{skipThreading:!0})});const y=rn(g);I.notificationsLast=g[0],I.notifications=y}return I.notificationsShowNew=!1,I.notificationsLastFetchTime=Date.now(),f}const[i,m]=C(!1);function p(){return c.v1.followRequests.list({limit:1})}function d(){a("loading"),(async()=>{try{await h();const f=await p();m(!!(f!=null&&f.length)),a("default")}catch{a("error")}})()}return z(()=>{n==="open"&&d()},[n]),t(Ke,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:l,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:o.notifications.length?t($,{children:o.notifications.slice(0,Ps).filter(f=>o.settings.onlyMentions?f.type==="mention":!0).map(f=>t(ln,{instance:s,notification:f},f.id))}):r==="loading"?t("div",{class:"ui-state",children:t(ft,{abrupt:!0})}):r==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:d,children:"Try again"})})]})}),t("footer",{children:[t(H,{to:"/mentions",class:"button plain",children:[t(w,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(H,{to:"/notifications",class:"button plain2",children:[i?t($,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(w,{icon:"arrow-right"})]})]})]})}const zs=Se(Es),Fs=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Bs=/\/notes\/([^\/]+)\/?$/i;function un(e){const{hostname:n,pathname:l}=new URL(e),[,c,s,o]=l.match(Fs)||[];if(o)return`/${n}/s/${o}`;const[,r]=l.match(Bs)||[];if(r)return`/${n}/s/${r}`}function Os(){const n=Ze().pathname.replace(/^\//,""),l=un(n);return Ht(()=>{l&&setTimeout(()=>{window.location.hash=l+"?view=full"},300)},[l]),t("div",{class:"ui-state",tabIndex:"-1",children:[l?t($,{children:[t("h2",{children:"Redirecting…"}),t("p",{children:t("a",{href:`#${l}?view=full`,children:l})})]}):t($,{children:[t("h2",{children:"Unable to process URL"}),t("p",{children:t("a",{href:n,target:"_blank",children:n})})]}),t("hr",{}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})}function qs(){const{masto:e}=W();mt("Lists","/l");const[n,l]=C("default"),[c,s]=se(h=>h+1,0),[o,r]=C([]);z(()=>{l("loading"),(async()=>{try{const h=await e.v1.lists.list();r(h),l("default")}catch{l("error")}})()},[c]);const[a,u]=C(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Kt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>u(!0),children:t(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:o.length>0?t("ul",{class:"link-list",children:o.map(h=>t("li",{children:t(H,{to:`/l/${h.id}`,children:t("span",{children:[t(w,{icon:"list"})," ",t("span",{children:h.title})]})})}))}):n==="loading"?t("p",{class:"ui-state",children:t(ft,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),a&&t(vt,{class:"light",onClick:h=>{h.target===h.currentTarget&&u(!1)},children:t(ke,{list:a==null?void 0:a.list,onClose:h=>{h.state==="success"&&s(),u(!1)}})})]})}const Hs="/phanpy/assets/instances-48462af0.json",{VITE_CLIENT_NAME:Vs,VITE_WEBSITE:js}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"/phanpy/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};async function Ws({instanceURL:e}){const n=new URLSearchParams({client_name:Vs,redirect_uris:location.origin+location.pathname,scopes:"read write follow",website:js});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Gs({instanceURL:e,client_id:n}){const l=new URLSearchParams({client_id:n,scope:"read write follow",redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${l.toString()}`}async function Js({instanceURL:e,client_id:n,client_secret:l,code:c}){const s=new URLSearchParams({client_id:n,client_secret:l,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:c,scope:"read write follow"});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()})).json()}function Ks(){mt("Log in");const e=_(),n=X.local.get("instanceURL"),[l,c]=C("default"),[s,o]=C((n==null?void 0:n.toLowerCase())||""),[r,a]=C([]);z(()=>{(async()=>{try{const p=await(await fetch(Hs)).json();a(p)}catch{}})()},[]);const u=m=>{X.local.set("instanceURL",m),(async()=>{c("loading");try{const{client_id:p,client_secret:d}=await Ws({instanceURL:m});p&&d?(X.session.set("clientID",p),X.session.set("clientSecret",d),location.href=await Gs({instanceURL:m,client_id:p})):alert("Failed to register application"),c("default")}catch{c("error")}})()},h=m=>{m.preventDefault();const{elements:p}=m.target;let d=p.instanceURL.value.toLowerCase();d=d.replace(/^https?:\/\//,"").replace(/\/+$/,""),d=d.replace(/^@?[^@]+@/,""),/\./.test(d)||(d=r.find(f=>f.includes(d))),u(d)},i=s?r.filter(m=>m.includes(s)).sort((m,p)=>{const d=m.toLowerCase().startsWith(s.toLowerCase()),f=p.toLowerCase().startsWith(s.toLowerCase());return d&&!f?-1:!d&&f?1:0}).slice(0,10):[];return t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:h,children:[t("h1",{children:"Log in"}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:s,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:l==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:m=>{o(m.target.value)}}),(i==null?void 0:i.length)>0?t("ul",{id:"instances-suggestions",children:i.map(m=>t("li",{children:t("button",{type:"button",class:"plain4",onClick:()=>{u(m)},children:m})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),l==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{class:"large",disabled:l==="loading",children:"Log in"})," "]}),t(ft,{hidden:l!=="loading"}),t("hr",{}),t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})})}const Xt=5,re=40;function Ys(e){const n=Ft(),{masto:l,instance:c,authenticated:s}=W({instance:n.instance}),[o,r]=C("default"),[a]=Bt(),u=_(),h=(e==null?void 0:e.query)||a.get("q"),i=(e==null?void 0:e.type)||a.get("type");mt(h?`Search: ${h}${i?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[i]})`:""}`:"Search","/search");const[m,p]=C(!1),d=_(0);z(()=>{d.current=0},[h,i]);const f=_();Ht(()=>{var L,A;(A=(L=f.current)==null?void 0:L.scrollTo)==null||A.call(L,0,0)},[h,i]);const[g,y]=C([]),[b,T]=C([]),[S,v]=C([]);z(()=>{y([]),T([]),v([])},[h]);const R={statuses:y,accounts:T,hashtags:v};function x(L){r("loading"),L&&!i&&(y(g.slice(0,Xt)),T(b.slice(0,Xt)),v(S.slice(0,Xt))),(async()=>{var Y,j;const A={q:h,resolve:s,limit:Xt};i&&(A.limit=re,A.type=i,A.offset=d.current);try{const E=await l.v2.search(A);if(i)if(L){R[i](E[i]);const P=(Y=E[i])==null?void 0:Y.length;d.current=re,p(!!P)}else{R[i](Q=>[...Q,...E[i]]);const P=(j=E[i])==null?void 0:j.length;d.current=d.current+re,p(!!P)}else y(E.statuses),T(E.accounts),v(E.hashtags),d.current=0,p(!1);r("default")}catch{r("error")}})()}return z(()=>{var L,A;h&&((A=(L=u.current)==null?void 0:L.setValue)==null||A.call(L,h),x(!0))},[h,i,c]),t("div",{id:"search-page",class:"deck-container",ref:f,children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(Kt,{})}),t(Xs,{ref:u}),t("div",{class:"header-side",children:" "})]})}),t("main",{children:[!!h&&t("div",{class:"filter-bar",children:[!!i&&t(H,{to:`/search${h?`?q=${h}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${h}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${h}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${h}&type=statuses`}].sort((L,A)=>L.type===i?-1:A.type===i?1:0).map(L=>t(H,{to:L.to,children:L.label}))]}),h?t($,{children:[(!i||i==="accounts")&&t($,{children:[i!=="accounts"&&t("h2",{class:"timeline-header",children:"Accounts"}),b.length>0?t($,{children:[t("ul",{class:"timeline flat accounts-list",children:b.map(L=>t("li",{children:t(Pt,{account:L,instance:c,showStats:!0})},L.id))}),i!=="accounts"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${h}&type=accounts`,children:["See more accounts ",t(w,{icon:"arrow-right"})]})})]}):!i&&(o==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!i||i==="hashtags")&&t($,{children:[i!=="hashtags"&&t("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?t($,{children:[t("ul",{class:"link-list hashtag-list",children:S.map(L=>t("li",{children:t(H,{to:c?`/${c}/t/${L.name}`:`/t/${L.name}`,children:[t(w,{icon:"hashtag"}),t("span",{children:L.name})]})},L.name))}),i!=="hashtags"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${h}&type=hashtags`,children:["See more hashtags ",t(w,{icon:"arrow-right"})]})})]}):!i&&(o==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!i||i==="statuses")&&t($,{children:[i!=="statuses"&&t("h2",{class:"timeline-header",children:"Posts"}),g.length>0?t($,{children:[t("ul",{class:"timeline",children:g.map(L=>t("li",{children:t(H,{class:"status-link",to:c?`/${c}/s/${L.id}`:`/s/${L.id}`,children:t(wt,{status:L})})},L.id))}),i!=="statuses"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${h}&type=statuses`,children:["See more posts ",t(w,{icon:"arrow-right"})]})})]}):!i&&(o==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!i&&(o==="default"?m?t(oe,{onChange:L=>{L&&x()},children:t("button",{type:"button",class:"plain block",onClick:()=>x(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):o==="loading"&&t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}))]}):o==="loading"?t("p",{class:"ui-state",children:t(ft,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Xs=_n((e,n)=>{const{instance:l}=W(),[c,s]=Bt(),[o,r]=C(!1),[a,u]=C(c.get("q")||""),h=c.get("type"),i=_(null),m=_(null);return Pn(n,()=>({setValue:p=>{u(p)},focus:()=>{m.current.focus()}})),t("form",{ref:i,class:"search-popover-container",onSubmit:p=>{if(p.preventDefault(),a){const d={q:a};h&&(d.type=h),s(d)}else s({})},children:[t("input",{ref:m,value:a,name:"q",type:"search",placeholder:"Search",dir:"auto",onSearch:p=>{p.target.value||s({})},onInput:p=>{u(p.target.value),r(!0)},onFocus:()=>{r(!0)},onBlur:()=>{var p,d;setTimeout(()=>{r(!1)},100),(d=(p=i.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||d.classList.remove("focus")},onKeyDown:p=>{const{key:d}=p;switch(d){case"Escape":r(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),o){const f=i.current.querySelector(".search-popover-item.focus");if(f){let g=f.nextElementSibling;for(;g&&g.hidden;)g=g.nextElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(b=>b!==g).forEach(b=>{b.classList.remove("focus")}))}else{const g=i.current.querySelector(".search-popover-item");g&&g.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),o){const f=document.querySelector(".search-popover-item.focus");if(f){let g=f.previousElementSibling;for(;g&&g.hidden;)g=g.previousElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(b=>b!==g).forEach(b=>{b.classList.remove("focus")}))}else{const g=document.querySelector(".search-popover-item:last-child");g&&g.classList.add("focus")}}break;case"Enter":if(o){const f=document.querySelector(".search-popover-item.focus");f&&(p.preventDefault(),f.click()),r(!1)}break}}}),t("div",{class:"search-popover",hidden:!o||!a,children:!!a&&[{label:t($,{children:["Posts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=statuses`,hidden:/^https?:/.test(a)},{label:t($,{children:["Posts tagged with ",t("mark",{children:["#",a.replace(/^#/,"")]})]}),to:`/${l}/t/${a.replace(/^#/,"")}`,hidden:/^@/.test(a)||/^https?:/.test(a)||/\s/.test(a),top:/^#/.test(a),type:"link"},{label:t($,{children:["Look up ",t("mark",{children:a})]}),to:`/${a}`,hidden:!/^https?:/.test(a),top:/^https?:/.test(a),type:"link"},{label:t($,{children:["Accounts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=accounts`}].sort((p,d)=>p.top&&!d.top?-1:!p.top&&d.top?1:0).map(({label:p,to:d,hidden:f,type:g})=>t(H,{to:d,class:"search-popover-item",hidden:f,children:[t(w,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),t("span",{children:p})," "]}))})]})});const fn="/phanpy/assets/logo-f0531a6b.svg",Ue=16,_t=[16,17,18,19,20];function Zs({onClose:e}){const n=lt(I),l=X.local.get("theme")||"auto",c=_(),s=n.settings.contentTranslationTargetLanguage||null,o=Sn(),r=kn(o),a=X.local.get("textSize")||Ue,[u,h]=C(X.account.get("preferences")||{});return t("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Settings"})}),t("main",{children:[t("section",{children:t("ul",{children:[t("li",{children:[t("div",{children:t("label",{children:"Appearance"})}),t("div",{children:t("form",{ref:c,onInput:i=>{i.preventDefault();const p=new FormData(c.current).get("theme"),d=document.documentElement;p==="auto"?d.classList.remove("is-light","is-dark"):(d.classList.toggle("is-light",p==="light"),d.classList.toggle("is-dark",p==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",p==="auto"?"dark light":p),p==="auto"?X.local.del("theme"):X.local.set("theme",p)},children:t("div",{class:"radio-group",children:[t("label",{children:[t("input",{type:"radio",name:"theme",value:"light",defaultChecked:l==="light"}),t("span",{children:"Light"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"dark",defaultChecked:l==="dark"}),t("span",{children:"Dark"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"auto",defaultChecked:l!=="light"&&l!=="dark"}),t("span",{children:"Auto"})]})]})})})]}),t("li",{children:[t("div",{children:t("label",{children:"Text size"})}),t("div",{class:"range-group",children:[t("span",{style:{fontSize:_t[0]},children:"A"})," ",t("input",{type:"range",min:_t[0],max:_t[_t.length-1],step:"1",value:a,list:"sizes",onChange:i=>{const m=parseInt(i.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===Ue?X.local.del("textSize"):X.local.set("textSize",i.target.value)}})," ",t("span",{style:{fontSize:_t[_t.length-1]},children:"A"}),t("datalist",{id:"sizes",children:_t.map(i=>t("option",{value:i}))})]})]})]})}),t("h3",{children:"Posting"}),t("section",{children:t("ul",{children:t("li",{children:[t("div",{children:t("label",{for:"posting-privacy-field",children:"Default visibility"})}),t("div",{children:t("select",{id:"posting-privacy-field",value:u["posting:default:visibility"]||"public",onChange:i=>{const{value:m}=i.target,{masto:p}=W();(async()=>{try{await p.v1.accounts.updateCredentials({source:{privacy:m}}),h({...u,"posting:default:visibility":m}),X.account.set("preferences",{...u,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[t("option",{value:"public",children:"Public"}),t("option",{value:"unlisted",children:"Unlisted"}),t("option",{value:"private",children:"Followers only"})]})})]})})}),t("h3",{children:"Experiments"}),t("section",{children:t("ul",{children:[t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:i=>{I.settings.autoRefresh=i.target.checked}})," ","Auto refresh timeline posts"]})}),t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:i=>{I.settings.boostsCarousel=i.target.checked}})," ","Boosts carousel"]})}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:i=>{const{checked:m}=i.target;I.settings.contentTranslation=m,m||(I.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),t("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[t("div",{children:t("label",{children:["Translate to"," ",t("select",{value:s||"",disabled:!n.settings.contentTranslation,onChange:i=>{I.settings.contentTranslationTargetLanguage=i.target.value||null},children:[t("option",{value:"",children:["System language (",r,")"]}),t("option",{disabled:!0,children:"──────────"}),xe.map(i=>t("option",{value:i.code,children:i.name}))]})]})}),t("hr",{}),t("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&t($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",t("div",{class:"checkbox-fields",children:xe.map(i=>t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(i.code),onChange:m=>{const{checked:p}=m.target;p?I.settings.contentTranslationHideLanguages.push(i.code):I.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(d=>d!==i.code)}})," ",i.name]}))})]}),t("p",{class:"insignificant",children:t("small",{children:["Note: This feature uses an external API to translate, powered by"," ",t("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",children:"Lingva Translate"}),"."]})}),t("hr",{}),t("div",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:i=>{I.settings.contentTranslationAutoInline=i.target.checked}})," ","Auto inline translation"]}),t("p",{class:"insignificant",children:t("small",{children:["Automatically show translation for posts in timeline. Only works for ",t("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:i=>{I.settings.cloakMode=i.target.checked}})," ","Cloak mode"," ",t("span",{class:"insignificant",children:["(",t("samp",{children:"Text"})," → ",t("samp",{children:"████"}),")"]})]}),t("div",{class:"sub-section insignificant",children:t("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),t("li",{children:t("button",{type:"button",class:"light",onClick:()=>{I.showDrafts=!0,I.showSettings=!1},children:"Unsent drafts"})})]})}),t("h3",{children:"About"}),t("section",{children:[t("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[t("img",{src:fn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),t("div",{children:[t("b",{children:"Phanpy"})," ",t("a",{href:"https://hachyderm.io/@phanpy",onClick:i=>{i.preventDefault(),I.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),t("br",{}),t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",onClick:i=>{i.preventDefault(),I.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),t("p",{children:t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"})}),t("p",{children:[t("span",{class:"insignificant",children:"Last build:"})," ",t(ve,{datetime:new Date("2023-08-30T01:56:44.191Z")})," ",t($,{children:["(",t("a",{href:"https://github.com/cheeaun/phanpy/commit/c645553",target:"_blank",children:t("code",{children:"c645553"})}),")"]})]})]})]})]})}const Zt=40,Qs=10,ti=5;let me={},te={};function ge(e){delete te[e],delete I.scrollPositions[e]}function ei(e){const{id:n}=e,{masto:l,instance:c}=W({instance:e.instance}),s=lt(I),[o,r]=Bt(),a=o.get("media"),u=o.get("media-only"),h=parseInt(a||u,10);let i=h>0;const m=o.get("mediaStatusID"),p=We(m,c);m&&!p&&(i=!1);const d=i&&!!u,f=ye(n,c),[g,y]=C(I.statuses[f]);z(()=>{I.statuses[f]&&y(I.statuses[f])},[f]);const b=ut(()=>{const{prevLocation:S}=I,v=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),R=ee("/:instance/s/:id",v)||ee("/s/:id",v);return!v||R?"/":v},[]);z(()=>{!g&&i&&(async()=>{try{const S=await l.v1.statuses.fetch(n);pt(S,c),y(S)}catch{alert("Unable to load post."),location.hash=b}})()},[i]);const T=m?p==null?void 0:p.mediaAttachments:g==null?void 0:g.mediaAttachments;return t("div",{class:"deck-backdrop",children:[i?T!=null&&T.length?t(tn,{mediaAttachments:T,statusID:m||n,instance:c,index:h-1,onClose:()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&s.prevLocation?history.back():d?location.hash=b:(o.delete("media"),o.delete("mediaStatusID"),r(o))}}):t("div",{class:"media-modal-container loading",children:t(ft,{abrupt:!0})}):t(H,{to:b}),!d&&t(ni,{id:n,instance:e.instance,closeLink:b})]})}function ni({id:e,closeLink:n="/",instance:l}){var M;const[c,s]=Bt(),o=c.get("media"),r=parseInt(o,10)>0,[a,u]=C(c.get("view")),h=!!parseInt(c.get("translate")),{masto:i,instance:m}=W({instance:l}),{masto:p,instance:d,authenticated:f}=W(),g=m===d,y=lt(I),[b,T]=C([]),[S,v]=C("default"),R=_(),x=ye(e,m),L=_(0),A=_();z(()=>{var k;(k=A.current)==null||k.focus()},[]),z(()=>{var N;const k=Un(()=>{if(!A.current)return;const{scrollTop:B}=A.current;S!=="loading"&&(I.scrollPositions[e]=B)},50);return(N=A.current)==null||N.addEventListener("scroll",k,{passive:!0}),k(),()=>{var B;k.cancel(),(B=A.current)==null||B.removeEventListener("scroll",k)}},[e,S!=="loading"]);const Y=_(),j=({reloadHero:k}={})=>{v("loading");let N;const B=te[e];if(B){const K=B.filter(Z=>I.statuses[x]);T(K)}else T([{id:e}]);return(async()=>{var nt,Lt;const K=()=>Ae(()=>i.v1.statuses.fetch(e),{retries:4}),Z=Ae(()=>i.v1.statuses.fetchContext(e),{retries:8}),q=!!y.statuses[x];let F=y.statuses[x];if(!(q&&!k))try{F=await K(),pt(F,m),await new Promise(st=>{setTimeout(st,100)})}catch{v("error");return}try{let st=function(V){return V==null?void 0:V.map(ht=>({id:ht.id,account:ht.account,repliesCount:ht.repliesCount,content:ht.content,weight:Gt(ht),replies:st(ht.__replies)}))};const rt=await Z,{ancestors:bt,descendants:$t}=rt;L.current=($t==null?void 0:$t.length)||0;const Nt=new Set;bt.forEach(V=>{pt(V,m,{skipThreading:!0}),V.inReplyToId&&!bt.find(ht=>ht.id===V.inReplyToId)&&Nt.add(V.inReplyToId)});const ae=bt.every(V=>V.account.id===F.account.id),Ot=[];$t.forEach(V=>{if(pt(V,m,{skipThreading:!0}),V.inReplyToId&&!$t.find(ht=>ht.id===V.inReplyToId)&&V.inReplyToId!==F.id&&Nt.add(V.inReplyToId),V.inReplyToAccountId===V.account.id)Ot.push(V);else if(V.inReplyToId===F.id)Ot.push(V);else if(!V.inReplyToAccountId&&Ot.find(ht=>ht.id===V.inReplyToId)&&V.account.id===F.account.id)Ot.push(V);else{const ht=$t.find(mn=>mn.id===V.inReplyToId);ht&&(ht.__replies||(ht.__replies=[]),ht.__replies.push(V))}}),Nt.size;const Vt=[...bt.map(V=>({id:V.id,ancestor:!0,isThread:ae,accountID:V.account.id,account:V.account,repliesCount:V.repliesCount,weight:Gt(V)})),{id:e,accountID:F.account.id,weight:Gt(F)},...Ot.map(V=>({id:V.id,account:V.account,accountID:V.account.id,descendant:!0,thread:V.account.id===F.account.id,weight:Gt(V),replies:st(V.__replies)}))];v("default"),Y.current={offsetTop:(nt=R.current)==null?void 0:nt.offsetTop,scrollTop:(Lt=A.current)==null?void 0:Lt.scrollTop};const Te=Vt.findIndex(V=>V.id===e);Te>=J&&D(Te+1),T(Vt),te[e]=Vt,In(F,m)}catch{v("error")}})(),()=>{clearTimeout(N)}};z(j,[e,i]),z(()=>{var N,B;if(!b.length)return;const k=y.scrollPositions[e];if(k)A.current.scrollTop=k;else if(Y.current){const K={offsetTop:(N=R.current)==null?void 0:N.offsetTop,scrollTop:(B=A.current)==null?void 0:B.scrollTop},Z=K.offsetTop-Y.current.offsetTop+K.scrollTop;A.current.scrollTop=Z}else b.length===1&&(A.current.scrollTop=0);Y.current=null},[b]),z(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:k}=Ge(),N=`https://${k}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(N,{ignoreVary:!0}),j({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),z(()=>()=>{I.scrollPositions={},I.reloadStatusPage=0,te={},me={},be.clear()},[]);const E=y.statuses[x]||y.statuses[e],P=ut(()=>{if(!E)return"";const{account:k}=E,N=document.createElement("div");return N.innerHTML=k.displayName,N.innerText.trim()},[E]),Q=ut(()=>{if(!E)return"";let k=je(E);return k.length>64&&(k=k.slice(0,64)+"…"),k},[E]);mt(P&&Q?`${P}: "${Q}"`:"Status","/:instance?/s/:id");const G=ut(()=>{if(!E)return;const{url:k}=E;if(k)return new URL(k).hostname},[E]),U=ut(()=>{if(G)return G===m},[G,m]),[J,D]=C(Zt),ct=ut(()=>b.length-J,[b.length,J]),ot=b.some(k=>k.descendant),tt=b.filter(k=>k.ancestor),[kt,Tt]=C(!0),dt=Ye(Tt,100),gt=ut(()=>{if(!R.current||kt)return null;const{top:k}=R.current.getBoundingClientRect();return k>0?"down":"up"},[kt]);xt("esc",()=>{location.hash=n},{enabled:!r}),xt("backspace",()=>{location.hash=n}),xt("j",()=>{var K,Z;const k=document.activeElement.closest(".status-link, .status-focus"),N=k==null?void 0:k.getBoundingClientRect(),B=Array.from(A.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(k&&N.top<A.current.clientHeight&&N.bottom>0){const q=B.indexOf(k);let F=B[q+1];F&&(F.focus(),(K=F.scrollIntoViewIfNeeded)==null||K.call(F))}else{const q=B.find(F=>{const nt=F.getBoundingClientRect();return nt.top>=44&&nt.left>=0});q&&(q.focus(),(Z=q.scrollIntoViewIfNeeded)==null||Z.call(q))}}),xt("k",()=>{var K,Z;const k=document.activeElement.closest(".status-link, .status-focus"),N=k==null?void 0:k.getBoundingClientRect(),B=Array.from(A.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(k&&N.top<A.current.clientHeight&&N.bottom>0){const q=B.indexOf(k);let F=B[q-1];F&&(F.focus(),(K=F.scrollIntoViewIfNeeded)==null||K.call(F))}else{const q=B.find(F=>{const nt=F.getBoundingClientRect();return nt.top>=44&&nt.left>=0});q&&(q.focus(),(Z=q.scrollIntoViewIfNeeded)==null||Z.call(q))}}),xt("x",()=>{const k=document.activeElement.closest(".status-link, .status-focus");if(k){const N=k.nextElementSibling;N&&N.tagName.toLowerCase()==="details"&&(N.open=!N.open)}});const{nearReachStart:It}=ce({scrollableRef:A,distanceFromStartPx:16}),St=_(r?"media+status":"status"),O=ie((k,N,B,K)=>{k.preventDefault(),k.stopPropagation(),s({media:N+1,mediaStatusID:K.id})},[e]);return t("div",{tabIndex:"-1",ref:A,class:`status-deck deck contained ${b.length>1?"padded-bottom":""} ${St.current==="status"?"slide-in":""} ${a?`deck-view-${a}`:""}`,onAnimationEnd:k=>{St.current==="status"&&(St.current=null)},children:[t("header",{class:`${kt?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:k=>{I.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[!!/\/s\//i.test((M=y.prevLocation)==null?void 0:M.pathname)&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(w,{icon:"chevron-left",size:"xl"})}),!kt&&E&&S!=="loading"?t($,{children:[t("span",{class:"hero-heading",children:[t(we,{account:E.account,instance:m,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(ve,{datetime:E.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:k=>{k.preventDefault(),k.stopPropagation(),R.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(w,{icon:gt==="down"?"arrow-down":"arrow-up"})})]}):t($,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:k=>{k.preventDefault(),k.stopPropagation(),A.current.scrollTo({top:0,behavior:"smooth"})},hidden:!tt.length||It,title:`${tt.length} posts above ‒ Go to top`,children:[t(w,{icon:"arrow-up"}),tt.filter((k,N,B)=>B.findIndex(K=>K.accountID===k.accountID)===N).slice(0,3).map(k=>t(Ut,{url:k.account.avatar,alt:k.account.displayName},k.account.id)),tt.length>3&&t($,{children:[" ",t("span",{class:"insignificant",children:Rt(tt.length)})]})]})]})]}),t("div",{class:"header-side",children:[t(zt,{align:"end",portal:{target:A.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(et,{disabled:S==="loading",onClick:()=>{I.reloadStatusPage++},children:[t(w,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(et,{className:"menu-switch-view",onClick:()=>{u(a==="full"?null:"full"),c.delete("media"),c.delete("media-only"),a==="full"?c.delete("view"):c.set("view","full"),s(c)},children:[t(w,{icon:{"":"layout5",full:"layout4"}[a||""]}),t("span",{children:["Switch to ",a==="full"?"Side Peek":"Full"," view"]})]}),t(et,{onClick:()=>{Array.from(A.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(N=>{N.click()})},children:[t(w,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(Ct,{}),t(zn,{className:"plain",children:"Experimental"}),t(et,{disabled:U,onClick:()=>{const k=un(E.url);k?location.hash=k:alert("Unable to switch")},children:[t(w,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance (",t("b",{children:G}),")"]})]})]}),t(H,{class:"button plain deck-close",to:n,children:t(w,{icon:"x",size:"xl"})})]})]})}),b.length&&E?t("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[b.slice(0,J).map(k=>{const{id:N,ancestor:B,isThread:K,descendant:Z,thread:q,replies:F,repliesCount:nt,weight:Lt}=k,st=N===e;return t("li",{ref:st?R:null,class:`${B?"ancestor":""} ${Z?"descendant":""} ${q?"thread":""} ${st?"hero":""}`,children:[st?t($,{children:[t(oe,{threshold:.1,onChange:dt,class:"status-focus",tabIndex:0,children:t(wt,{statusID:N,instance:m,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:h})}),S!=="loading"&&!f?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(H,{to:"/login",class:"button",children:"Log in"})]}):!g&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:m}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:S==="loading",onClick:()=>{v("loading"),(async()=>{try{const rt=await p.v2.search({q:E.url,type:"statuses",resolve:!0,limit:1});if(rt.statuses.length){const bt=rt.statuses[0];location.hash=d?`/${d}/s/${bt.id}`:`/s/${bt.id}`}else throw new Error("No results")}catch(rt){v("default"),alert("Error: "+rt)}})()},children:[t(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(H,{class:"status-link",to:m?`/${m}/s/${N}`:`/s/${N}`,onClick:()=>{ge(N)},children:[t(wt,{statusID:N,instance:m,withinContext:!0,size:q||B?"m":"s",enableTranslate:!0,onMediaClick:O,onStatusLinkClick:()=>{ge(N)}}),B&&K&&nt>1&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:nt,children:Rt(nt)})]})," "]}),Z&&(F==null?void 0:F.length)>0&&t(pn,{instance:m,replies:F,hasParentThread:q,level:1,accWeight:Lt,openAll:L.current<Qs}),S==="loading"&&st&&!!(E!=null&&E.repliesCount)&&!ot&&t("div",{class:"status-loading",children:t(ft,{})}),S==="error"&&st&&!!(E!=null&&E.repliesCount)&&!ot&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{I.reloadStatusPage++},children:"Try again"})]})]},N)}),ct>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>D(k=>k+Zt),style:{marginBlockEnd:"6em"},children:[t("div",{class:"ib",children:b.slice(J,J+5).map(k=>t(Ut,{url:k.account.avatarStatic},k.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:ct>Zt?`${Zt}+`:ct})]})]})})]}):t($,{children:[S==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(wt,{skeleton:!0,size:"l"})})}),S==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{I.reloadStatusPage++},children:"Try again"})]})]})]})}function pn({replies:e,instance:n,hasParentThread:l,level:c,accWeight:s,openAll:o}){const[r,a]=Bt(),u=b=>b.reduce((T,S)=>{const{repliesCount:v,replies:R}=S,x=(R==null?void 0:R.length)||v;return T+x+u(R||[])},0),h=e.length+u(e),i=e.length===h,m=e.map(b=>b.account).filter((b,T,S)=>S.findIndex(v=>v.id===b.id)===T).slice(0,3),p=ut(()=>e==null?void 0:e.reduce((b,T)=>b+(T==null?void 0:T.weight),s),[s,e==null?void 0:e.length]);let d=!1;(o||p<=ti||!l&&h===1&&Gt(e[0])<2)&&(d=!0);const f=me[e[0].id],g=ie((b,T,S,v)=>{b.preventDefault(),b.stopPropagation(),a({media:T+1,mediaStatusID:v.id})},[]),y=_();return Ht(()=>{var T;function b(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(T=y.current)==null||T.addEventListener("scroll",b,{passive:!0}),()=>{var S;(S=y.current)==null||S.removeEventListener("scroll",b)}},[]),t("details",{ref:y,class:"replies",open:f||d,onToggle:b=>{const{open:T}=b.target;me[e[0].id]=T},style:{"--comments-level":c},"data-comments-level":c,"data-comments-level-overflow":c>4,children:[t("summary",{class:"replies-summary",hidden:d,children:[t("span",{class:"avatars",children:m.map(b=>t(Ut,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),t("span",{children:[t("span",{title:e.length,children:Rt(e.length)})," ","repl",e.length===1?"y":"ies"]}),!i&&h>1&&t($,{children:[" ","·"," ",t("span",{children:[t("span",{title:h,children:Rt(h)})," ","comment",h===1?"":"s"]})]})]}),t("ul",{children:e.map(b=>{var T,S;return t("li",{children:[t(H,{class:"status-link",to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{ge(b.id)},children:[t(wt,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((T=b.replies)!=null&&T.length)&&b.repliesCount>0&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:b.repliesCount,children:Rt(b.repliesCount)})]})]}),((S=b.replies)==null?void 0:S.length)&&t(pn,{instance:n,replies:b.replies,level:c+1,accWeight:d?p:b.weight,openAll:o})]},b.id)})})]})}const si=140,ii=35,oi=70,ci=140,be=new Map;function Gt(e){var d,f;const n=be.get(e.id);if(n)return n;const{spoilerText:l,content:c,mediaAttachments:s,poll:o,card:r}=e,a=Tn(l+c),u=s!=null&&s.length?si:0,h=(((d=o==null?void 0:o.options)==null?void 0:d.length)||0)*ii,i=r&&(s!=null&&s.length||(f=o==null?void 0:o.options)!=null&&f.length)?0:oi,p=(a+u+h+i)/ci;return be.set(e.id,p),p}const ai=Se(ei);const li="/phanpy/assets/boosts-carousel-c271525c.jpg",ri="/phanpy/assets/grouped-notifications-3dcc5ef2.jpg",di="/phanpy/assets/multi-column-962e6b3c.jpg",hi="/phanpy/assets/multi-hashtag-timeline-24789e5e.jpg",ui="/phanpy/assets/nested-comments-thread-38ddecea.jpg",fi="/phanpy/assets/logo-text-810e685b.svg";function ze(){return mt(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("h1",{children:[t("img",{src:fn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:fi,alt:"Phanpy",width:"250"})]}),t("p",{children:t("big",{children:t("b",{children:t(H,{to:"/login",class:"button",children:"Log in"})})})}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:li,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:ui,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:ri,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:di,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:hi,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),t("hr",{}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),I.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}window.__STATES__=I;setTimeout(()=>{var e,n,l,c;for(const s in Yt)Array.isArray(Yt[s])?(n=(e=Yt[s])[0])==null||n.call(e):(c=(l=Yt)[s])==null||c.call(l)},5e3);function pi(){var d,f,g,y,b,T,S;const e=lt(I),[n,l]=C(!1),[c,s]=C("loading"),o=Je();Ht(()=>{const v=X.local.get("theme");v&&(document.documentElement.classList.add(`is-${v}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",v==="auto"?"dark light":v));const R=X.local.get("textSize");R&&document.documentElement.style.setProperty("--text-size",`${R}px`)},[]),z(()=>{const v=X.local.get("instanceURL"),R=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(R){const x=X.session.get("clientID"),L=X.session.get("clientSecret");(async()=>{s("loading");const{access_token:A}=await Js({instanceURL:v,client_id:x,client_secret:L,code:R}),Y=Cn({instance:v,accessToken:A});await Promise.allSettled([$e(Y,v),xn(Y,v,A)]),Le(Y),l(!0),s("default")})()}else{const x=Ge();if(x){X.session.set("currentAccount",x.info.id);const{masto:L,instance:A}=W({account:x});Le(L),s("loading"),(async()=>{try{await $e(L,A)}catch{}finally{l(!0),s("default")}})()}else s("default")}},[]);let r=Ze();I.currentLocation=r.pathname;const a=()=>{let v=setTimeout(()=>{if(!document.getElementById("columns")){if(document.querySelector(".deck-backdrop"))return;const L=document.querySelectorAll(".deck-container"),A=L[L.length-1];A&&A.tabIndex===-1&&A.focus()}},100);return()=>clearTimeout(v)};z(a,[r]);const u=e.showCompose||e.showSettings||e.showAccounts||e.showAccount||e.showDrafts||e.showMediaModal||e.showShortcutsSettings;z(()=>{u||a()},[u]);const{prevLocation:h}=e,i=_(h||null);if(ee("/:instance/s/:id",r.pathname)||ee("/s/:id",r.pathname)?i.current||(i.current=h):i.current=null,/\/https?:/.test(r.pathname))return t(Os,{});const p=ut(()=>{const{pathname:v}=r;return!/^\/(login|welcome)/.test(v)},[r]);return z(()=>{const v=document.getElementById("app");v&&(v.dataset.shortcutsViewMode=e.settings.shortcutsViewMode)},[e.settings.shortcutsViewMode]),z(()=>{document.body.classList.toggle("cloak",e.settings.cloakMode)},[e.settings.cloakMode]),t($,{children:[t(le,{location:p||r,children:[t(at,{path:"/",element:n?t(zs,{}):c==="loading"?t(ft,{id:"loader-root"}):t(ze,{})}),t(at,{path:"/login",element:t(Ks,{})}),t(at,{path:"/welcome",element:t(ze,{})})]}),t(le,{location:i.current||r,children:[n&&t(at,{path:"/notifications",element:t(dn,{})}),n&&t(at,{path:"/mentions",element:t(an,{})}),n&&t(at,{path:"/following",element:t(Ie,{})}),n&&t(at,{path:"/b",element:t(nn,{})}),n&&t(at,{path:"/f",element:t(sn,{})}),n&&t(at,{path:"/l",children:[t(at,{index:!0,element:t(qs,{})}),t(at,{path:":id",element:t(cn,{})})]}),n&&t(at,{path:"/ft",element:t(gs,{})}),t(at,{path:"/:instance?/t/:hashtag",element:t(on,{})}),t(at,{path:"/:instance?/a/:id",element:t(hs,{})}),t(at,{path:"/:instance?/p",children:[t(at,{index:!0,element:t(pe,{})}),t(at,{path:"l",element:t(pe,{local:!0})})]}),t(at,{path:"/:instance?/trending",element:t(hn,{})}),t(at,{path:"/:instance?/search",element:t(Ys,{})})]}),c==="default"&&t(le,{children:t(at,{path:"/:instance?/s/:id",element:t(gi,{})})}),n&&t("button",{type:"button",id:"compose-button",onClick:v=>{v.shiftKey?$n()||(alert("Looks like your browser is blocking popups."),I.showCompose=!0):I.showCompose=!0},children:t(w,{icon:"quill",size:"xl",alt:"Compose"})}),n&&!e.settings.shortcutsColumnsMode&&e.settings.shortcutsViewMode!=="multi-column"&&t(is,{}),!!e.showCompose&&t(vt,{children:t(Ln,{replyToStatus:typeof e.showCompose!="boolean"?e.showCompose.replyToStatus:((d=window.__COMPOSE__)==null?void 0:d.replyToStatus)||null,editStatus:((f=I.showCompose)==null?void 0:f.editStatus)||((g=window.__COMPOSE__)==null?void 0:g.editStatus)||null,draftStatus:((y=I.showCompose)==null?void 0:y.draftStatus)||((b=window.__COMPOSE__)==null?void 0:b.draftStatus)||null,onClose:v=>{const{newStatus:R,instance:x}=v||{};I.showCompose=!1,window.__COMPOSE__=null,R&&(I.reloadStatusPage++,it({text:"Post published. Check it out.",delay:1e3,duration:1e4,onClick:L=>{L.hideToast(),I.prevLocation=r,o(x?`/${x}/s/${R.id}`:`/s/${R.id}`)}}))}})}),!!e.showSettings&&t(vt,{onClick:v=>{v.target===v.currentTarget&&(I.showSettings=!1)},children:t(Zs,{onClose:()=>{I.showSettings=!1}})}),!!e.showAccounts&&t(vt,{onClick:v=>{v.target===v.currentTarget&&(I.showAccounts=!1)},children:t(us,{onClose:()=>{I.showAccounts=!1}})}),!!e.showAccount&&t(vt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(I.showAccount=!1)},children:t(Gn,{account:((T=e.showAccount)==null?void 0:T.account)||e.showAccount,instance:(S=e.showAccount)==null?void 0:S.instance,onClose:({destination:v})=>{I.showAccount=!1,v&&(I.showAccounts=!1)}})}),!!e.showDrafts&&t(vt,{onClick:v=>{v.target===v.currentTarget&&(I.showDrafts=!1)},children:t(Jn,{onClose:()=>I.showDrafts=!1})}),!!e.showMediaModal&&t(vt,{onClick:v=>{(v.target===v.currentTarget||v.target.classList.contains("media"))&&(I.showMediaModal=!1)},children:t(tn,{mediaAttachments:e.showMediaModal.mediaAttachments,instance:e.showMediaModal.instance,index:e.showMediaModal.index,statusID:e.showMediaModal.statusID,onClose:()=>{I.showMediaModal=!1}})}),!!e.showShortcutsSettings&&t(vt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(I.showShortcutsSettings=!1)},children:t(es,{onClose:()=>I.showShortcutsSettings=!1})}),t(mi,{isLoggedIn:n})]})}function mi({isLoggedIn:e}){const[n,l]=C(!0);ue(l);const c=lt(I),s=_();z(()=>{if(e&&n){const{masto:a,instance:u}=W();(async()=>{if(I.notificationsLast){const h=a.v1.notifications.list({limit:1,since_id:I.notificationsLast.id,types:c.settings.onlyMentions?["mention"]:void 0}),{value:i}=await h.next();i!=null&&i.length&&(I.notificationsShowNew=!0)}s.current=await a.ws.stream("/api/v1/streaming",{stream:"user:notification"}),s.current.on("notification",h=>{h.status&&pt(h.status,u,{skipThreading:!0}),(!c.settings.onlyMentions||h.type==="mention")&&(I.notificationsShowNew=!0)}),s.current.ws.onclose=()=>{}})()}return()=>{s.current&&(s.current.ws.close(),s.current=null)}},[n,e,c.settings.onlyMentions]);const o=_(),r=()=>{o.current=Date.now(),fetch("./version.json").then(a=>a.json()).then(a=>{a&&(I.appVersion=a)}).catch(a=>{})};return Ve(r,n&&1e3*60*30),ue(a=>{a&&(o.current?Date.now()-o.current>1e3*60*60&&r():r())}),null}function gi(){const e=Ft(),{id:n,instance:l}=e;return t(ai,{id:n,instance:l})}Fn(t(Bn,{children:t(pi,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-eadb2364.js.map
