{"version":3,"mappings":"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","names":["getAccount","id","accounts","store","local","getJSON","find","a","info","getCurrentAccount","currentAccount","session","get","getCurrentAccountNS","account","instanceURL","saveAccount","acc","accessToken","push","setJSON","set","updateAccount","accountInfo","displayName","avatar","avatar_static","currentInstance","getCurrentInstance","instances","instance","toLowerCase","e","console","key","localStorage","getItem","JSON","value","warn","sessionStorage","setItem","data","del","DEFAULT_INSTANCE","apis","accountApis","currentAccountApi","initClient","test","replace","url","client","createClient","disableVersionCheck","timeout","__instance__","initInstance","masto","v2","fetch","v1","uri","urls","streamingApi","domain","configuration","streaming","mastoAccount","preferences","initPreferences","api","accountID","_a","_b","Error","authenticated","_c","states","proxy","appVersion","prevLocation","currentLocation","statuses","statusThreadNumber","home","homeNew","homeLast","homeLastFetchTime","notifications","notificationsLast","notificationsNew","notificationsShowNew","notificationsLastFetchTime","reloadStatusPage","spoilers","scrollPositions","unfurledLinks","statusQuotes","showCompose","showSettings","showAccount","showAccounts","showDrafts","showMediaModal","showShortcutsSettings","shortcuts","settings","onlyMentions","autoRefresh","shortcutsViewMode","shortcutsColumnsMode","boostsCarousel","contentTranslation","contentTranslationTargetLanguage","contentTranslationHideLanguages","contentTranslationAutoInline","cloakMode","subscribeKey","v","subscribe","changes","prevValue","path","hideAllModals","statusKey","getStatus","statusID","saveStatus","status","opts","skipThreading","override","Object","oldStatus","_pinned","_filtered","threadifyStatus","requestAnimationFrame","propInstance","traverse","index","fetchIndex","inReplyToAccountId","inReplyToId","prevStatus","r","fetchStatus","Promise","setTimeout","mem","emojifyText","text","emojis","length","indexOf","forEach","emoji","shortcode","staticUrl","RegExp","fauxDiv","document","createElement","enhanceContent","content","postEnhanceDOM","enhancedContent","dom","innerHTML","hasLink","hasCodeBlock","Array","from","querySelectorAll","link","setAttribute","textContent","trim","classList","add","innerText","hasChildren","querySelector","username","split","slice","textNodes","extractTextNodes","node","html","nodeValue","nodes","childNodes","replaceWith","filter","p","block","pre","br","nextParagraphs","currentBlock","nextElementSibling","next","tagName","codeText","map","join","remove","replaceAll","rejectFilter","prevIndex","hashtagStuffedParagraphs","hashtagCount","i","nodeType","Node","TEXT_NODE","linkText","startsWith","title","defaultRejectFilter","defaultRejectFilterMap","fromEntries","nodeName","walk","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","parentNode","includes","FILTER_REJECT","FILTER_ACCEPT","nextNode","div","getHTMLText","handleContentLinks","mentions","previewMode","target","closest","prevText","previousSibling","textBeforeLinkIsAt","endsWith","contains","targetText","getAttribute","mention","acct","preventDefault","stopPropagation","href","textBeforeLinkIsHash","tag","hashURL","location","locale","Intl","DateTimeFormat","resolvedOptions","niceDateTime","date","hideTime","formatOpts","Date","currentYear","getFullYear","year","undefined","month","day","hour","minute","format","NumberFormat","shortenNumber","notation","showToast","props","onClick","delay","rest","toast","Toastify","className","destination","gravity","position","SIZES","s","m","l","xl","xxl","xxxl","alphaCache","canvas","window","OffscreenCanvas","ctx","getContext","Avatar","size","alt","squircle","avatarRef","useRef","isMissing","_jsx","ref","class","style","width","height","children","src","loading","decoding","crossOrigin","onError","onLoad","current","dataset","loaded","drawImage","allPixels","getImageData","hasAlpha","pixel","clearRect","EmojiText","regex","elements","word","_jsxs","srcset","media","ICONS","x","__vitePreload","heart","bookmark","check-circle","x-circle","transfer","rocket","arrow-left","arrow-right","arrow-up","arrow-down","earth","lock","unlock","eye-close","eye-open","message","comment","notification","follow","follow-add","poll","pencil","quill","at","attachment","upload","gear","more","external","popout","popin","plus","chevron-left","chevron-right","reply","thread","group","bot","menu","list","search","hashtag","shortcut","user","following","pin","bus","history","share","sparkles","exit","translate","play","trash","mute","unmute","unblock","flag","time","refresh","emoji2","chart","react","layout4","layout5","announce","alert","round","arrow-up-circle","arrow-down-circle","clipboard","Icon","icon","iconSize","iconBlock","rotate","flip","isArray","iconData","setIconData","useState","useEffect","default","display","overflow","lineHeight","viewBox","dangerouslySetInnerHTML","__html","body","transform","AccountBlock","skeleton","avatarSize","internal","showActivity","showStats","navigate","useNavigate","avatarStatic","statusesCount","lastStatusAt","fields","note","_","acct1","acct2","match","verifiedField","f","verifiedAt","_Fragment","Link","forwardRef","routerLocation","useLocation","hash","to","restProps","isActive","decodeURIComponent","supportsCache","supports","feature","version","range","features","satisfies","includePrerelease","loose","MenuConfirm","subMenu","confirm","confirmLabel","menuItemClassName","menuFooter","MenuItem","cloneElement","Parent","SubMenu","Menu","menuRef","instanceRef","openTrigger","direction","gap","shift","menuClassName","menuButton","label","itemProps","onPointerMove","pointerType","openMenu","onPointerLeave","Loader","abrupt","hidden","$modalContainer","getElementById","Modal","modalRef","timer","focusElement","focus","clearTimeout","createPortal","_localeMatch","args","localeMatch","cacheKey","getTranslateTargetLanguage","fromSettings","navigator","languages","translationTargetLanguages","code","localeCode2Text","DisplayNames","type","of","throttle","pThrottle","limit","interval","lingvaTranslate","source","res","provider","translation","detectedSourceLanguage","detectedSource","throttledLingvaTranslate","forceTranslate","sourceLanguage","onTranslate","mini","targetLang","uiState","setPronunciationContent","pronunciationContent","translatedContent","detailsRef","detectedLang","sourceLangText","targetLangText","apiSourceLang","setUIState","detectedLangText","setDetectedLang","pronunciation","setTranslatedContent","open","behavior","lang","dir","sourceLanguages","name","draftsStore","createStore","drafts","val","getMany","keys","delMany","clear","db","openCompose","URL","screenWidth","screenHeight","screen","left","Math","max","top","min","winUID","uid","random","newWin","__COMPOSE__","useInterval","fn","deps","immediate","savedCallback","setInterval","tick","clearInterval","visibilityIconsMap","public","unlisted","private","direct","NameText","showAvatar","showAcct","short","trimmedUsername","trimmedDisplayName","shortenedDisplayName","dayjs","extend","dayjsTwitter","localizedFormat","relativeTime","dtf","RelativeTime","datetime","dateStr","setDateStr","raf","update","str","now","diff","twitter","toDate","fromNow","cancelAnimationFrame","toISOString","Poll","readOnly","votePoll","expired","expiresAt","multiple","options","ownVotes","voted","votersCount","votesCount","expiresAtDate","pollVotesCount","roundPrecision","showResults","setShowResults","optionsHaveVoteCounts","every","o","option","optionVotesCount","percentage","toFixed","isLeading","disabled","onSubmit","form","formData","FormData","choices","marginLeft","htmlContentLength","isMastodonLinkMaybe","pathname","root","documentElement","getComputedStyle","defaultBoundingBoxPadding","_safeBoundingBoxPadding","paddings","safeAreaInsetTop","getPropertyValue","safeAreaInsetRight","safeAreaInsetBottom","safeAreaInsetLeft","parseInt","safeBoundingBoxPadding","maxAge","statusPeek","spoilerText","mediaAttachments","image","gifv","video","audio","unknown","isSafari","userAgent","Media","showOriginal","autoAnimate","blurhash","description","meta","previewRemoteUrl","previewUrl","remoteUrl","original","small","mediaURL","remoteMediaURL","orientation","rgbAverageColor","getBlurHashAverageColor","videoRef","focalBackgroundPosition","y","mediaRef","onUpdate","useCallback","scale","make3dTransformValue","removeProperty","setProperty","touchAction","pinchZoomEnabled","setPinchZoomEnabled","quickPinchZoomProps","enabled","draggableUnZoomed","inertiaFriction","containerProps","useMemo","isImage","parentRef","imageSmallerThanParent","setImageSmallerThanParent","useLayoutEffect","offsetWidth","offsetHeight","smaller","maxAspectHeight","innerHeight","maxHeight","mediaStyles","aspectRatio","mode","backgroundImage","backgroundSize","QuickPinchZoom","backgroundColor","backgroundPosition","shortDuration","duration","isGIF","loopable","formattedDuration","formatDuration","hoverAnimate","autoGIFAnimate","videoHTML","pause","onMouseEnter","onMouseLeave","poster","preload","playsinline","loop","muted","controls","autoplay","MenuLink","FocusableItem","closeMenu","detail","INLINE_TRANSLATE_LIMIT","fetchAccount","reject","memFetchAccount","visibilityText","Status","withinContext","contentTextWeight","enableTranslate","_forceTranslate","allowFilters","onMediaClick","quoted","onStatusLinkClick","sameInstance","sKey","snapStates","useSnapshot","accountId","accountURL","accountEmojis","repliesCount","reblogged","reblogsCount","favourited","favouritesCount","bookmarked","sensitive","visibility","language","editedAt","filtered","card","createdAt","reblog","_deleted","debugHover","createdAtDate","editedAtDate","inReplyToAccountRef","isSelf","setInReplyToAccount","inReplyToAccount","account2","catch","mentionSelf","showSpoiler","targetLanguage","contentLength","inlineTranslate","isSizeLarge","showEdited","setShowEdited","showReactions","setShowReactions","spoilerContentRef","scrollHeight","clientHeight","useResizeObserver","contentRef","statusRef","unauthInteractionErrorMessage","textWeight","createdDateText","readMoreText","editedDateText","mediaNoDesc","replyToStatus","boostStatus","confirmText","yes","newStatus","favouriteStatus","bookmarkStatus","differentLanguage","menuInstanceRef","MenuHeader","StatusMenuItems","MenuDivider","done","replyStatus","setForceTranslate","nicePostURL","editStatus","cachedStatus","setIsContextMenuOpen","contextMenuAnchorPoint","setContextMenuAnchorPoint","bindLongPressContext","useLongPress","clientX","clientY","isContextMenuOpen","showContextMenu","detect","cancelOnMovement","metaKey","contextMenuRef","state","portal","currentTarget","url2","result","removeAttribute","unfurlMastodonLink","QuoteStatuses","newPoll","pollResponse","TranslationBlock","vote","Card","StatusButton","canBoost","confirmBoostStatus","checked","count","EditedAtModal","ReactionsModal","onClose","providerName","authorName","embedUrl","hasText","isLandscape","cardStatusURL","blurhashImage","setCardStatusURL","imageData","blurhashPixels","w","h","putImageData","videoID","hostname","fetchStatusHistory","editHistory","setEditHistory","editHistory2","REACTIONS_LIMIT","setAccounts","showMore","setShowMore","reblogIterator","favouriteIterator","fetchAccounts","firstLoad","favouriteResults","reblogResults","theAccount","_types","InView","favourite","onChange","inView","setButtonTitle","buttonTitle","iconAlt","hours","seconds","denylistDomains","failedUnfurls","_unfurlMastodonLink","snapshot","padStart","remoteInstanceFetch","theURL","urlObj","statusMatch","instanceRegex","resolve","debug","mastoSearchFetch","results","handleFulfill","instance2","then","selfURL","handleCatch","host","restPath","filterInfo","isReblog","filterTitleStr","setShowPeek","bindLongPressPeek","statusPeekText","showPeek","tabIndex","quotes","uniqueQuotes","q","arr","q2","level","supportedLanguagesMap","supportedLanguages","reduce","common","native","expiryOptions","expirySeconds","values","oneDay","expiresInFromExpiresAt","delta","getTime","role","windowMargin","observer","IntersectionObserver","entries","entry","isIntersecting","boundingClientRect","innerWidth","observe","DEFAULT_LANG","urlRegexObj","urlRegex","flags","usernameRegex","urlPlaceholder","countableText","inputText","Compose","draftStatus","standalone","hasOpener","UID","log","maxMediaAttachments","charactersReservedPerUrl","maxCharacters","imageSizeLimit","imageMatrixLimit","supportedMimeTypes","videoSizeLimit","videoMatrixLimit","videoFrameRateLimit","maxCharactersPerOption","maxExpiration","maxOptions","minExpiration","spoilerTextRef","textareaRef","prevLanguage","setMediaAttachments","setLanguage","oninputTextarea","focusTextarea","dispatchEvent","visibility2","language2","sensitive2","currentAccountInfo","allMentions","prefs","setSensitive","poll2","expiresIn","statusSource","mediaAttachments2","setVisibility","setPoll","composablePoll","beforeUnloadCopy","hasMediaAttachments","canClose","hasOnlyAcct","confirmClose","hasIDMediaAttachments","handleBeforeUnload","sameWithSource","getCharCount","updateCharCount","escDownRef","useHotkeys","addEventListener","prevBackgroundDraft","draftKey","saveUnsavedDraft","equal","backgroundDraft","handleItems","item","items","i2","file","files","allowedFiles","updatedAt","error","mediaFiles","handleDragover","showEmoji2Picker","setShowEmoji2Picker","passData","createObjectURL","dataTransfer","removeEventListener","opener","formRef","pointerEvents","opacity","mediaPromises","params2","removeNullUndefined","some","hasNoDescriptions","params","e2","media_attributes","in_reply_to_id","Textarea","fileID","MediaAttachment","attachments","j","placeholder","required","onInput","newAttachments","accept","CharCountMeter","codeA","commonA","codeB","commonB","CustomEmojisModal","selectionEnd","textarea","newText","selectionStart","emojiWithSpace","sort","performSearch","textareaProps","charCount","customEmojis","textExpanderTextRef","handleCommited","handleChange","text2","encodeHTML","displayNameWithEmoji","provide","matched","input","searchResults","textExpanderRef","handleValue","setText","offset","leftChars","onRemove","autoCorrect","setDescription","suffixType","debouncedOnDescriptionChange","useDebouncedCallback","onDescriptionChange","showModal","setShowModal","descTextarea","supportsEdit","searchTerm","splice","bLower","b","bStartsWith","aContains","aLower","bContains","aStartsWith","char","obj","setCustomEmojis","othersCat","emojisCat","filterShortcodes","bothStartWith","category","customEmojisList","recentlyUsedCustomEmojis","onSelect","recentlyUsedCustomEmojis2","recentlyUsedEmojiIndex","visibleInPicker","VITE_CLIENT_NAME","CLIENT_NAME","import","useTitle","setTitle","hasPaths","paths","matchPath"],"sources":["../../src/utils/store-utils.js","../../src/utils/store.js","../../src/utils/api.js","../../src/utils/states.js","../../src/utils/emojify-text.js","../../src/utils/enhance-content.js","../../src/utils/getHTMLText.jsx","../../src/utils/handle-content-links.js","../../src/utils/nice-date-time.js","../../src/utils/shorten-number.jsx","../../src/utils/show-toast.js","../../src/components/avatar.jsx","../../src/components/emoji-text.jsx","../../src/components/icon.jsx","../../src/components/account-block.jsx","../../src/components/link.jsx","../../src/utils/supports.js","../../src/components/menu-confirm.jsx","../../src/components/loader.jsx","../../src/components/modal.jsx","../../src/utils/locale-match.jsx","../../src/utils/get-translate-target-language.jsx","../../src/utils/localeCode2Text.jsx","../../src/components/translation-block.jsx","../../src/utils/db.js","../../src/utils/open-compose.js","../../src/utils/useInterval.js","../../src/utils/visibility-icons-map.js","../../src/components/name-text.jsx","../../src/components/relative-time.jsx","../../src/components/poll.jsx","../../src/utils/html-content-length.js","../../src/utils/isMastodonLinkMaybe.jsx","../../src/utils/safe-bounding-box-padding.js","../../src/utils/status-peek.jsx","../../src/components/media.jsx","../../src/components/menu-link.jsx","../../src/components/status.jsx","../../src/components/compose.jsx","../../src/utils/useTitle.js"],"sourcesContent":["import store from './store';\n\nexport function getAccount(id) {\n  const accounts = store.local.getJSON('accounts') || [];\n  return accounts.find((a) => a.info.id === id) || accounts[0];\n}\n\nexport function getCurrentAccount() {\n  const currentAccount = store.session.get('currentAccount');\n  const account = getAccount(currentAccount);\n  return account;\n}\n\nexport function getCurrentAccountNS() {\n  const account = getCurrentAccount();\n  const {\n    instanceURL,\n    info: { id },\n  } = account;\n  return `${id}@${instanceURL}`;\n}\n\nexport function saveAccount(account) {\n  const accounts = store.local.getJSON('accounts') || [];\n  const acc = accounts.find((a) => a.info.id === account.info.id);\n  if (acc) {\n    acc.info = account.info;\n    acc.instanceURL = account.instanceURL;\n    acc.accessToken = account.accessToken;\n  } else {\n    accounts.push(account);\n  }\n  store.local.setJSON('accounts', accounts);\n  store.session.set('currentAccount', account.info.id);\n}\n\nexport function updateAccount(accountInfo) {\n  // Only update if displayName or avatar or avatar_static is different\n  const accounts = store.local.getJSON('accounts') || [];\n  const acc = accounts.find((a) => a.info.id === accountInfo.id);\n  if (acc) {\n    if (\n      acc.info.displayName !== accountInfo.displayName ||\n      acc.info.avatar !== accountInfo.avatar ||\n      acc.info.avatar_static !== accountInfo.avatar_static\n    ) {\n      acc.info = {\n        ...acc.info,\n        ...accountInfo,\n      };\n      store.local.setJSON('accounts', accounts);\n    }\n  }\n}\n\nlet currentInstance = null;\nexport function getCurrentInstance() {\n  if (currentInstance) return currentInstance;\n  try {\n    const account = getCurrentAccount();\n    const instances = store.local.getJSON('instances');\n    const instance = account.instanceURL.toLowerCase();\n    return (currentInstance = instances[instance]);\n  } catch (e) {\n    console.error(e);\n    alert(`Failed to load instance configuration. Please try again.\\n\\n${e}`);\n    // Temporary fix for corrupted data\n    store.local.del('instances');\n    location.reload();\n    return {};\n  }\n}\n","import { getCurrentAccountNS } from './store-utils';\n\nconst local = {\n  get: (key) => {\n    try {\n      return localStorage.getItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  getJSON: (key) => {\n    try {\n      return JSON.parse(local.get(key));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      return localStorage.setItem(key, value);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  setJSON: (key, value) => {\n    try {\n      return local.set(key, JSON.stringify(value));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      return localStorage.removeItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\nconst session = {\n  get: (key) => {\n    try {\n      return sessionStorage.getItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  getJSON: (key) => {\n    try {\n      return JSON.parse(session.get(key));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      return sessionStorage.setItem(key, value);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  setJSON: (key, value) => {\n    try {\n      return session.set(key, JSON.stringify(value));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      return sessionStorage.removeItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\n// Store with account namespace (id@domain.tld) <- uses id, not username\nconst account = {\n  get: (key) => {\n    try {\n      return local.getJSON(key)[getCurrentAccountNS()];\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      const data = local.getJSON(key) || {};\n      data[getCurrentAccountNS()] = value;\n      return local.setJSON(key, data);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      const data = local.getJSON(key) || {};\n      delete data[getCurrentAccountNS()];\n      return local.setJSON(key, data);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\nexport default { local, session, account };\n","import { createClient } from 'masto';\n\nimport store from './store';\nimport { getAccount, getCurrentAccount, saveAccount } from './store-utils';\n\n// Default *fallback* instance\nconst DEFAULT_INSTANCE = 'mastodon.social';\n\n// Per-instance masto instance\n// Useful when only one account is logged in\n// I'm not sure if I'll ever allow multiple logged-in accounts but oh well...\n// E.g. apis['mastodon.social']\nconst apis = {};\n\n// Per-account masto instance\n// Note: There can be many accounts per instance\n// Useful when multiple accounts are logged in or when certain actions require a specific account\n// Just in case if I need this one day.\n// E.g. accountApis['mastodon.social']['ACCESS_TOKEN']\nconst accountApis = {};\n\n// Current account masto instance\nlet currentAccountApi;\n\nexport function initClient({ instance, accessToken }) {\n  if (/^https?:\\/\\//.test(instance)) {\n    instance = instance\n      .replace(/^https?:\\/\\//, '')\n      .replace(/\\/+$/, '')\n      .toLowerCase();\n  }\n  const url = instance ? `https://${instance}` : `https://${DEFAULT_INSTANCE}`;\n\n  const client = createClient({\n    url,\n    accessToken, // Can be null\n    disableVersionCheck: true, // Allow non-Mastodon instances\n    timeout: 30_000, // Unfortunatly this is global instead of per-request\n  });\n  client.__instance__ = instance;\n\n  apis[instance] = client;\n  if (!accountApis[instance]) accountApis[instance] = {};\n  if (accessToken) accountApis[instance][accessToken] = client;\n\n  return client;\n}\n\n// Get the instance information\n// The config is needed for composing\nexport async function initInstance(client, instance) {\n  const masto = client;\n  // Request v2, fallback to v1 if fail\n  let info;\n  try {\n    info = await masto.v2.instance.fetch();\n  } catch (e) {}\n  if (!info) {\n    try {\n      info = await masto.v1.instances.fetch();\n    } catch (e) {}\n  }\n  if (!info) return;\n  console.log(info);\n  const {\n    // v1\n    uri,\n    urls: { streamingApi } = {},\n    // v2\n    domain,\n    configuration: { urls: { streaming } = {} } = {},\n  } = info;\n  const instances = store.local.getJSON('instances') || {};\n  if (uri || domain) {\n    instances[\n      (domain || uri)\n        .replace(/^https?:\\/\\//, '')\n        .replace(/\\/+$/, '')\n        .toLowerCase()\n    ] = info;\n  }\n  if (instance) {\n    instances[instance.toLowerCase()] = info;\n  }\n  store.local.setJSON('instances', instances);\n  // This is a weird place to put this but here's updating the masto instance with the streaming API URL set in the configuration\n  // Reason: Streaming WebSocket URL may change, unlike the standard API REST URLs\n  if (streamingApi || streaming) {\n    console.log('🎏 Streaming API URL:', streaming || streamingApi);\n    masto.config.props.streamingApiUrl = streaming || streamingApi;\n  }\n}\n\n// Get the account information and store it\nexport async function initAccount(client, instance, accessToken) {\n  const masto = client;\n  const mastoAccount = await masto.v1.accounts.verifyCredentials();\n\n  store.session.set('currentAccount', mastoAccount.id);\n\n  saveAccount({\n    info: mastoAccount,\n    instanceURL: instance.toLowerCase(),\n    accessToken,\n  });\n}\n\n// Get preferences\nexport async function initPreferences(client) {\n  try {\n    const masto = client;\n    const preferences = await masto.v1.preferences.fetch();\n    store.account.set('preferences', preferences);\n  } catch (e) {\n    // silently fail\n    console.error(e);\n  }\n}\n\n// Get the masto instance\n// If accountID is provided, get the masto instance for that account\nexport function api({ instance, accessToken, accountID, account } = {}) {\n  // Always lowercase and trim the instance\n  if (instance) {\n    instance = instance.toLowerCase().trim();\n  }\n\n  // If instance and accessToken are provided, get the masto instance for that account\n  if (instance && accessToken) {\n    return {\n      masto:\n        accountApis[instance]?.[accessToken] ||\n        initClient({ instance, accessToken }),\n      authenticated: true,\n      instance,\n    };\n  }\n\n  // If account is provided, get the masto instance for that account\n  if (account || accountID) {\n    account = account || getAccount(accountID);\n    if (account) {\n      const accessToken = account.accessToken;\n      const instance = account.instanceURL.toLowerCase().trim();\n      return {\n        masto:\n          accountApis[instance]?.[accessToken] ||\n          initClient({ instance, accessToken }),\n        authenticated: true,\n        instance,\n      };\n    } else {\n      throw new Error(`Account ${accountID} not found`);\n    }\n  }\n\n  // If only instance is provided, get the masto instance for that instance\n  if (instance) {\n    const masto = apis[instance] || initClient({ instance });\n    return {\n      masto,\n      authenticated: !!masto.config.props.accessToken,\n      instance,\n    };\n  }\n\n  // If no instance is provided, get the masto instance for the current account\n  if (currentAccountApi) {\n    return {\n      masto: currentAccountApi,\n      authenticated: true,\n      instance: currentAccountApi.__instance__,\n    };\n  }\n  const currentAccount = getCurrentAccount();\n  if (currentAccount) {\n    const { accessToken, instanceURL: instance } = currentAccount;\n    currentAccountApi =\n      accountApis[instance]?.[accessToken] ||\n      initClient({ instance, accessToken });\n    return {\n      masto: currentAccountApi,\n      authenticated: true,\n      instance,\n    };\n  }\n\n  // If no instance is provided and no account is logged in, get the masto instance for DEFAULT_INSTANCE\n  return {\n    masto: apis[DEFAULT_INSTANCE] || initClient({ instance: DEFAULT_INSTANCE }),\n    authenticated: false,\n    instance: DEFAULT_INSTANCE,\n  };\n}\n\nwindow.__API__ = {\n  currentAccountApi,\n  apis,\n  accountApis,\n};\n","import mem from 'mem';\nimport { proxy, subscribe } from 'valtio';\nimport { subscribeKey } from 'valtio/utils';\n\nimport { api } from './api';\nimport store from './store';\n\nconst states = proxy({\n  appVersion: {},\n  // history: [],\n  prevLocation: null,\n  currentLocation: null,\n  statuses: {},\n  statusThreadNumber: {},\n  home: [],\n  // specialHome: [],\n  homeNew: [],\n  homeLast: null, // Last item in 'home' list\n  homeLastFetchTime: null,\n  notifications: [],\n  notificationsLast: store.account.get('notificationsLast') || null, // Last read notification\n  notificationsNew: [],\n  notificationsShowNew: false,\n  notificationsLastFetchTime: null,\n  accounts: {},\n  reloadStatusPage: 0,\n  spoilers: {},\n  scrollPositions: {},\n  unfurledLinks: {},\n  statusQuotes: {},\n  accounts: {},\n  // Modals\n  showCompose: false,\n  showSettings: false,\n  showAccount: false,\n  showAccounts: false,\n  showDrafts: false,\n  showMediaModal: false,\n  showShortcutsSettings: false,\n  // Shortcuts\n  shortcuts: store.account.get('shortcuts') ?? [],\n  // Settings\n  settings: {\n    onlyMentions: store.account.get('settings-onlyMentions') ?? false,\n    autoRefresh: store.account.get('settings-autoRefresh') ?? false,\n    shortcutsViewMode: store.account.get('settings-shortcutsViewMode') ?? null,\n    shortcutsColumnsMode:\n      store.account.get('settings-shortcutsColumnsMode') ?? false,\n    boostsCarousel: store.account.get('settings-boostsCarousel') ?? true,\n    contentTranslation:\n      store.account.get('settings-contentTranslation') ?? true,\n    contentTranslationTargetLanguage:\n      store.account.get('settings-contentTranslationTargetLanguage') || null,\n    contentTranslationHideLanguages:\n      store.account.get('settings-contentTranslationHideLanguages') || [],\n    contentTranslationAutoInline:\n      store.account.get('settings-contentTranslationAutoInline') ?? false,\n    cloakMode: store.account.get('settings-cloakMode') ?? false,\n  },\n});\n\nexport default states;\n\nsubscribeKey(states, 'notificationsLast', (v) => {\n  console.log('CHANGE', v);\n  store.account.set('notificationsLast', states.notificationsLast);\n});\nsubscribe(states, (changes) => {\n  console.debug('STATES change', changes);\n  for (const [action, path, value, prevValue] of changes) {\n    if (path.join('.') === 'settings.onlyMentions') {\n      store.account.set('settings-onlyMentions', !!value);\n    }\n    if (path.join('.') === 'settings.autoRefresh') {\n      store.account.set('settings-autoRefresh', !!value);\n    }\n    if (path.join('.') === 'settings.boostsCarousel') {\n      store.account.set('settings-boostsCarousel', !!value);\n    }\n    if (path.join('.') === 'settings.shortcutsColumnsMode') {\n      store.account.set('settings-shortcutsColumnsMode', !!value);\n    }\n    if (path.join('.') === 'settings.shortcutsViewMode') {\n      store.account.set('settings-shortcutsViewMode', value);\n    }\n    if (path.join('.') === 'settings.contentTranslation') {\n      store.account.set('settings-contentTranslation', !!value);\n    }\n    if (path.join('.') === 'settings.contentTranslationAutoInline') {\n      store.account.set('settings-contentTranslationAutoInline', !!value);\n    }\n    if (path.join('.') === 'settings.contentTranslationTargetLanguage') {\n      console.log('SET', value);\n      store.account.set('settings-contentTranslationTargetLanguage', value);\n    }\n    if (/^settings\\.contentTranslationHideLanguages/i.test(path.join('.'))) {\n      store.account.set(\n        'settings-contentTranslationHideLanguages',\n        states.settings.contentTranslationHideLanguages,\n      );\n    }\n    if (path?.[0] === 'shortcuts') {\n      store.account.set('shortcuts', states.shortcuts);\n    }\n    if (path.join('.') === 'settings.cloakMode') {\n      store.account.set('settings-cloakMode', !!value);\n    }\n  }\n});\n\nexport function hideAllModals() {\n  states.showCompose = false;\n  states.showSettings = false;\n  states.showAccount = false;\n  states.showAccounts = false;\n  states.showDrafts = false;\n  states.showMediaModal = false;\n  states.showShortcutsSettings = false;\n}\n\nexport function statusKey(id, instance) {\n  if (!id) return;\n  return instance ? `${instance}/${id}` : id;\n}\n\nexport function getStatus(statusID, instance) {\n  if (instance) {\n    const key = statusKey(statusID, instance);\n    return states.statuses[key];\n  }\n  return states.statuses[statusID];\n}\n\nexport function saveStatus(status, instance, opts) {\n  if (typeof instance === 'object') {\n    opts = instance;\n    instance = null;\n  }\n  const { override, skipThreading } = Object.assign(\n    { override: true, skipThreading: false },\n    opts,\n  );\n  if (!status) return;\n  const oldStatus = getStatus(status.id, instance);\n  if (!override && oldStatus) return;\n  const key = statusKey(status.id, instance);\n  if (oldStatus?._pinned) status._pinned = oldStatus._pinned;\n  if (oldStatus?._filtered) status._filtered = oldStatus._filtered;\n  states.statuses[key] = status;\n  if (status.reblog) {\n    const key = statusKey(status.reblog.id, instance);\n    states.statuses[key] = status.reblog;\n  }\n\n  // THREAD TRAVERSER\n  if (!skipThreading) {\n    requestAnimationFrame(() => {\n      threadifyStatus(status, instance);\n      if (status.reblog) {\n        threadifyStatus(status.reblog, instance);\n      }\n    });\n  }\n}\n\nexport function threadifyStatus(status, propInstance) {\n  const { masto, instance } = api({ instance: propInstance });\n  // Return all statuses in the thread, via inReplyToId, if inReplyToAccountId === account.id\n  let fetchIndex = 0;\n  async function traverse(status, index = 0) {\n    const { inReplyToId, inReplyToAccountId } = status;\n    if (!inReplyToId || inReplyToAccountId !== status.account.id) {\n      return [status];\n    }\n    if (inReplyToId && inReplyToAccountId !== status.account.id) {\n      throw 'Not a thread';\n      // Possibly thread of replies by multiple people?\n    }\n    const key = statusKey(inReplyToId, instance);\n    let prevStatus = states.statuses[key];\n    if (!prevStatus) {\n      if (fetchIndex++ > 3) throw 'Too many fetches for thread'; // Some people revive old threads\n      await new Promise((r) => setTimeout(r, 500 * fetchIndex)); // Be nice to rate limits\n      // prevStatus = await masto.v1.statuses.fetch(inReplyToId);\n      prevStatus = await fetchStatus(inReplyToId, masto);\n      saveStatus(prevStatus, instance, { skipThreading: true });\n    }\n    // Prepend so that first status in thread will be index 0\n    return [...(await traverse(prevStatus, ++index)), status];\n  }\n  return traverse(status)\n    .then((statuses) => {\n      if (statuses.length > 1) {\n        console.debug('THREAD', statuses);\n        statuses.forEach((status, index) => {\n          const key = statusKey(status.id, instance);\n          states.statusThreadNumber[key] = index + 1;\n        });\n      }\n    })\n    .catch((e) => {\n      console.error(e, status);\n    });\n}\n\nconst fetchStatus = mem((statusID, masto) => {\n  return masto.v1.statuses.fetch(statusID);\n});\n","function emojifyText(text, emojis = []) {\n  if (!text) return '';\n  if (!emojis.length) return text;\n  if (text.indexOf(':') === -1) return text;\n  // Replace shortcodes in text with emoji\n  // emojis = [{ shortcode: 'smile', url: 'https://example.com/emoji.png' }]\n  emojis.forEach((emoji) => {\n    const { shortcode, staticUrl, url } = emoji;\n    text = text.replace(\n      new RegExp(`:${shortcode}:`, 'g'),\n      `<picture><source srcset=\"${staticUrl}\" media=\"(prefers-reduced-motion: reduce)\"></source><img class=\"shortcode-emoji emoji\" src=\"${url}\" alt=\":${shortcode}:\" width=\"12\" height=\"12\" loading=\"lazy\" decoding=\"async\" /></picture>`,\n    );\n  });\n  // console.log(text, emojis);\n  return text;\n}\n\nexport default emojifyText;\n","import emojifyText from './emojify-text';\n\nconst fauxDiv = document.createElement('div');\n\nfunction enhanceContent(content, opts = {}) {\n  const { emojis, postEnhanceDOM = () => {} } = opts;\n  let enhancedContent = content;\n  const dom = document.createElement('div');\n  dom.innerHTML = enhancedContent;\n  const hasLink = /<a/i.test(enhancedContent);\n  const hasCodeBlock = enhancedContent.indexOf('```') !== -1;\n\n  // Add target=\"_blank\" to all links with no target=\"_blank\"\n  // E.g. `note` in `account`\n  if (hasLink) {\n    const noTargetBlankLinks = Array.from(\n      dom.querySelectorAll('a:not([target=\"_blank\"])'),\n    );\n    noTargetBlankLinks.forEach((link) => {\n      link.setAttribute('target', '_blank');\n    });\n  }\n\n  // Add 'has-url-text' to all links that contains a url\n  if (hasLink) {\n    const links = Array.from(dom.querySelectorAll('a[href]'));\n    links.forEach((link) => {\n      if (/^https?:\\/\\//i.test(link.textContent.trim())) {\n        link.classList.add('has-url-text');\n      }\n    });\n  }\n\n  // Spanify un-spanned mentions\n  if (hasLink) {\n    const notMentionLinks = Array.from(dom.querySelectorAll('a[href]'));\n    notMentionLinks.forEach((link) => {\n      const text = link.innerText.trim();\n      const hasChildren = link.querySelector('*');\n      // If text looks like @username@domain, then it's a mention\n      if (/^@[^@]+(@[^@]+)?$/g.test(text)) {\n        // Only show @username\n        const username = text.split('@')[1];\n        if (!hasChildren) link.innerHTML = `@<span>${username}</span>`;\n        link.classList.add('mention');\n      }\n      // If text looks like #hashtag, then it's a hashtag\n      if (/^#[^#]+$/g.test(text)) {\n        if (!hasChildren) link.innerHTML = `#<span>${text.slice(1)}</span>`;\n        link.classList.add('mention', 'hashtag');\n      }\n    });\n  }\n\n  // EMOJIS\n  // ======\n  // Convert :shortcode: to <img />\n  let textNodes;\n  if (enhancedContent.indexOf(':') !== -1) {\n    textNodes = extractTextNodes(dom);\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (emojis) {\n        html = emojifyText(html, emojis);\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // CODE BLOCKS\n  // ===========\n  // Convert ```code``` to <pre><code>code</code></pre>\n  if (hasCodeBlock) {\n    const blocks = Array.from(dom.querySelectorAll('p')).filter((p) =>\n      /^```[^]+```$/g.test(p.innerText.trim()),\n    );\n    blocks.forEach((block) => {\n      const pre = document.createElement('pre');\n      // Replace <br /> with newlines\n      block.querySelectorAll('br').forEach((br) => br.replaceWith('\\n'));\n      pre.innerHTML = `<code>${block.innerHTML.trim()}</code>`;\n      block.replaceWith(pre);\n    });\n  }\n\n  // Convert multi-paragraph code blocks to <pre><code>code</code></pre>\n  if (hasCodeBlock) {\n    const paragraphs = Array.from(dom.querySelectorAll('p'));\n    // Filter out paragraphs with ``` in beginning only\n    const codeBlocks = paragraphs.filter((p) => /^```/g.test(p.innerText));\n    // For each codeBlocks, get all paragraphs until the last paragraph with ``` at the end only\n    codeBlocks.forEach((block) => {\n      const nextParagraphs = [block];\n      let hasCodeBlock = false;\n      let currentBlock = block;\n      while (currentBlock.nextElementSibling) {\n        const next = currentBlock.nextElementSibling;\n        if (next && next.tagName === 'P') {\n          if (/```$/g.test(next.innerText)) {\n            nextParagraphs.push(next);\n            hasCodeBlock = true;\n            break;\n          } else {\n            nextParagraphs.push(next);\n          }\n        } else {\n          break;\n        }\n        currentBlock = next;\n      }\n      if (hasCodeBlock) {\n        const pre = document.createElement('pre');\n        nextParagraphs.forEach((p) => {\n          // Replace <br /> with newlines\n          p.querySelectorAll('br').forEach((br) => br.replaceWith('\\n'));\n        });\n        const codeText = nextParagraphs.map((p) => p.innerHTML).join('\\n\\n');\n        pre.innerHTML = `<code>${codeText}</code>`;\n        block.replaceWith(pre);\n        nextParagraphs.forEach((p) => p.remove());\n      }\n    });\n  }\n\n  // INLINE CODE\n  // ===========\n  // Convert `code` to <code>code</code>\n  if (enhancedContent.indexOf('`') !== -1) {\n    textNodes = extractTextNodes(dom);\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (/`[^`]+`/g.test(html)) {\n        html = html.replaceAll(/(`[^]+?`)/g, '<code>$1</code>');\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // TWITTER USERNAMES\n  // =================\n  // Convert @username@twitter.com to <a href=\"https://twitter.com/username\">@username@twitter.com</a>\n  if (/twitter\\.com/i.test(enhancedContent)) {\n    textNodes = extractTextNodes(dom, {\n      rejectFilter: ['A'],\n    });\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (/@[a-zA-Z0-9_]+@twitter\\.com/g.test(html)) {\n        html = html.replaceAll(\n          /(@([a-zA-Z0-9_]+)@twitter\\.com)/g,\n          '<a href=\"https://twitter.com/$2\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">$1</a>',\n        );\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // HASHTAG STUFFING\n  // ================\n  // Get the <p> that contains a lot of hashtags, add a class to it\n  if (enhancedContent.indexOf('#') !== -1) {\n    let prevIndex = null;\n    const hashtagStuffedParagraphs = Array.from(\n      dom.querySelectorAll('p'),\n    ).filter((p, index) => {\n      let hashtagCount = 0;\n      for (let i = 0; i < p.childNodes.length; i++) {\n        const node = p.childNodes[i];\n\n        if (node.nodeType === Node.TEXT_NODE) {\n          const text = node.textContent.trim();\n          if (text !== '') {\n            return false;\n          }\n        } else if (node.tagName === 'BR') {\n          // Ignore <br />\n        } else if (node.tagName === 'A') {\n          const linkText = node.textContent.trim();\n          if (!linkText || !linkText.startsWith('#')) {\n            return false;\n          } else {\n            hashtagCount++;\n          }\n        } else {\n          return false;\n        }\n      }\n      // Only consider \"stuffing\" if:\n      // - there are more than 3 hashtags\n      // - there are more than 1 hashtag in adjacent paragraphs\n      if (hashtagCount > 3) {\n        prevIndex = index;\n        return true;\n      }\n      if (hashtagCount > 1 && prevIndex && index === prevIndex + 1) {\n        prevIndex = index;\n        return true;\n      }\n    });\n    if (hashtagStuffedParagraphs?.length) {\n      hashtagStuffedParagraphs.forEach((p) => {\n        p.classList.add('hashtag-stuffing');\n        p.title = p.innerText;\n      });\n    }\n  }\n\n  if (postEnhanceDOM) {\n    postEnhanceDOM(dom); // mutate dom\n  }\n\n  enhancedContent = dom.innerHTML;\n\n  return enhancedContent;\n}\n\nconst defaultRejectFilter = [\n  // Document metadata\n  'STYLE',\n  // Image and multimedia\n  'IMG',\n  'VIDEO',\n  'AUDIO',\n  'AREA',\n  'MAP',\n  'TRACK',\n  // Embedded content\n  'EMBED',\n  'IFRAME',\n  'OBJECT',\n  'PICTURE',\n  'PORTAL',\n  'SOURCE',\n  // SVG and MathML\n  'SVG',\n  'MATH',\n  // Scripting\n  'CANVAS',\n  'NOSCRIPT',\n  'SCRIPT',\n  // Forms\n  'INPUT',\n  'OPTION',\n  'TEXTAREA',\n  // Web Components\n  'SLOT',\n  'TEMPLATE',\n];\nconst defaultRejectFilterMap = Object.fromEntries(\n  defaultRejectFilter.map((nodeName) => [nodeName, true]),\n);\nfunction extractTextNodes(dom, opts = {}) {\n  const textNodes = [];\n  const walk = document.createTreeWalker(\n    dom,\n    NodeFilter.SHOW_TEXT,\n    {\n      acceptNode(node) {\n        if (defaultRejectFilterMap[node.parentNode.nodeName]) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        if (\n          opts.rejectFilter &&\n          opts.rejectFilter.includes(node.parentNode.nodeName)\n        ) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        return NodeFilter.FILTER_ACCEPT;\n      },\n    },\n    false,\n  );\n  let node;\n  while ((node = walk.nextNode())) {\n    textNodes.push(node);\n  }\n  return textNodes;\n}\n\nexport default enhanceContent;\n","const div = document.createElement('div');\nfunction getHTMLText(html) {\n  if (!html) return '';\n  div.innerHTML = html\n    .replace(/<\\/p>/g, '</p>\\n\\n')\n    .replace(/<\\/li>/g, '</li>\\n');\n  div.querySelectorAll('br').forEach((br) => {\n    br.replaceWith('\\n');\n  });\n  return div.innerText.replace(/[\\r\\n]{3,}/g, '\\n\\n').trim();\n}\n\nexport default getHTMLText;\n","import states from './states';\n\nfunction handleContentLinks(opts) {\n  const { mentions = [], instance, previewMode } = opts || {};\n  return (e) => {\n    let { target } = e;\n    target = target.closest('a');\n    if (!target) return;\n    const prevText = target.previousSibling?.textContent;\n    const textBeforeLinkIsAt = prevText?.endsWith('@');\n    if (target.classList.contains('u-url') || textBeforeLinkIsAt) {\n      const targetText = (\n        target.querySelector('span') || target\n      ).innerText.trim();\n      const username = targetText.replace(/^@/, '');\n      const url = target.getAttribute('href');\n      const mention = mentions.find(\n        (mention) =>\n          mention.username === username ||\n          mention.acct === username ||\n          mention.url === url,\n      );\n      if (mention) {\n        e.preventDefault();\n        e.stopPropagation();\n        states.showAccount = {\n          account: mention.acct,\n          instance,\n        };\n      } else if (!/^http/i.test(targetText)) {\n        console.log('mention not found', targetText);\n        e.preventDefault();\n        e.stopPropagation();\n        const href = target.getAttribute('href');\n        states.showAccount = {\n          account: href,\n          instance,\n        };\n      }\n    } else if (!previewMode) {\n      const textBeforeLinkIsHash = prevText?.endsWith('#');\n      if (target.classList.contains('hashtag') || textBeforeLinkIsHash) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tag = target.innerText.replace(/^#/, '').trim();\n        const hashURL = instance ? `#/${instance}/t/${tag}` : `#/t/${tag}`;\n        console.log({ hashURL });\n        location.hash = hashURL;\n      } else if (states.unfurledLinks[target.href]?.url) {\n        e.preventDefault();\n        e.stopPropagation();\n        states.prevLocation = {\n          pathname: location.hash.replace(/^#/, ''),\n        };\n        location.hash = `#${states.unfurledLinks[target.href].url}`;\n      }\n    }\n  };\n}\n\nexport default handleContentLinks;\n","const { locale } = new Intl.DateTimeFormat().resolvedOptions();\n\nfunction niceDateTime(date, { hideTime, formatOpts } = {}) {\n  if (!(date instanceof Date)) {\n    date = new Date(date);\n  }\n  const currentYear = new Date().getFullYear();\n  const dateText = Intl.DateTimeFormat(locale, {\n    // Show year if not current year\n    year: date.getFullYear() === currentYear ? undefined : 'numeric',\n    month: 'short',\n    day: 'numeric',\n    // Hide time if requested\n    hour: hideTime ? undefined : 'numeric',\n    minute: hideTime ? undefined : 'numeric',\n    ...formatOpts,\n  }).format(date);\n  return dateText;\n}\n\nexport default niceDateTime;\n","const { locale } = Intl.NumberFormat().resolvedOptions();\nconst shortenNumber = Intl.NumberFormat(locale, {\n  notation: 'compact',\n}).format;\nexport default shortenNumber;\n","import Toastify from 'toastify-js';\n\nfunction showToast(props) {\n  if (typeof props === 'string') {\n    props = { text: props };\n  }\n  const { onClick, delay, ...rest } = props;\n  const toast = Toastify({\n    className: `${onClick || props.destination ? 'shiny-pill' : ''}`,\n    gravity: 'bottom',\n    position: 'center',\n    ...rest,\n    onClick: () => {\n      onClick?.(toast); // Pass in the object itself!\n    },\n  });\n  if (delay) {\n    setTimeout(() => {\n      toast.showToast();\n    }, delay);\n  } else {\n    toast.showToast();\n  }\n}\n\nexport default showToast;\n","import './avatar.css';\n\nimport { useRef } from 'preact/hooks';\n\nconst SIZES = {\n  s: 16,\n  m: 20,\n  l: 24,\n  xl: 32,\n  xxl: 50,\n  xxxl: 64,\n};\n\nconst alphaCache = {};\n\nconst canvas = window.OffscreenCanvas\n  ? new OffscreenCanvas(1, 1)\n  : document.createElement('canvas');\nconst ctx = canvas.getContext('2d');\n\nfunction Avatar({ url, size, alt = '', squircle, ...props }) {\n  size = SIZES[size] || size || SIZES.m;\n  const avatarRef = useRef();\n  const isMissing = /missing\\.png$/.test(url);\n  return (\n    <span\n      ref={avatarRef}\n      class={`avatar ${squircle ? 'squircle' : ''} ${\n        alphaCache[url] ? 'has-alpha' : ''\n      }`}\n      style={{\n        width: size,\n        height: size,\n      }}\n      title={alt}\n      {...props}\n    >\n      {!!url && (\n        <img\n          src={url}\n          width={size}\n          height={size}\n          alt={alt}\n          loading=\"lazy\"\n          decoding=\"async\"\n          crossOrigin={\n            alphaCache[url] === undefined && !isMissing\n              ? 'anonymous'\n              : undefined\n          }\n          onError={(e) => {\n            if (e.target.crossOrigin) {\n              e.target.crossOrigin = null;\n              e.target.src = url;\n            }\n          }}\n          onLoad={(e) => {\n            if (avatarRef.current) avatarRef.current.dataset.loaded = true;\n            if (alphaCache[url] !== undefined) return;\n            if (isMissing) return;\n            try {\n              // Check if image has alpha channel\n              const { width, height } = e.target;\n              if (canvas.width !== width) canvas.width = width;\n              if (canvas.height !== height) canvas.height = height;\n              ctx.drawImage(e.target, 0, 0);\n              const allPixels = ctx.getImageData(0, 0, width, height);\n              // At least 10% of pixels have alpha <= 128\n              const hasAlpha =\n                allPixels.data.filter((pixel, i) => i % 4 === 3 && pixel <= 128)\n                  .length /\n                  (allPixels.data.length / 4) >\n                0.1;\n              if (hasAlpha) {\n                // console.log('hasAlpha', hasAlpha, allPixels.data);\n                avatarRef.current.classList.add('has-alpha');\n              }\n              alphaCache[url] = hasAlpha;\n              ctx.clearRect(0, 0, width, height);\n            } catch (e) {\n              // Silent fail\n              alphaCache[url] = false;\n            }\n          }}\n        />\n      )}\n    </span>\n  );\n}\n\nexport default Avatar;\n","function EmojiText({ text, emojis }) {\n  if (!text) return '';\n  if (!emojis?.length) return text;\n  if (text.indexOf(':') === -1) return text;\n  const regex = new RegExp(\n    `:(${emojis.map((e) => e.shortcode).join('|')}):`,\n    'g',\n  );\n  const elements = text.split(regex).map((word) => {\n    const emoji = emojis.find((e) => e.shortcode === word);\n    if (emoji) {\n      const { url, staticUrl } = emoji;\n      return (\n        <picture>\n          <source srcset={staticUrl} media=\"(prefers-reduced-motion: reduce)\" />\n          <img\n            key={word}\n            src={url}\n            alt={word}\n            class=\"shortcode-emoji emoji\"\n            width=\"12\"\n            height=\"12\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </picture>\n      );\n    }\n    return word;\n  });\n  return elements;\n}\n\nexport default EmojiText;\n","import { useEffect, useState } from 'preact/hooks';\n\nconst SIZES = {\n  s: 12,\n  m: 16,\n  l: 20,\n  xl: 24,\n  xxl: 32,\n};\n\nexport const ICONS = {\n  x: () => import('@iconify-icons/mingcute/close-line'),\n  heart: () => import('@iconify-icons/mingcute/heart-line'),\n  bookmark: () => import('@iconify-icons/mingcute/bookmark-line'),\n  'check-circle': () => import('@iconify-icons/mingcute/check-circle-line'),\n  'x-circle': () => import('@iconify-icons/mingcute/close-circle-line'),\n  transfer: () => import('@iconify-icons/mingcute/transfer-4-line'),\n  rocket: () => import('@iconify-icons/mingcute/rocket-line'),\n  'arrow-left': () => import('@iconify-icons/mingcute/arrow-left-line'),\n  'arrow-right': () => import('@iconify-icons/mingcute/arrow-right-line'),\n  'arrow-up': () => import('@iconify-icons/mingcute/arrow-up-line'),\n  'arrow-down': () => import('@iconify-icons/mingcute/arrow-down-line'),\n  earth: () => import('@iconify-icons/mingcute/earth-line'),\n  lock: () => import('@iconify-icons/mingcute/lock-line'),\n  unlock: () => import('@iconify-icons/mingcute/unlock-line'),\n  'eye-close': () => import('@iconify-icons/mingcute/eye-close-line'),\n  'eye-open': () => import('@iconify-icons/mingcute/eye-2-line'),\n  message: () => import('@iconify-icons/mingcute/mail-line'),\n  comment: () => import('@iconify-icons/mingcute/chat-3-line'),\n  home: () => import('@iconify-icons/mingcute/home-3-line'),\n  notification: () => import('@iconify-icons/mingcute/notification-line'),\n  follow: () => import('@iconify-icons/mingcute/user-follow-line'),\n  'follow-add': () => import('@iconify-icons/mingcute/user-add-line'),\n  poll: [() => import('@iconify-icons/mingcute/chart-bar-line'), '90deg'],\n  pencil: () => import('@iconify-icons/mingcute/pencil-line'),\n  quill: () => import('@iconify-icons/mingcute/quill-pen-line'),\n  at: () => import('@iconify-icons/mingcute/at-line'),\n  attachment: () => import('@iconify-icons/mingcute/attachment-line'),\n  upload: () => import('@iconify-icons/mingcute/upload-3-line'),\n  gear: () => import('@iconify-icons/mingcute/settings-3-line'),\n  more: () => import('@iconify-icons/mingcute/more-3-line'),\n  external: () => import('@iconify-icons/mingcute/external-link-line'),\n  popout: () => import('@iconify-icons/mingcute/external-link-line'),\n  popin: [() => import('@iconify-icons/mingcute/external-link-line'), '180deg'],\n  plus: () => import('@iconify-icons/mingcute/add-circle-line'),\n  'chevron-left': () => import('@iconify-icons/mingcute/left-line'),\n  'chevron-right': () => import('@iconify-icons/mingcute/right-line'),\n  reply: [\n    () => import('@iconify-icons/mingcute/share-forward-line'),\n    '180deg',\n    'horizontal',\n  ],\n  thread: () => import('@iconify-icons/mingcute/route-line'),\n  group: () => import('@iconify-icons/mingcute/group-line'),\n  bot: () => import('@iconify-icons/mingcute/android-2-line'),\n  menu: () => import('@iconify-icons/mingcute/rows-4-line'),\n  list: () => import('@iconify-icons/mingcute/list-check-line'),\n  search: () => import('@iconify-icons/mingcute/search-2-line'),\n  hashtag: () => import('@iconify-icons/mingcute/hashtag-line'),\n  info: () => import('@iconify-icons/mingcute/information-line'),\n  shortcut: () => import('@iconify-icons/mingcute/lightning-line'),\n  user: () => import('@iconify-icons/mingcute/user-4-line'),\n  following: () => import('@iconify-icons/mingcute/walk-line'),\n  pin: () => import('@iconify-icons/mingcute/pin-line'),\n  bus: () => import('@iconify-icons/mingcute/bus-2-line'),\n  link: () => import('@iconify-icons/mingcute/link-2-line'),\n  history: () => import('@iconify-icons/mingcute/history-line'),\n  share: () => import('@iconify-icons/mingcute/share-2-line'),\n  sparkles: () => import('@iconify-icons/mingcute/sparkles-line'),\n  exit: () => import('@iconify-icons/mingcute/exit-line'),\n  translate: () => import('@iconify-icons/mingcute/translate-line'),\n  play: () => import('@iconify-icons/mingcute/play-fill'),\n  trash: () => import('@iconify-icons/mingcute/delete-2-line'),\n  mute: () => import('@iconify-icons/mingcute/volume-mute-line'),\n  unmute: () => import('@iconify-icons/mingcute/volume-line'),\n  block: () => import('@iconify-icons/mingcute/forbid-circle-line'),\n  unblock: [\n    () => import('@iconify-icons/mingcute/forbid-circle-line'),\n    '180deg',\n  ],\n  flag: () => import('@iconify-icons/mingcute/flag-4-line'),\n  time: () => import('@iconify-icons/mingcute/time-line'),\n  refresh: () => import('@iconify-icons/mingcute/refresh-2-line'),\n  emoji2: () => import('@iconify-icons/mingcute/emoji-2-line'),\n  filter: () => import('@iconify-icons/mingcute/filter-2-line'),\n  chart: () => import('@iconify-icons/mingcute/chart-line-line'),\n  react: () => import('@iconify-icons/mingcute/react-line'),\n  layout4: () => import('@iconify-icons/mingcute/layout-4-line'),\n  layout5: () => import('@iconify-icons/mingcute/layout-5-line'),\n  announce: () => import('@iconify-icons/mingcute/announcement-line'),\n  alert: () => import('@iconify-icons/mingcute/alert-line'),\n  round: () => import('@iconify-icons/mingcute/round-fill'),\n  'arrow-up-circle': () =>\n    import('@iconify-icons/mingcute/arrow-up-circle-line'),\n  'arrow-down-circle': () =>\n    import('@iconify-icons/mingcute/arrow-down-circle-line'),\n  clipboard: () => import('@iconify-icons/mingcute/clipboard-line'),\n};\n\nfunction Icon({\n  icon,\n  size = 'm',\n  alt,\n  title,\n  class: className = '',\n  style = {},\n}) {\n  if (!icon) return null;\n\n  const iconSize = SIZES[size];\n  let iconBlock = ICONS[icon];\n  let rotate, flip;\n  if (Array.isArray(iconBlock)) {\n    [iconBlock, rotate, flip] = iconBlock;\n  }\n\n  const [iconData, setIconData] = useState(null);\n  useEffect(async () => {\n    const icon = await iconBlock();\n    setIconData(icon.default);\n  }, [iconBlock]);\n\n  return (\n    <div\n      class={`icon ${className}`}\n      title={title || alt}\n      style={{\n        width: `${iconSize}px`,\n        height: `${iconSize}px`,\n        display: 'inline-block',\n        overflow: 'hidden',\n        lineHeight: 0,\n        ...style,\n      }}\n    >\n      {iconData && (\n        <svg\n          width={iconSize}\n          height={iconSize}\n          viewBox={`0 0 ${iconData.width} ${iconData.height}`}\n          dangerouslySetInnerHTML={{ __html: iconData.body }}\n          style={{\n            transform: `${rotate ? `rotate(${rotate})` : ''} ${\n              flip ? `scaleX(-1)` : ''\n            }`,\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default Icon;\n","import './account-block.css';\n\nimport { useNavigate } from 'react-router-dom';\n\nimport enhanceContent from '../utils/enhance-content';\nimport niceDateTime from '../utils/nice-date-time';\nimport shortenNumber from '../utils/shorten-number';\nimport states from '../utils/states';\n\nimport Avatar from './avatar';\nimport EmojiText from './emoji-text';\nimport Icon from './icon';\n\nfunction AccountBlock({\n  skeleton,\n  account,\n  avatarSize = 'xl',\n  instance,\n  external,\n  internal,\n  onClick,\n  showActivity = false,\n  showStats = false,\n}) {\n  if (skeleton) {\n    return (\n      <div class=\"account-block skeleton\">\n        <Avatar size={avatarSize} />\n        <span>\n          <b>████████</b>\n          <br />\n          <span class=\"account-block-acct\">@██████</span>\n        </span>\n      </div>\n    );\n  }\n\n  const navigate = useNavigate();\n\n  const {\n    id,\n    acct,\n    avatar,\n    avatarStatic,\n    displayName,\n    username,\n    emojis,\n    url,\n    statusesCount,\n    lastStatusAt,\n    bot,\n    fields,\n    note,\n    group,\n  } = account;\n  const [_, acct1, acct2] = acct.match(/([^@]+)(@.+)/i) || [, acct];\n\n  const verifiedField = fields?.find((f) => !!f.verifiedAt && !!f.value);\n\n  return (\n    <a\n      class=\"account-block\"\n      href={url}\n      target={external ? '_blank' : null}\n      title={`@${acct}`}\n      onClick={(e) => {\n        if (external) return;\n        e.preventDefault();\n        if (onClick) return onClick(e);\n        if (internal) {\n          navigate(`/${instance}/a/${id}`);\n        } else {\n          states.showAccount = {\n            account,\n            instance,\n          };\n        }\n      }}\n    >\n      <Avatar url={avatar} size={avatarSize} squircle={bot} />\n      <span>\n        {displayName ? (\n          <b>\n            <EmojiText text={displayName} emojis={emojis} />\n          </b>\n        ) : (\n          <b>{username}</b>\n        )}\n        <br />\n        <span class=\"account-block-acct\">\n          @{acct1}\n          <wbr />\n          {acct2}\n        </span>\n        {showActivity && (\n          <>\n            <br />\n            <small class=\"last-status-at insignificant\">\n              Posts: {statusesCount}\n              {!!lastStatusAt && (\n                <>\n                  {' '}\n                  &middot; Last posted:{' '}\n                  {niceDateTime(lastStatusAt, {\n                    hideTime: true,\n                  })}\n                </>\n              )}\n            </small>\n          </>\n        )}\n        {showStats && (\n          <div class=\"account-block-stats\">\n            <div\n              class=\"short-desc\"\n              dangerouslySetInnerHTML={{\n                __html: enhanceContent(note, { emojis }),\n              }}\n            />\n            {bot && (\n              <>\n                <span class=\"tag\">\n                  <Icon icon=\"bot\" /> Automated\n                </span>\n              </>\n            )}\n            {!!group && (\n              <>\n                <span class=\"tag\">\n                  <Icon icon=\"group\" /> Group\n                </span>\n              </>\n            )}\n            {!!verifiedField && (\n              <span class=\"verified-field ib\">\n                <Icon icon=\"check-circle\" size=\"s\" />{' '}\n                <span\n                  dangerouslySetInnerHTML={{\n                    __html: enhanceContent(verifiedField.value, { emojis }),\n                  }}\n                />\n              </span>\n            )}\n          </div>\n        )}\n      </span>\n    </a>\n  );\n}\n\nexport default AccountBlock;\n","import { forwardRef } from 'preact/compat';\nimport { useLocation } from 'react-router-dom';\n\nimport states from '../utils/states';\n\n/* NOTES\n   =====\n   Initially this uses <NavLink> from react-router-dom, but it doesn't work:\n   1. It interferes with nested <a> inside <a> and it's difficult to preventDefault/stopPropagation from the nested <a>\n   2. isActive doesn't work properly with the weird routes that's set up in this app, due to the faux \"location\" to make the modals work and prevent unmounting\n   3. Not using <Link state/> because it modifies history.state that *persists* across page reloads. I don't need that, so using valtio's states instead.\n*/\n\nconst Link = forwardRef((props, ref) => {\n  let routerLocation;\n  try {\n    routerLocation = useLocation();\n  } catch (e) {}\n  let hash = (location.hash || '').replace(/^#/, '').trim();\n  if (hash === '') hash = '/';\n  const { to, ...restProps } = props;\n  const isActive = decodeURIComponent(hash) === to;\n  return (\n    <a\n      ref={ref}\n      href={`#${to}`}\n      {...restProps}\n      class={`${props.class || ''} ${isActive ? 'is-active' : ''}`}\n      onClick={(e) => {\n        if (routerLocation) states.prevLocation = routerLocation;\n        props.onClick?.(e);\n      }}\n    />\n  );\n});\n\nexport default Link;\n","import { satisfies } from 'semver';\n\nimport features from '../data/features.json';\n\nimport { getCurrentInstance } from './store-utils';\n\nconst supportsCache = {};\n\nfunction supports(feature) {\n  try {\n    const { version, domain } = getCurrentInstance();\n    const key = `${domain}-${feature}`;\n    if (supportsCache[key]) return supportsCache[key];\n    const range = features[feature];\n    if (!range) return false;\n    return (supportsCache[key] = satisfies(version, range, {\n      includePrerelease: true,\n      loose: true,\n    }));\n  } catch (e) {\n    return false;\n  }\n}\n\nexport default supports;\n","import { Menu, MenuItem, SubMenu } from '@szhsin/react-menu';\nimport { cloneElement } from 'preact';\nimport { useRef } from 'preact/hooks';\n\nfunction MenuConfirm({\n  subMenu = false,\n  confirm = true,\n  confirmLabel,\n  menuItemClassName,\n  menuFooter,\n  ...props\n}) {\n  const { children, onClick, ...restProps } = props;\n  if (!confirm) {\n    if (subMenu) return <MenuItem {...props} />;\n    if (onClick) {\n      return cloneElement(children, {\n        onClick,\n      });\n    }\n    return children;\n  }\n  const Parent = subMenu ? SubMenu : Menu;\n  const menuRef = useRef();\n  return (\n    <Parent\n      instanceRef={menuRef}\n      openTrigger=\"clickOnly\"\n      direction=\"bottom\"\n      overflow=\"auto\"\n      gap={-8}\n      shift={8}\n      menuClassName=\"menu-emphasized\"\n      {...restProps}\n      menuButton={subMenu ? undefined : children}\n      label={subMenu ? children : undefined}\n      // Test fix for bug; submenus not opening on Android\n      itemProps={{\n        onPointerMove: (e) => {\n          if (e.pointerType === 'touch') {\n            menuRef.current?.openMenu?.();\n          }\n        },\n        onPointerLeave: (e) => {\n          if (e.pointerType === 'touch') {\n            menuRef.current?.openMenu?.();\n          }\n        },\n      }}\n    >\n      <MenuItem className={menuItemClassName} onClick={onClick}>\n        {confirmLabel}\n      </MenuItem>\n      {menuFooter}\n    </Parent>\n  );\n}\n\nexport default MenuConfirm;\n","import './loader.css';\n\nfunction Loader({ abrupt, hidden, ...props }) {\n  return (\n    <div\n      {...props}\n      class={`loader-container ${abrupt ? 'abrupt' : ''} ${\n        hidden ? 'hidden' : ''\n      }`}\n    >\n      <div class=\"loader\" />\n    </div>\n  );\n}\n\nexport default Loader;\n","import './modal.css';\n\nimport { createPortal } from 'preact/compat';\nimport { useEffect, useRef } from 'preact/hooks';\n\nconst $modalContainer = document.getElementById('modal-container');\n\nfunction Modal({ children, onClick, class: className }) {\n  if (!children) return null;\n\n  const modalRef = useRef();\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      const focusElement = modalRef.current?.querySelector('[tabindex=\"-1\"]');\n      if (focusElement) {\n        focusElement.focus();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const Modal = (\n    <div ref={modalRef} className={className} onClick={onClick}>\n      {children}\n    </div>\n  );\n\n  return createPortal(Modal, $modalContainer);\n\n  // return createPortal(children, $modalContainer);\n}\n\nexport default Modal;\n","import { match } from '@formatjs/intl-localematcher';\nimport mem from 'mem';\n\nfunction _localeMatch(...args) {\n  // Wrap in try/catch because localeMatcher throws on invalid locales\n  try {\n    return match(...args);\n  } catch (e) {\n    const defaultLocale = args[2];\n    return defaultLocale || false;\n  }\n}\nconst localeMatch = mem(_localeMatch, {\n  cacheKey: (args) => args.join(),\n});\n\nexport default localeMatch;\n","import translationTargetLanguages from '../data/lingva-target-languages';\n\nimport localeMatch from './locale-match';\nimport states from './states';\n\nfunction getTranslateTargetLanguage(fromSettings = false) {\n  if (fromSettings) {\n    const { contentTranslationTargetLanguage } = states.settings;\n    if (contentTranslationTargetLanguage) {\n      return contentTranslationTargetLanguage;\n    }\n  }\n  return localeMatch(\n    [\n      new Intl.DateTimeFormat().resolvedOptions().locale,\n      ...navigator.languages,\n    ],\n    translationTargetLanguages.map((l) => l.code.replace('_', '-')), // The underscore will fail Intl.Locale inside `match`\n    'en',\n  );\n}\n\nexport default getTranslateTargetLanguage;\n","export default function localeCode2Text(code) {\n  try {\n    return new Intl.DisplayNames(navigator.languages, {\n      type: 'language',\n    }).of(code);\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n","import './translation-block.css';\n\nimport pThrottle from 'p-throttle';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport sourceLanguages from '../data/lingva-source-languages';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeCode2Text from '../utils/localeCode2Text';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nconst throttle = pThrottle({\n  limit: 1,\n  interval: 2000,\n});\n\nfunction lingvaTranslate(text, source, target) {\n  console.log('TRANSLATE', text, source, target);\n  // Using another API instance instead of lingva.ml because of this bug (slashes don't work):\n  // https://github.com/thedaviddelta/lingva-translate/issues/68\n  return fetch(\n    `https://lingva.garudalinux.org/api/v1/${source}/${target}/${encodeURIComponent(\n      text,\n    )}`,\n  )\n    .then((res) => res.json())\n    .then((res) => {\n      return {\n        provider: 'lingva',\n        content: res.translation,\n        detectedSourceLanguage: res.info?.detectedSource,\n        info: res.info,\n      };\n    });\n  // return masto.v1.statuses.translate(id, {\n  //   lang: DEFAULT_LANG,\n  // });\n}\nconst throttledLingvaTranslate = throttle(lingvaTranslate);\n\nfunction TranslationBlock({\n  forceTranslate,\n  sourceLanguage,\n  onTranslate,\n  text = '',\n  mini,\n}) {\n  const targetLang = getTranslateTargetLanguage(true);\n  const [uiState, setUIState] = useState('default');\n  const [pronunciationContent, setPronunciationContent] = useState(null);\n  const [translatedContent, setTranslatedContent] = useState(null);\n  const [detectedLang, setDetectedLang] = useState(null);\n  const detailsRef = useRef();\n\n  const sourceLangText = sourceLanguage\n    ? localeCode2Text(sourceLanguage)\n    : null;\n  const targetLangText = localeCode2Text(targetLang);\n  const apiSourceLang = useRef('auto');\n\n  if (!onTranslate) {\n    onTranslate = mini ? throttledLingvaTranslate : lingvaTranslate;\n  }\n\n  const translate = async () => {\n    setUIState('loading');\n    try {\n      const { content, detectedSourceLanguage, provider, ...props } =\n        await onTranslate(text, apiSourceLang.current, targetLang);\n      if (content) {\n        if (detectedSourceLanguage) {\n          const detectedLangText = localeCode2Text(detectedSourceLanguage);\n          setDetectedLang(detectedLangText);\n        }\n        if (provider === 'lingva') {\n          const pronunciation = props?.info?.pronunciation?.query;\n          if (pronunciation) {\n            setPronunciationContent(pronunciation);\n          }\n        }\n        setTranslatedContent(content);\n        setUIState('default');\n        if (!mini && content.trim() !== text.trim()) {\n          detailsRef.current.open = true;\n          detailsRef.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          });\n        }\n      } else {\n        console.error(result);\n        setUIState('error');\n      }\n    } catch (e) {\n      console.error(e);\n      setUIState('error');\n    }\n  };\n\n  useEffect(() => {\n    if (forceTranslate) {\n      translate();\n    }\n  }, [forceTranslate]);\n\n  if (mini) {\n    if (\n      !!translatedContent &&\n      translatedContent.trim() !== text.trim() &&\n      detectedLang !== targetLangText\n    ) {\n      return (\n        <div class=\"shazam-container\">\n          <div class=\"shazam-container-inner\">\n            <div class=\"status-translation-block-mini\">\n              <Icon\n                icon=\"translate\"\n                alt={`Auto-translated from ${sourceLangText}`}\n              />\n              <output\n                lang={targetLang}\n                dir=\"auto\"\n                title={pronunciationContent || ''}\n              >\n                {translatedContent}\n              </output>\n            </div>\n          </div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  return (\n    <div\n      class=\"status-translation-block\"\n      onClick={(e) => {\n        e.preventDefault();\n      }}\n    >\n      <details ref={detailsRef}>\n        <summary>\n          <button\n            type=\"button\"\n            onClick={async (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              detailsRef.current.open = !detailsRef.current.open;\n              if (uiState === 'loading') return;\n              if (!translatedContent) translate();\n            }}\n          >\n            <Icon icon=\"translate\" />{' '}\n            <span>\n              {uiState === 'loading'\n                ? 'Translating…'\n                : sourceLanguage && sourceLangText && !detectedLang\n                ? `Translate from ${sourceLangText}`\n                : `Translate`}\n            </span>\n          </button>\n        </summary>\n        <div class=\"translated-block\">\n          <div class=\"translation-info insignificant\">\n            <select\n              class=\"translated-source-select\"\n              disabled={uiState === 'loading'}\n              onChange={(e) => {\n                apiSourceLang.current = e.target.value;\n                translate();\n              }}\n            >\n              {sourceLanguages.map((l) => (\n                <option value={l.code}>\n                  {l.code === 'auto' ? `Auto (${detectedLang ?? '…'})` : l.name}\n                </option>\n              ))}\n            </select>{' '}\n            <span>→ {targetLangText}</span>\n            <Loader abrupt hidden={uiState !== 'loading'} />\n          </div>\n          {uiState === 'error' ? (\n            <p class=\"ui-state\">Failed to translate</p>\n          ) : (\n            !!translatedContent && (\n              <>\n                <output class=\"translated-content\" lang={targetLang} dir=\"auto\">\n                  {translatedContent}\n                </output>\n                {!!pronunciationContent && (\n                  <output\n                    class=\"translated-pronunciation-content\"\n                    tabIndex={-1}\n                    onClick={(e) => {\n                      e.target.classList.toggle('expand');\n                    }}\n                  >\n                    {pronunciationContent}\n                  </output>\n                )}\n              </>\n            )\n          )}\n        </div>\n      </details>\n    </div>\n  );\n}\n\nexport default TranslationBlock;\n","import {\n  clear,\n  createStore,\n  del,\n  delMany,\n  get,\n  getMany,\n  keys,\n  set,\n} from 'idb-keyval';\n\nconst draftsStore = createStore('drafts-db', 'drafts-store');\n\n// Add additonal `draftsStore` parameter to all methods\n\nconst drafts = {\n  set: (key, val) => set(key, val, draftsStore),\n  get: (key) => get(key, draftsStore),\n  getMany: (keys) => getMany(keys, draftsStore),\n  del: (key) => del(key, draftsStore),\n  delMany: (keys) => delMany(keys, draftsStore),\n  clear: () => clear(draftsStore),\n  keys: () => keys(draftsStore),\n};\n\nexport default {\n  drafts,\n};\n","export default function openCompose(opts) {\n  const url = new URL('/compose/', window.location);\n  const { width: screenWidth, height: screenHeight } = window.screen;\n  const left = Math.max(0, (screenWidth - 600) / 2);\n  const top = Math.max(0, (screenHeight - 450) / 2);\n  const width = Math.min(screenWidth, 600);\n  const height = Math.min(screenHeight, 450);\n  const winUID = opts.uid || Math.random();\n  const newWin = window.open(\n    url,\n    'compose' + winUID,\n    `width=${width},height=${height},left=${left},top=${top}`,\n  );\n\n  if (newWin) {\n    // if (masto) {\n    //   newWin.masto = masto;\n    // }\n\n    newWin.__COMPOSE__ = opts;\n  }\n\n  return newWin;\n}\n","import { useEffect, useRef } from 'preact/hooks';\n\nfunction useInterval(fn, delay, deps, immediate) {\n  const savedCallback = useRef(fn);\n  useEffect(() => {\n    savedCallback.current = fn;\n  }, [fn, deps]);\n\n  useEffect(() => {\n    if (!immediate || delay === null || delay === false) return;\n    savedCallback.current();\n  }, [immediate]);\n\n  useEffect(() => {\n    if (delay === null || delay === false) return;\n    const tick = () => savedCallback.current();\n    const id = setInterval(tick, delay);\n    return () => clearInterval(id);\n  }, [delay]);\n}\n\nexport default useInterval;\n","export default {\n  public: 'earth',\n  unlisted: 'group',\n  private: 'lock',\n  direct: 'message',\n};\n","import './name-text.css';\n\nimport states from '../utils/states';\n\nimport Avatar from './avatar';\nimport EmojiText from './emoji-text';\n\nfunction NameText({\n  account,\n  instance,\n  showAvatar,\n  showAcct,\n  short,\n  external,\n  onClick,\n}) {\n  const { acct, avatar, avatarStatic, id, url, displayName, emojis, bot } =\n    account;\n  let { username } = account;\n  const [_, acct1, acct2] = acct.match(/([^@]+)(@.+)/i) || [, acct];\n\n  const trimmedUsername = username.toLowerCase().trim();\n  const trimmedDisplayName = (displayName || '').toLowerCase().trim();\n  const shortenedDisplayName = trimmedDisplayName\n    .replace(/(\\:(\\w|\\+|\\-)+\\:)(?=|[\\!\\.\\?]|$)/g, '') // Remove shortcodes, regex from https://regex101.com/r/iE9uV0/1\n    .replace(/\\s+/g, '') // E.g. \"My name\" === \"myname\"\n    .replace(/[^a-z0-9]/gi, ''); // Remove non-alphanumeric characters\n\n  if (\n    !short &&\n    (trimmedUsername === trimmedDisplayName ||\n      trimmedUsername === shortenedDisplayName)\n  ) {\n    username = null;\n  }\n\n  return (\n    <a\n      class={`name-text ${showAcct ? 'show-acct' : ''} ${short ? 'short' : ''}`}\n      href={url}\n      target={external ? '_blank' : null}\n      title={`${displayName ? `${displayName} ` : ''}@${acct}`}\n      onClick={(e) => {\n        if (external) return;\n        e.preventDefault();\n        if (onClick) return onClick(e);\n        states.showAccount = {\n          account,\n          instance,\n        };\n      }}\n    >\n      {showAvatar && (\n        <>\n          <Avatar url={avatarStatic || avatar} squircle={bot} />{' '}\n        </>\n      )}\n      {displayName && !short ? (\n        <>\n          <b>\n            <EmojiText text={displayName} emojis={emojis} />\n          </b>\n          {!showAcct && username && (\n            <>\n              {' '}\n              <i>@{username}</i>\n            </>\n          )}\n        </>\n      ) : short ? (\n        <i>@{username}</i>\n      ) : (\n        <b>@{username}</b>\n      )}\n      {showAcct && (\n        <>\n          <br />\n          <i>\n            @{acct1}\n            <span class=\"ib\">{acct2}</span>\n          </i>\n        </>\n      )}\n    </a>\n  );\n}\n\nexport default NameText;\n","// Twitter-style relative time component\n// Seconds = 1s\n// Minutes = 1m\n// Hours = 1h\n// Days = 1d\n// After 7 days, use DD/MM/YYYY or MM/DD/YYYY\nimport dayjs from 'dayjs';\nimport dayjsTwitter from 'dayjs-twitter';\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport { useEffect, useState } from 'preact/hooks';\n\ndayjs.extend(dayjsTwitter);\ndayjs.extend(localizedFormat);\ndayjs.extend(relativeTime);\n\nconst dtf = new Intl.DateTimeFormat();\n\nexport default function RelativeTime({ datetime, format }) {\n  if (!datetime) return null;\n  const date = dayjs(datetime);\n  const [dateStr, setDateStr] = useState('');\n\n  useEffect(() => {\n    let timer, raf;\n    const update = () => {\n      raf = requestAnimationFrame(() => {\n        let str;\n        if (format === 'micro') {\n          // If date <= 1 day ago or day is within this year\n          const now = dayjs();\n          const dayDiff = now.diff(date, 'day');\n          if (dayDiff <= 1 || now.year() === date.year()) {\n            str = date.twitter();\n          } else {\n            str = dtf.format(date.toDate());\n          }\n        } else {\n          str = date.fromNow();\n        }\n        setDateStr(str);\n\n        timer = setTimeout(update, 30_000);\n      });\n    };\n    raf = requestAnimationFrame(update);\n    return () => {\n      clearTimeout(timer);\n      cancelAnimationFrame(raf);\n    };\n  }, [date]);\n\n  return (\n    <time datetime={date.toISOString()} title={date.format('LLLL')}>\n      {dateStr}\n    </time>\n  );\n}\n","import { useState } from 'preact/hooks';\n\nimport shortenNumber from '../utils/shorten-number';\n\nimport EmojiText from './emoji-text';\nimport Icon from './icon';\nimport RelativeTime from './relative-time';\n\nexport default function Poll({\n  poll,\n  lang,\n  readOnly,\n  refresh = () => {},\n  votePoll = () => {},\n}) {\n  const [uiState, setUIState] = useState('default');\n  const {\n    expired,\n    expiresAt,\n    id,\n    multiple,\n    options,\n    ownVotes,\n    voted,\n    votersCount,\n    votesCount,\n    emojis,\n  } = poll;\n  const expiresAtDate = !!expiresAt && new Date(expiresAt); // Update poll at point of expiry\n  // NOTE: Disable this because setTimeout runs immediately if delay is too large\n  // https://stackoverflow.com/a/56718027/20838\n  // useEffect(() => {\n  //   let timeout;\n  //   if (!expired && expiresAtDate) {\n  //     const ms = expiresAtDate.getTime() - Date.now() + 1; // +1 to give it a little buffer\n  //     if (ms > 0) {\n  //       timeout = setTimeout(() => {\n  //         setUIState('loading');\n  //         (async () => {\n  //           // await refresh();\n  //           setUIState('default');\n  //         })();\n  //       }, ms);\n  //     }\n  //   }\n  //   return () => {\n  //     clearTimeout(timeout);\n  //   };\n  // }, [expired, expiresAtDate]);\n\n  const pollVotesCount = votersCount || votesCount;\n  let roundPrecision = 0;\n\n  if (pollVotesCount <= 1000) {\n    roundPrecision = 0;\n  } else if (pollVotesCount <= 10000) {\n    roundPrecision = 1;\n  } else if (pollVotesCount <= 100000) {\n    roundPrecision = 2;\n  }\n\n  const [showResults, setShowResults] = useState(false);\n  const optionsHaveVoteCounts = options.every((o) => o.votesCount !== null);\n\n  return (\n    <div\n      lang={lang}\n      dir=\"auto\"\n      class={`poll ${readOnly ? 'read-only' : ''} ${\n        uiState === 'loading' ? 'loading' : ''\n      }`}\n    >\n      {(showResults && optionsHaveVoteCounts) || voted || expired ? (\n        <>\n          <div class=\"poll-options\">\n            {options.map((option, i) => {\n              const { title, votesCount: optionVotesCount } = option;\n              const percentage = pollVotesCount\n                ? ((optionVotesCount / pollVotesCount) * 100).toFixed(\n                    roundPrecision,\n                  )\n                : 0; // check if current poll choice is the leading one\n\n              const isLeading =\n                optionVotesCount > 0 &&\n                optionVotesCount ===\n                  Math.max(...options.map((o) => o.votesCount));\n              return (\n                <div\n                  key={`${i}-${title}-${optionVotesCount}`}\n                  class={`poll-option poll-result ${\n                    isLeading ? 'poll-option-leading' : ''\n                  }`}\n                  style={{\n                    '--percentage': `${percentage}%`,\n                  }}\n                >\n                  <div class=\"poll-option-title\">\n                    <span>\n                      <EmojiText text={title} emojis={emojis} />\n                    </span>\n                    {voted && ownVotes.includes(i) && (\n                      <>\n                        {' '}\n                        <Icon icon=\"check-circle\" />\n                      </>\n                    )}\n                  </div>\n                  <div\n                    class=\"poll-option-votes\"\n                    title={`${optionVotesCount} vote${\n                      optionVotesCount === 1 ? '' : 's'\n                    }`}\n                  >\n                    {percentage}%\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n          {!expired && !voted && (\n            <button\n              class=\"poll-vote-button plain2\"\n              disabled={uiState === 'loading'}\n              onClick={(e) => {\n                e.preventDefault();\n                setShowResults(false);\n              }}\n            >\n              <Icon icon=\"arrow-left\" size=\"s\" /> Hide results\n            </button>\n          )}\n        </>\n      ) : (\n        <form\n          onSubmit={async (e) => {\n            e.preventDefault();\n            const form = e.target;\n            const formData = new FormData(form);\n            const choices = [];\n            formData.forEach((value, key) => {\n              if (key === 'poll') {\n                choices.push(value);\n              }\n            });\n            if (!choices.length) return;\n            setUIState('loading');\n            await votePoll(choices);\n            setUIState('default');\n          }}\n        >\n          <div class=\"poll-options\">\n            {options.map((option, i) => {\n              const { title } = option;\n              return (\n                <div class=\"poll-option\">\n                  <label class=\"poll-label\">\n                    <input\n                      type={multiple ? 'checkbox' : 'radio'}\n                      name=\"poll\"\n                      value={i}\n                      disabled={uiState === 'loading'}\n                      readOnly={readOnly}\n                    />\n                    <span class=\"poll-option-title\">\n                      <EmojiText text={title} emojis={emojis} />\n                    </span>\n                  </label>\n                </div>\n              );\n            })}\n          </div>\n          {!readOnly && (\n            <button\n              class=\"poll-vote-button\"\n              type=\"submit\"\n              disabled={uiState === 'loading'}\n            >\n              Vote\n            </button>\n          )}\n        </form>\n      )}\n      <p class=\"poll-meta\">\n        {!expired && !readOnly && (\n          <button\n            type=\"button\"\n            class=\"plain small\"\n            disabled={uiState === 'loading'}\n            style={{\n              marginLeft: -8,\n            }}\n            onClick={(e) => {\n              e.preventDefault();\n              setUIState('loading');\n\n              (async () => {\n                await refresh();\n                setUIState('default');\n              })();\n            }}\n          >\n            <Icon icon=\"refresh\" alt=\"Refresh\" />\n          </button>\n        )}\n        {!voted && !expired && !readOnly && optionsHaveVoteCounts && (\n          <button\n            type=\"button\"\n            class=\"plain small\"\n            disabled={uiState === 'loading'}\n            onClick={(e) => {\n              e.preventDefault();\n              setShowResults(!showResults);\n            }}\n          >\n            <Icon\n              icon={showResults ? 'eye-open' : 'eye-close'}\n              alt={showResults ? 'Hide results' : 'Show results'}\n            />{' '}\n          </button>\n        )}\n        {!expired && !readOnly && ' '}\n        <span title={votesCount}>{shortenNumber(votesCount)}</span> vote\n        {votesCount === 1 ? '' : 's'}\n        {!!votersCount && votersCount !== votesCount && (\n          <>\n            {' '}\n            &bull; <span title={votersCount}>\n              {shortenNumber(votersCount)}\n            </span>{' '}\n            voter\n            {votersCount === 1 ? '' : 's'}\n          </>\n        )}{' '}\n        &bull; {expired ? 'Ended' : 'Ending'}{' '}\n        {!!expiresAtDate && <RelativeTime datetime={expiresAtDate} />}\n      </p>{' '}\n    </div>\n  );\n}\n","const div = document.createElement('div');\nexport default function htmlContentLength(html) {\n  if (!html) return 0;\n  div.innerHTML = html;\n  return div.innerText.length;\n}\n","export default function isMastodonLinkMaybe(url) {\n  const { pathname } = new URL(url);\n  return (\n    /^\\/.*\\/\\d+$/i.test(pathname) ||\n    /^\\/@[^/]+\\/statuses\\/\\w+$/i.test(pathname) || // GoToSocial\n    /^\\/notes\\/[a-z0-9]+$/i.test(pathname) || // Misskey, Calckey\n    /^\\/(notice|objects)\\/[a-z0-9-]+$/i.test(pathname) // Pleroma\n  );\n}\n","import mem from 'mem';\n\nconst root = document.documentElement;\nconst style = getComputedStyle(root);\nconst defaultBoundingBoxPadding = 8;\nfunction _safeBoundingBoxPadding(paddings = []) {\n  // paddings = [top, right, bottom, left]\n  // Get safe area inset variables from root\n  const safeAreaInsetTop = style.getPropertyValue('--sai-top');\n  const safeAreaInsetRight = style.getPropertyValue('--sai-right');\n  const safeAreaInsetBottom = style.getPropertyValue('--sai-bottom');\n  const safeAreaInsetLeft = style.getPropertyValue('--sai-left');\n  const str = [\n    safeAreaInsetTop,\n    safeAreaInsetRight,\n    safeAreaInsetBottom,\n    safeAreaInsetLeft,\n  ]\n    .map(\n      (v, i) =>\n        (parseInt(v, 10) || defaultBoundingBoxPadding) + (paddings[i] || 0),\n    )\n    .join(' ');\n  // console.log(str);\n  return str;\n}\nconst safeBoundingBoxPadding = mem(_safeBoundingBoxPadding, {\n  maxAge: 10000, // 10 seconds\n});\n\nexport default safeBoundingBoxPadding;\n","import getHTMLText from './getHTMLText';\n\nfunction statusPeek(status) {\n  const { spoilerText, content, poll, mediaAttachments } = status;\n  let text = '';\n  if (spoilerText?.trim()) {\n    text += spoilerText;\n  } else {\n    text += getHTMLText(content);\n  }\n  text = text.trim();\n  if (poll) {\n    text += ' 📊';\n  }\n  if (mediaAttachments?.length) {\n    text +=\n      ' ' +\n      mediaAttachments\n        .map(\n          (m) =>\n            ({\n              image: '🖼️',\n              gifv: '🎞️',\n              video: '📹',\n              audio: '🎵',\n              unknown: '',\n            }[m.type] || ''),\n        )\n        .join('');\n  }\n  return text;\n}\n\nexport default statusPeek;\n","import { getBlurHashAverageColor } from 'fast-blurhash';\nimport {\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport QuickPinchZoom, { make3dTransformValue } from 'react-quick-pinch-zoom';\n\nimport Icon from './icon';\nimport Link from './link';\nimport { formatDuration } from './status';\n\nconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent); // https://stackoverflow.com/a/23522755\n\n/*\nMedia type\n===\nunknown = unsupported or unrecognized file type\nimage = Static image\ngifv = Looping, soundless animation\nvideo = Video clip\naudio = Audio track\n*/\n\nfunction Media({ media, to, showOriginal, autoAnimate, onClick = () => {} }) {\n  const {\n    blurhash,\n    description,\n    meta,\n    previewRemoteUrl,\n    previewUrl,\n    remoteUrl,\n    url,\n    type,\n  } = media;\n  const { original = {}, small, focus } = meta || {};\n\n  const width = showOriginal ? original?.width : small?.width;\n  const height = showOriginal ? original?.height : small?.height;\n  const mediaURL = showOriginal ? url : previewUrl || url;\n  const remoteMediaURL = showOriginal\n    ? remoteUrl\n    : previewRemoteUrl || remoteUrl;\n  const orientation = width >= height ? 'landscape' : 'portrait';\n\n  const rgbAverageColor = blurhash ? getBlurHashAverageColor(blurhash) : null;\n\n  const videoRef = useRef();\n\n  let focalBackgroundPosition;\n  if (focus) {\n    // Convert focal point to CSS background position\n    // Formula from jquery-focuspoint\n    // x = -1, y = 1 => 0% 0%\n    // x = 0, y = 0 => 50% 50%\n    // x = 1, y = -1 => 100% 100%\n    const x = ((focus.x + 1) / 2) * 100;\n    const y = ((1 - focus.y) / 2) * 100;\n    focalBackgroundPosition = `${x.toFixed(0)}% ${y.toFixed(0)}%`;\n  }\n\n  const mediaRef = useRef();\n  const onUpdate = useCallback(({ x, y, scale }) => {\n    const { current: media } = mediaRef;\n\n    if (media) {\n      const value = make3dTransformValue({ x, y, scale });\n\n      if (scale === 1) {\n        media.style.removeProperty('transform');\n      } else {\n        media.style.setProperty('transform', value);\n      }\n\n      media.closest('.media-zoom').style.touchAction =\n        scale <= 1.01 ? 'pan-x' : '';\n    }\n  }, []);\n\n  const [pinchZoomEnabled, setPinchZoomEnabled] = useState(false);\n  const quickPinchZoomProps = {\n    enabled: pinchZoomEnabled,\n    draggableUnZoomed: false,\n    inertiaFriction: 0.9,\n    containerProps: {\n      className: 'media-zoom',\n      style: {\n        overflow: 'visible',\n        //   width: 'inherit',\n        //   height: 'inherit',\n        //   justifyContent: 'inherit',\n        //   alignItems: 'inherit',\n        //   display: 'inherit',\n      },\n    },\n    onUpdate,\n  };\n\n  const Parent = useMemo(\n    () => (to ? (props) => <Link to={to} {...props} /> : 'div'),\n    [to],\n  );\n\n  const isImage = type === 'image' || (type === 'unknown' && previewUrl);\n\n  const parentRef = useRef();\n  const [imageSmallerThanParent, setImageSmallerThanParent] = useState(false);\n  useLayoutEffect(() => {\n    if (!isImage) return;\n    if (!showOriginal) return;\n    if (!parentRef.current) return;\n    const { offsetWidth, offsetHeight } = parentRef.current;\n    const smaller = width < offsetWidth && height < offsetHeight;\n    if (smaller) setImageSmallerThanParent(smaller);\n  }, [width, height]);\n\n  const maxAspectHeight =\n    window.innerHeight * (orientation === 'portrait' ? 0.45 : 0.33);\n  const maxHeight = orientation === 'portrait' ? 0 : 160;\n  const mediaStyles = {\n    '--width': `${width}px`,\n    '--height': `${height}px`,\n    // Calculate '--aspectWidth' based on aspect ratio calculated from '--width' and '--height', max height has to be 160px\n    '--aspectWidth': `${\n      (width / height) * Math.max(maxHeight, maxAspectHeight)\n    }px`,\n    aspectRatio: `${width} / ${height}`,\n  };\n\n  if (isImage) {\n    // Note: type: unknown might not have width/height\n    quickPinchZoomProps.containerProps.style.display = 'inherit';\n\n    useLayoutEffect(() => {\n      if (!isSafari) return;\n      if (!showOriginal) return;\n      (async () => {\n        try {\n          await fetch(mediaURL, { mode: 'no-cors' });\n          mediaRef.current.src = mediaURL;\n        } catch (e) {\n          // Ignore\n        }\n      })();\n    }, [mediaURL]);\n\n    return (\n      <Parent\n        ref={parentRef}\n        class={`media media-image`}\n        onClick={onClick}\n        data-orientation={orientation}\n        style={\n          showOriginal\n            ? {\n                backgroundImage: `url(${previewUrl})`,\n                backgroundSize: imageSmallerThanParent\n                  ? `${width}px ${height}px`\n                  : undefined,\n              }\n            : mediaStyles\n        }\n      >\n        {showOriginal ? (\n          <QuickPinchZoom {...quickPinchZoomProps}>\n            <img\n              ref={mediaRef}\n              src={mediaURL}\n              alt={description}\n              width={width}\n              height={height}\n              data-orientation={orientation}\n              loading=\"eager\"\n              decoding=\"sync\"\n              onLoad={(e) => {\n                e.target.closest('.media-image').style.backgroundImage = '';\n                e.target.closest('.media-zoom').style.display = '';\n                setPinchZoomEnabled(true);\n              }}\n              onError={(e) => {\n                const { src } = e.target;\n                if (src === mediaURL) {\n                  e.target.src = remoteMediaURL;\n                }\n              }}\n            />\n          </QuickPinchZoom>\n        ) : (\n          <img\n            src={mediaURL}\n            alt={description}\n            width={width}\n            height={height}\n            data-orientation={orientation}\n            loading=\"lazy\"\n            style={{\n              backgroundColor:\n                rgbAverageColor && `rgb(${rgbAverageColor.join(',')})`,\n              backgroundPosition: focalBackgroundPosition || 'center',\n              // Duration based on width or height in pixels\n              // 100px per second (rough estimate)\n              // Clamp between 5s and 120s\n              '--anim-duration': `${Math.min(\n                Math.max(Math.max(width, height) / 100, 5),\n                120,\n              )}s`,\n            }}\n            onLoad={(e) => {\n              e.target.closest('.media-image').style.backgroundImage = '';\n              e.target.dataset.loaded = true;\n            }}\n            onError={(e) => {\n              const { src } = e.target;\n              if (src === mediaURL) {\n                e.target.src = remoteMediaURL;\n              }\n            }}\n          />\n        )}\n      </Parent>\n    );\n  } else if (type === 'gifv' || type === 'video') {\n    const shortDuration = original.duration < 31;\n    const isGIF = type === 'gifv' && shortDuration;\n    // If GIF is too long, treat it as a video\n    const loopable = original.duration < 61;\n    const formattedDuration = formatDuration(original.duration);\n    const hoverAnimate = !showOriginal && !autoAnimate && isGIF;\n    const autoGIFAnimate = !showOriginal && autoAnimate && isGIF;\n\n    const videoHTML = `\n    <video\n      src=\"${url}\"\n      poster=\"${previewUrl}\"\n      width=\"${width}\"\n      height=\"${height}\"\n      data-orientation=\"${orientation}\"\n      preload=\"auto\"\n      autoplay\n      muted=\"${isGIF}\"\n      ${isGIF ? '' : 'controls'}\n      playsinline\n      loop=\"${loopable}\"\n      ${isGIF ? 'ondblclick=\"this.paused ? this.play() : this.pause()\"' : ''}\n    ></video>\n  `;\n\n    return (\n      <Parent\n        class={`media media-${isGIF ? 'gif' : 'video'} ${\n          autoGIFAnimate ? 'media-contain' : ''\n        }`}\n        data-orientation={orientation}\n        data-formatted-duration={formattedDuration}\n        data-label={isGIF && !showOriginal && !autoGIFAnimate ? 'GIF' : ''}\n        // style={{\n        //   backgroundColor:\n        //     rgbAverageColor && `rgb(${rgbAverageColor.join(',')})`,\n        // }}\n        style={!showOriginal && mediaStyles}\n        onClick={(e) => {\n          if (hoverAnimate) {\n            try {\n              videoRef.current.pause();\n            } catch (e) {}\n          }\n          onClick(e);\n        }}\n        onMouseEnter={() => {\n          if (hoverAnimate) {\n            try {\n              videoRef.current.play();\n            } catch (e) {}\n          }\n        }}\n        onMouseLeave={() => {\n          if (hoverAnimate) {\n            try {\n              videoRef.current.pause();\n            } catch (e) {}\n          }\n        }}\n      >\n        {showOriginal || autoGIFAnimate ? (\n          isGIF && showOriginal ? (\n            <QuickPinchZoom {...quickPinchZoomProps} enabled>\n              <div\n                ref={mediaRef}\n                dangerouslySetInnerHTML={{\n                  __html: videoHTML,\n                }}\n              />\n            </QuickPinchZoom>\n          ) : (\n            <div\n              class=\"video-container\"\n              dangerouslySetInnerHTML={{\n                __html: videoHTML,\n              }}\n            />\n          )\n        ) : isGIF ? (\n          <video\n            ref={videoRef}\n            src={url}\n            poster={previewUrl}\n            width={width}\n            height={height}\n            data-orientation={orientation}\n            preload=\"auto\"\n            // controls\n            playsinline\n            loop\n            muted\n          />\n        ) : (\n          <>\n            <img\n              src={previewUrl}\n              alt={description}\n              width={width}\n              height={height}\n              data-orientation={orientation}\n              loading=\"lazy\"\n            />\n            <div class=\"media-play\">\n              <Icon icon=\"play\" size=\"xl\" />\n            </div>\n          </>\n        )}\n      </Parent>\n    );\n  } else if (type === 'audio') {\n    const formattedDuration = formatDuration(original.duration);\n    return (\n      <Parent\n        class=\"media media-audio\"\n        data-formatted-duration={formattedDuration}\n        onClick={onClick}\n        style={!showOriginal && mediaStyles}\n      >\n        {showOriginal ? (\n          <audio src={remoteUrl || url} preload=\"none\" controls autoplay />\n        ) : previewUrl ? (\n          <img\n            src={previewUrl}\n            alt={description}\n            width={width}\n            height={height}\n            data-orientation={orientation}\n            loading=\"lazy\"\n          />\n        ) : null}\n        {!showOriginal && (\n          <div class=\"media-play\">\n            <Icon icon=\"play\" size=\"xl\" />\n          </div>\n        )}\n      </Parent>\n    );\n  }\n}\n\nexport default Media;\n","import { FocusableItem } from '@szhsin/react-menu';\n\nimport Link from './link';\n\nfunction MenuLink(props) {\n  return (\n    <FocusableItem>\n      {({ ref, closeMenu }) => (\n        <Link\n          {...props}\n          ref={ref}\n          onClick={({ detail }) =>\n            closeMenu(detail === 0 ? 'Enter' : undefined)\n          }\n        />\n      )}\n    </FocusableItem>\n  );\n}\n\nexport default MenuLink;\n","import './status.css';\n\nimport '@justinribeiro/lite-youtube';\nimport {\n  ControlledMenu,\n  Menu,\n  MenuDivider,\n  MenuHeader,\n  MenuItem,\n} from '@szhsin/react-menu';\nimport { decodeBlurHash } from 'fast-blurhash';\nimport mem from 'mem';\nimport pThrottle from 'p-throttle';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useLongPress } from 'use-long-press';\nimport useResizeObserver from 'use-resize-observer';\nimport { useSnapshot } from 'valtio';\nimport { snapshot } from 'valtio/vanilla';\n\nimport AccountBlock from '../components/account-block';\nimport EmojiText from '../components/emoji-text';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Modal from '../components/modal';\nimport NameText from '../components/name-text';\nimport Poll from '../components/poll';\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport getHTMLText from '../utils/getHTMLText';\nimport handleContentLinks from '../utils/handle-content-links';\nimport htmlContentLength from '../utils/html-content-length';\nimport isMastodonLinkMaybe from '../utils/isMastodonLinkMaybe';\nimport localeMatch from '../utils/locale-match';\nimport niceDateTime from '../utils/nice-date-time';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { getStatus, saveStatus, statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport store from '../utils/store';\nimport visibilityIconsMap from '../utils/visibility-icons-map';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Link from './link';\nimport Media from './media';\nimport MenuLink from './menu-link';\nimport RelativeTime from './relative-time';\nimport TranslationBlock from './translation-block';\n\nconst INLINE_TRANSLATE_LIMIT = 140;\nconst throttle = pThrottle({\n  limit: 1,\n  interval: 1000,\n});\n\nfunction fetchAccount(id, masto) {\n  try {\n    return masto.v1.accounts.fetch(id);\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\nconst memFetchAccount = mem(fetchAccount);\n\nconst visibilityText = {\n  public: 'Public',\n  unlisted: 'Unlisted',\n  private: 'Followers only',\n  direct: 'Private mention',\n};\n\nfunction Status({\n  statusID,\n  status,\n  instance: propInstance,\n  withinContext,\n  size = 'm',\n  skeleton,\n  readOnly,\n  contentTextWeight,\n  enableTranslate,\n  forceTranslate: _forceTranslate,\n  previewMode,\n  allowFilters,\n  onMediaClick,\n  quoted,\n  onStatusLinkClick = () => {},\n}) {\n  if (skeleton) {\n    return (\n      <div class=\"status skeleton\">\n        <Avatar size=\"xxl\" />\n        <div class=\"container\">\n          <div class=\"meta\">███ ████████</div>\n          <div class=\"content-container\">\n            <div class=\"content\">\n              <p>████ ████████</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n  const { masto, instance, authenticated } = api({ instance: propInstance });\n  const { instance: currentInstance } = api();\n  const sameInstance = instance === currentInstance;\n\n  let sKey = statusKey(statusID, instance);\n  const snapStates = useSnapshot(states);\n  if (!status) {\n    status = snapStates.statuses[sKey] || snapStates.statuses[statusID];\n    sKey = statusKey(status?.id, instance);\n  }\n  if (!status) {\n    return null;\n  }\n\n  const {\n    account: {\n      acct,\n      avatar,\n      avatarStatic,\n      id: accountId,\n      url: accountURL,\n      displayName,\n      username,\n      emojis: accountEmojis,\n      bot,\n      group,\n    },\n    id,\n    repliesCount,\n    reblogged,\n    reblogsCount,\n    favourited,\n    favouritesCount,\n    bookmarked,\n    poll,\n    muted,\n    sensitive,\n    spoilerText,\n    visibility, // public, unlisted, private, direct\n    language,\n    editedAt,\n    filtered,\n    card,\n    createdAt,\n    inReplyToId,\n    inReplyToAccountId,\n    content,\n    mentions,\n    mediaAttachments,\n    reblog,\n    uri,\n    url,\n    emojis,\n    // Non-API props\n    _deleted,\n    _pinned,\n    _filtered,\n  } = status;\n\n  console.debug('RENDER Status', id, status?.account.displayName, quoted);\n\n  const debugHover = (e) => {\n    if (e.shiftKey) {\n      console.log({\n        ...status,\n      });\n    }\n  };\n\n  if (allowFilters && size !== 'l' && _filtered) {\n    return (\n      <FilteredStatus\n        status={status}\n        filterInfo={_filtered}\n        instance={instance}\n        containerProps={{\n          onMouseEnter: debugHover,\n        }}\n      />\n    );\n  }\n\n  const createdAtDate = new Date(createdAt);\n  const editedAtDate = new Date(editedAt);\n\n  const currentAccount = useMemo(() => {\n    return store.session.get('currentAccount');\n  }, []);\n  const isSelf = useMemo(() => {\n    return currentAccount && currentAccount === accountId;\n  }, [accountId, currentAccount]);\n\n  let inReplyToAccountRef = mentions?.find(\n    (mention) => mention.id === inReplyToAccountId,\n  );\n  if (!inReplyToAccountRef && inReplyToAccountId === id) {\n    inReplyToAccountRef = { url: accountURL, username, displayName };\n  }\n  const [inReplyToAccount, setInReplyToAccount] = useState(inReplyToAccountRef);\n  if (!withinContext && !inReplyToAccount && inReplyToAccountId) {\n    const account = states.accounts[inReplyToAccountId];\n    if (account) {\n      setInReplyToAccount(account);\n    } else {\n      memFetchAccount(inReplyToAccountId, masto)\n        .then((account) => {\n          setInReplyToAccount(account);\n          states.accounts[account.id] = account;\n        })\n        .catch((e) => {});\n    }\n  }\n  const mentionSelf =\n    inReplyToAccountId === currentAccount ||\n    mentions?.find((mention) => mention.id === currentAccount);\n\n  const showSpoiler = previewMode || !!snapStates.spoilers[id] || false;\n\n  if (reblog) {\n    // If has statusID, means useItemID (cached in states)\n\n    if (group) {\n      return (\n        <div class=\"status-group\" onMouseEnter={debugHover}>\n          <div class=\"status-pre-meta\">\n            <Icon icon=\"group\" size=\"l\" alt=\"Group\" />{' '}\n            <NameText account={status.account} instance={instance} showAvatar />\n          </div>\n          <Status\n            status={statusID ? null : reblog}\n            statusID={statusID ? reblog.id : null}\n            instance={instance}\n            size={size}\n            contentTextWeight={contentTextWeight}\n          />\n        </div>\n      );\n    }\n\n    return (\n      <div class=\"status-reblog\" onMouseEnter={debugHover}>\n        <div class=\"status-pre-meta\">\n          <Icon icon=\"rocket\" size=\"l\" />{' '}\n          <NameText account={status.account} instance={instance} showAvatar />{' '}\n          <span>boosted</span>\n        </div>\n        <Status\n          status={statusID ? null : reblog}\n          statusID={statusID ? reblog.id : null}\n          instance={instance}\n          size={size}\n          contentTextWeight={contentTextWeight}\n        />\n      </div>\n    );\n  }\n\n  const isSizeLarge = size === 'l';\n\n  const [forceTranslate, setForceTranslate] = useState(_forceTranslate);\n  const targetLanguage = getTranslateTargetLanguage(true);\n  const contentTranslationHideLanguages =\n    snapStates.settings.contentTranslationHideLanguages || [];\n  const { contentTranslation, contentTranslationAutoInline } =\n    snapStates.settings;\n  if (!contentTranslation) enableTranslate = false;\n  const inlineTranslate = useMemo(() => {\n    if (\n      !contentTranslation ||\n      !contentTranslationAutoInline ||\n      readOnly ||\n      (withinContext && !isSizeLarge) ||\n      previewMode ||\n      spoilerText ||\n      sensitive ||\n      poll ||\n      card ||\n      mediaAttachments?.length\n    ) {\n      return false;\n    }\n    const contentLength = htmlContentLength(content);\n    return contentLength > 0 && contentLength <= INLINE_TRANSLATE_LIMIT;\n  }, [\n    contentTranslation,\n    contentTranslationAutoInline,\n    readOnly,\n    withinContext,\n    isSizeLarge,\n    previewMode,\n    spoilerText,\n    sensitive,\n    poll,\n    card,\n    mediaAttachments,\n    content,\n  ]);\n\n  const [showEdited, setShowEdited] = useState(false);\n  const [showReactions, setShowReactions] = useState(false);\n\n  const spoilerContentRef = useRef(null);\n  useResizeObserver({\n    ref: spoilerContentRef,\n    onResize: () => {\n      if (spoilerContentRef.current) {\n        const { scrollHeight, clientHeight } = spoilerContentRef.current;\n        if (scrollHeight < window.innerHeight * 0.4) {\n          spoilerContentRef.current.classList.remove('truncated');\n        } else {\n          spoilerContentRef.current.classList.toggle(\n            'truncated',\n            scrollHeight > clientHeight,\n          );\n        }\n      }\n    },\n  });\n  const contentRef = useRef(null);\n  useResizeObserver({\n    ref: contentRef,\n    onResize: () => {\n      if (contentRef.current) {\n        const { scrollHeight, clientHeight } = contentRef.current;\n        if (scrollHeight < window.innerHeight * 0.4) {\n          contentRef.current.classList.remove('truncated');\n        } else {\n          contentRef.current.classList.toggle(\n            'truncated',\n            scrollHeight > clientHeight,\n          );\n        }\n      }\n    },\n  });\n  const readMoreText = 'Read more →';\n\n  const statusRef = useRef(null);\n\n  const unauthInteractionErrorMessage = `Sorry, your current logged-in instance can't interact with this post from another instance.`;\n\n  const textWeight = useCallback(\n    () =>\n      Math.max(\n        Math.round((spoilerText.length + htmlContentLength(content)) / 140) ||\n          1,\n        1,\n      ),\n    [spoilerText, content],\n  );\n\n  const createdDateText = niceDateTime(createdAtDate);\n  const editedDateText = editedAt && niceDateTime(editedAtDate);\n\n  // Can boost if:\n  // - authenticated AND\n  // - visibility != direct OR\n  // - visibility = private AND isSelf\n  let canBoost =\n    authenticated && visibility !== 'direct' && visibility !== 'private';\n  if (visibility === 'private' && isSelf) {\n    canBoost = true;\n  }\n\n  const replyStatus = () => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    states.showCompose = {\n      replyToStatus: status,\n    };\n  };\n\n  // Check if media has no descriptions\n  const mediaNoDesc = useMemo(() => {\n    return mediaAttachments.some(\n      (attachment) => !attachment.description?.trim?.(),\n    );\n  }, [mediaAttachments]);\n  const boostStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      alert(unauthInteractionErrorMessage);\n      return false;\n    }\n    try {\n      if (!reblogged) {\n        let confirmText = 'Boost this post?';\n        if (mediaNoDesc) {\n          confirmText += '\\n\\n⚠️ Some media have no descriptions.';\n        }\n        const yes = confirm(confirmText);\n        if (!yes) {\n          return false;\n        }\n      }\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        reblogged: !reblogged,\n        reblogsCount: reblogsCount + (reblogged ? -1 : 1),\n      };\n      if (reblogged) {\n        const newStatus = await masto.v1.statuses.unreblog(id);\n        saveStatus(newStatus, instance);\n        return true;\n      } else {\n        const newStatus = await masto.v1.statuses.reblog(id);\n        saveStatus(newStatus, instance);\n        return true;\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n      return false;\n    }\n  };\n  const confirmBoostStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      alert(unauthInteractionErrorMessage);\n      return false;\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        reblogged: !reblogged,\n        reblogsCount: reblogsCount + (reblogged ? -1 : 1),\n      };\n      if (reblogged) {\n        const newStatus = await masto.v1.statuses.unreblog(id);\n        saveStatus(newStatus, instance);\n        return true;\n      } else {\n        const newStatus = await masto.v1.statuses.reblog(id);\n        saveStatus(newStatus, instance);\n        return true;\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n      return false;\n    }\n  };\n\n  const favouriteStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        favourited: !favourited,\n        favouritesCount: favouritesCount + (favourited ? -1 : 1),\n      };\n      if (favourited) {\n        const newStatus = await masto.v1.statuses.unfavourite(id);\n        saveStatus(newStatus, instance);\n      } else {\n        const newStatus = await masto.v1.statuses.favourite(id);\n        saveStatus(newStatus, instance);\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n    }\n  };\n\n  const bookmarkStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        bookmarked: !bookmarked,\n      };\n      if (bookmarked) {\n        const newStatus = await masto.v1.statuses.unbookmark(id);\n        saveStatus(newStatus, instance);\n      } else {\n        const newStatus = await masto.v1.statuses.bookmark(id);\n        saveStatus(newStatus, instance);\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n    }\n  };\n\n  const differentLanguage =\n    language &&\n    language !== targetLanguage &&\n    !localeMatch([language], [targetLanguage]) &&\n    !contentTranslationHideLanguages.find(\n      (l) => language === l || localeMatch([language], [l]),\n    );\n\n  const menuInstanceRef = useRef();\n  const StatusMenuItems = (\n    <>\n      {!isSizeLarge && (\n        <>\n          <MenuHeader>\n            <span class=\"ib\">\n              <Icon icon={visibilityIconsMap[visibility]} size=\"s\" />{' '}\n              <span>{visibilityText[visibility]}</span>\n            </span>{' '}\n            <span class=\"ib\">\n              {repliesCount > 0 && (\n                <span>\n                  <Icon icon=\"reply\" alt=\"Replies\" size=\"s\" />{' '}\n                  <span>{shortenNumber(repliesCount)}</span>\n                </span>\n              )}{' '}\n              {reblogsCount > 0 && (\n                <span>\n                  <Icon icon=\"rocket\" alt=\"Boosts\" size=\"s\" />{' '}\n                  <span>{shortenNumber(reblogsCount)}</span>\n                </span>\n              )}{' '}\n              {favouritesCount > 0 && (\n                <span>\n                  <Icon icon=\"heart\" alt=\"Favourites\" size=\"s\" />{' '}\n                  <span>{shortenNumber(favouritesCount)}</span>\n                </span>\n              )}\n            </span>\n            <br />\n            {createdDateText}\n          </MenuHeader>\n          <MenuLink\n            to={instance ? `/${instance}/s/${id}` : `/s/${id}`}\n            onClick={onStatusLinkClick}\n          >\n            <Icon icon=\"arrow-right\" />\n            <span>View post by @{username || acct}</span>\n          </MenuLink>\n        </>\n      )}\n      {!!editedAt && (\n        <MenuItem\n          onClick={() => {\n            setShowEdited(id);\n          }}\n        >\n          <Icon icon=\"history\" />\n          <span>\n            Show Edit History\n            <br />\n            <small class=\"more-insignificant\">Edited: {editedDateText}</small>\n          </span>\n        </MenuItem>\n      )}\n      {(!isSizeLarge || !!editedAt) && <MenuDivider />}\n      {isSizeLarge && (\n        <MenuItem onClick={() => setShowReactions(true)}>\n          <Icon icon=\"react\" />\n          <span>\n            Boosted/Favourited by<span class=\"more-insignificant\">…</span>\n          </span>\n        </MenuItem>\n      )}\n      {!isSizeLarge && sameInstance && (\n        <>\n          <div class=\"menu-horizontal\">\n            <MenuConfirm\n              subMenu\n              confirmLabel={\n                <>\n                  <Icon icon=\"rocket\" />\n                  <span>{reblogged ? 'Unboost?' : 'Boost to everyone?'}</span>\n                </>\n              }\n              menuFooter={\n                mediaNoDesc &&\n                !reblogged && (\n                  <div class=\"footer\">\n                    <Icon icon=\"alert\" />\n                    Some media have no descriptions.\n                  </div>\n                )\n              }\n              disabled={!canBoost}\n              onClick={async () => {\n                try {\n                  const done = await confirmBoostStatus();\n                  if (!isSizeLarge && done) {\n                    showToast(reblogged ? 'Unboosted' : 'Boosted');\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"rocket\"\n                style={{\n                  color: reblogged && 'var(--reblog-color)',\n                }}\n              />\n              <span>{reblogged ? 'Unboost' : 'Boost…'}</span>\n            </MenuConfirm>\n            <MenuItem\n              onClick={() => {\n                try {\n                  favouriteStatus();\n                  if (!isSizeLarge)\n                    showToast(favourited ? 'Unfavourited' : 'Favourited');\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"heart\"\n                style={{\n                  color: favourited && 'var(--favourite-color)',\n                }}\n              />\n              <span>{favourited ? 'Unfavourite' : 'Favourite'}</span>\n            </MenuItem>\n          </div>\n          <div class=\"menu-horizontal\">\n            <MenuItem onClick={replyStatus}>\n              <Icon icon=\"reply\" />\n              <span>Reply</span>\n            </MenuItem>\n            <MenuItem\n              onClick={() => {\n                try {\n                  bookmarkStatus();\n                  if (!isSizeLarge)\n                    showToast(bookmarked ? 'Unbookmarked' : 'Bookmarked');\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"bookmark\"\n                style={{\n                  color: bookmarked && 'var(--link-color)',\n                }}\n              />\n              <span>{bookmarked ? 'Unbookmark' : 'Bookmark'}</span>\n            </MenuItem>\n          </div>\n        </>\n      )}\n      {enableTranslate ? (\n        <MenuItem\n          disabled={forceTranslate}\n          onClick={() => {\n            setForceTranslate(true);\n          }}\n        >\n          <Icon icon=\"translate\" />\n          <span>Translate</span>\n        </MenuItem>\n      ) : (\n        (!language || differentLanguage) && (\n          <MenuLink\n            to={`${instance ? `/${instance}` : ''}/s/${id}?translate=1`}\n          >\n            <Icon icon=\"translate\" />\n            <span>Translate</span>\n          </MenuLink>\n        )\n      )}\n      {((!isSizeLarge && sameInstance) || enableTranslate) && <MenuDivider />}\n      <MenuItem href={url} target=\"_blank\">\n        <Icon icon=\"external\" />\n        <small class=\"menu-double-lines\">{nicePostURL(url)}</small>\n      </MenuItem>\n      <div class=\"menu-horizontal\">\n        <MenuItem\n          onClick={() => {\n            // Copy url to clipboard\n            try {\n              navigator.clipboard.writeText(url);\n              showToast('Link copied');\n            } catch (e) {\n              console.error(e);\n              showToast('Unable to copy link');\n            }\n          }}\n        >\n          <Icon icon=\"link\" />\n          <span>Copy</span>\n        </MenuItem>\n        {navigator?.share &&\n          navigator?.canShare?.({\n            url,\n          }) && (\n            <MenuItem\n              onClick={() => {\n                try {\n                  navigator.share({\n                    url,\n                  });\n                } catch (e) {\n                  console.error(e);\n                  alert(\"Sharing doesn't seem to work.\");\n                }\n              }}\n            >\n              <Icon icon=\"share\" />\n              <span>Share…</span>\n            </MenuItem>\n          )}\n      </div>\n      {(isSelf || mentionSelf) && <MenuDivider />}\n      {(isSelf || mentionSelf) && (\n        <MenuItem\n          onClick={async () => {\n            try {\n              const newStatus = await masto.v1.statuses[\n                muted ? 'unmute' : 'mute'\n              ](id);\n              saveStatus(newStatus, instance);\n              showToast(muted ? 'Conversation unmuted' : 'Conversation muted');\n            } catch (e) {\n              console.error(e);\n              showToast(\n                muted\n                  ? 'Unable to unmute conversation'\n                  : 'Unable to mute conversation',\n              );\n            }\n          }}\n        >\n          {muted ? (\n            <>\n              <Icon icon=\"unmute\" />\n              <span>Unmute conversation</span>\n            </>\n          ) : (\n            <>\n              <Icon icon=\"mute\" />\n              <span>Mute conversation</span>\n            </>\n          )}\n        </MenuItem>\n      )}\n      {isSelf && (\n        <div class=\"menu-horizontal\">\n          <MenuItem\n            onClick={() => {\n              states.showCompose = {\n                editStatus: status,\n              };\n            }}\n          >\n            <Icon icon=\"pencil\" />\n            <span>Edit</span>\n          </MenuItem>\n          {isSizeLarge && (\n            <MenuConfirm\n              subMenu\n              confirmLabel={\n                <>\n                  <Icon icon=\"trash\" />\n                  <span>Delete this post?</span>\n                </>\n              }\n              menuItemClassName=\"danger\"\n              onClick={() => {\n                // const yes = confirm('Delete this post?');\n                // if (yes) {\n                (async () => {\n                  try {\n                    await masto.v1.statuses.remove(id);\n                    const cachedStatus = getStatus(id, instance);\n                    cachedStatus._deleted = true;\n                    showToast('Deleted');\n                  } catch (e) {\n                    console.error(e);\n                    showToast('Unable to delete');\n                  }\n                })();\n                // }\n              }}\n            >\n              <Icon icon=\"trash\" />\n              <span>Delete…</span>\n            </MenuConfirm>\n          )}\n        </div>\n      )}\n    </>\n  );\n\n  const contextMenuRef = useRef();\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuAnchorPoint, setContextMenuAnchorPoint] = useState({\n    x: 0,\n    y: 0,\n  });\n  const bindLongPressContext = useLongPress(\n    (e) => {\n      const { clientX, clientY } = e.touches?.[0] || e;\n      // link detection copied from onContextMenu because here it works\n      const link = e.target.closest('a');\n      if (link && /^https?:\\/\\//.test(link.getAttribute('href'))) return;\n      e.preventDefault();\n      setContextMenuAnchorPoint({\n        x: clientX,\n        y: clientY,\n      });\n      setIsContextMenuOpen(true);\n    },\n    {\n      threshold: 600,\n      captureEvent: true,\n      detect: 'touch',\n      cancelOnMovement: 4, // true allows movement of up to 25 pixels\n    },\n  );\n\n  const showContextMenu = size !== 'l' && !previewMode && !_deleted && !quoted;\n\n  return (\n    <article\n      ref={statusRef}\n      tabindex=\"-1\"\n      class={`status ${\n        !withinContext && inReplyToAccount ? 'status-reply-to' : ''\n      } visibility-${visibility} ${_pinned ? 'status-pinned' : ''} ${\n        {\n          s: 'small',\n          m: 'medium',\n          l: 'large',\n        }[size]\n      } ${_deleted ? 'status-deleted' : ''} ${quoted ? 'status-card' : ''}`}\n      onMouseEnter={debugHover}\n      onContextMenu={(e) => {\n        // FIXME: this code isn't getting called on Chrome at all?\n        if (!showContextMenu) return;\n        if (e.metaKey) return;\n        // console.log('context menu', e);\n        const link = e.target.closest('a');\n        if (link && /^https?:\\/\\//.test(link.getAttribute('href'))) return;\n        e.preventDefault();\n        setContextMenuAnchorPoint({\n          x: e.clientX,\n          y: e.clientY,\n        });\n        setIsContextMenuOpen(true);\n      }}\n      {...(showContextMenu ? bindLongPressContext() : {})}\n    >\n      {showContextMenu && (\n        <ControlledMenu\n          ref={contextMenuRef}\n          state={isContextMenuOpen ? 'open' : undefined}\n          anchorPoint={contextMenuAnchorPoint}\n          direction=\"right\"\n          onClose={(e) => {\n            setIsContextMenuOpen(false);\n            // statusRef.current?.focus?.();\n            if (e?.reason === 'click') {\n              statusRef.current?.closest('[tabindex]')?.focus?.();\n            }\n          }}\n          portal={{\n            target: document.body,\n          }}\n          containerProps={{\n            style: {\n              // Higher than the backdrop\n              zIndex: 1001,\n            },\n            onClick: () => {\n              contextMenuRef.current?.closeMenu?.();\n            },\n          }}\n          overflow=\"auto\"\n          boundingBoxPadding={safeBoundingBoxPadding()}\n          unmountOnClose\n        >\n          {StatusMenuItems}\n        </ControlledMenu>\n      )}\n      {size !== 'l' && (\n        <div class=\"status-badge\">\n          {reblogged && <Icon class=\"reblog\" icon=\"rocket\" size=\"s\" />}\n          {favourited && <Icon class=\"favourite\" icon=\"heart\" size=\"s\" />}\n          {bookmarked && <Icon class=\"bookmark\" icon=\"bookmark\" size=\"s\" />}\n          {_pinned && <Icon class=\"pin\" icon=\"pin\" size=\"s\" />}\n        </div>\n      )}\n      {size !== 's' && (\n        <a\n          href={accountURL}\n          tabindex=\"-1\"\n          // target=\"_blank\"\n          title={`@${acct}`}\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            states.showAccount = {\n              account: status.account,\n              instance,\n            };\n          }}\n        >\n          <Avatar url={avatarStatic || avatar} size=\"xxl\" squircle={bot} />\n        </a>\n      )}\n      <div class=\"container\">\n        <div class=\"meta\">\n          {/* <span> */}\n          <NameText\n            account={status.account}\n            instance={instance}\n            showAvatar={size === 's'}\n            showAcct={isSizeLarge}\n          />\n          {/* {inReplyToAccount && !withinContext && size !== 's' && (\n              <>\n                {' '}\n                <span class=\"ib\">\n                  <Icon icon=\"arrow-right\" class=\"arrow\" />{' '}\n                  <NameText account={inReplyToAccount} instance={instance} short />\n                </span>\n              </>\n            )} */}\n          {/* </span> */}{' '}\n          {size !== 'l' &&\n            (_deleted ? (\n              <span class=\"status-deleted-tag\">Deleted</span>\n            ) : url && !previewMode && !quoted ? (\n              <Menu\n                instanceRef={menuInstanceRef}\n                portal={{\n                  target: document.body,\n                }}\n                containerProps={{\n                  style: {\n                    // Higher than the backdrop\n                    zIndex: 1001,\n                  },\n                  onClick: (e) => {\n                    if (e.target === e.currentTarget)\n                      menuInstanceRef.current?.closeMenu?.();\n                  },\n                }}\n                align=\"end\"\n                gap={4}\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                boundingBoxPadding=\"8 8 8 8\"\n                unmountOnClose\n                menuButton={({ open }) => (\n                  <Link\n                    to={instance ? `/${instance}/s/${id}` : `/s/${id}`}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      onStatusLinkClick?.();\n                    }}\n                    class={`time ${open ? 'is-open' : ''}`}\n                  >\n                    <Icon\n                      icon={visibilityIconsMap[visibility]}\n                      alt={visibilityText[visibility]}\n                      size=\"s\"\n                    />{' '}\n                    <RelativeTime datetime={createdAtDate} format=\"micro\" />\n                  </Link>\n                )}\n              >\n                {StatusMenuItems}\n              </Menu>\n            ) : (\n              <span class=\"time\">\n                <Icon\n                  icon={visibilityIconsMap[visibility]}\n                  alt={visibilityText[visibility]}\n                  size=\"s\"\n                />{' '}\n                <RelativeTime datetime={createdAtDate} format=\"micro\" />\n              </span>\n            ))}\n        </div>\n        {visibility === 'direct' && (\n          <>\n            <div class=\"status-direct-badge\">Private mention</div>{' '}\n          </>\n        )}\n        {!withinContext && (\n          <>\n            {inReplyToAccountId === status.account?.id ||\n            !!snapStates.statusThreadNumber[sKey] ? (\n              <div class=\"status-thread-badge\">\n                <Icon icon=\"thread\" size=\"s\" />\n                Thread\n                {snapStates.statusThreadNumber[sKey]\n                  ? ` ${snapStates.statusThreadNumber[sKey]}/X`\n                  : ''}\n              </div>\n            ) : (\n              !!inReplyToId &&\n              !!inReplyToAccount &&\n              (!!spoilerText ||\n                !mentions.find((mention) => {\n                  return mention.id === inReplyToAccountId;\n                })) && (\n                <div class=\"status-reply-badge\">\n                  <Icon icon=\"reply\" />{' '}\n                  <NameText\n                    account={inReplyToAccount}\n                    instance={instance}\n                    short\n                  />\n                </div>\n              )\n            )}\n          </>\n        )}\n        <div\n          class={`content-container ${\n            spoilerText || sensitive ? 'has-spoiler' : ''\n          } ${showSpoiler ? 'show-spoiler' : ''}`}\n          data-content-text-weight={contentTextWeight ? textWeight() : null}\n          style={\n            (isSizeLarge || contentTextWeight) && {\n              '--content-text-weight': textWeight(),\n            }\n          }\n        >\n          {!!spoilerText && (\n            <>\n              <div\n                class=\"content spoiler-content\"\n                lang={language}\n                dir=\"auto\"\n                ref={spoilerContentRef}\n                data-read-more={readMoreText}\n              >\n                <p>\n                  <EmojiText text={spoilerText} emojis={emojis} />\n                </p>\n              </div>\n              <button\n                class={`light spoiler ${showSpoiler ? 'spoiling' : ''}`}\n                type=\"button\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  if (showSpoiler) {\n                    delete states.spoilers[id];\n                  } else {\n                    states.spoilers[id] = true;\n                  }\n                }}\n              >\n                <Icon icon={showSpoiler ? 'eye-open' : 'eye-close'} />{' '}\n                {showSpoiler ? 'Show less' : 'Show more'}\n              </button>\n            </>\n          )}\n          <div class=\"content\" ref={contentRef} data-read-more={readMoreText}>\n            <div\n              lang={language}\n              dir=\"auto\"\n              class=\"inner-content\"\n              onClick={handleContentLinks({ mentions, instance, previewMode })}\n              dangerouslySetInnerHTML={{\n                __html: enhanceContent(content, {\n                  emojis,\n                  postEnhanceDOM: (dom) => {\n                    // Remove target=\"_blank\" from links\n                    dom\n                      .querySelectorAll('a.u-url[target=\"_blank\"]')\n                      .forEach((a) => {\n                        if (!/http/i.test(a.innerText.trim())) {\n                          a.removeAttribute('target');\n                        }\n                      });\n                    if (previewMode) return;\n                    // Unfurl Mastodon links\n                    Array.from(\n                      dom.querySelectorAll(\n                        'a[href]:not(.u-url):not(.mention):not(.hashtag)',\n                      ),\n                    )\n                      .filter((a) => {\n                        const url = a.href;\n                        const isPostItself =\n                          url === status.url || url === status.uri;\n                        return !isPostItself && isMastodonLinkMaybe(url);\n                      })\n                      .forEach((a, i) => {\n                        unfurlMastodonLink(currentInstance, a.href).then(\n                          (result) => {\n                            if (!result) return;\n                            a.removeAttribute('target');\n                            if (!sKey) return;\n                            if (!Array.isArray(states.statusQuotes[sKey])) {\n                              states.statusQuotes[sKey] = [];\n                            }\n                            if (!states.statusQuotes[sKey][i]) {\n                              states.statusQuotes[sKey].splice(i, 0, result);\n                            }\n                          },\n                        );\n                      });\n                  },\n                }),\n              }}\n            />\n            <QuoteStatuses id={id} instance={instance} level={quoted} />\n          </div>\n          {!!poll && (\n            <Poll\n              lang={language}\n              poll={poll}\n              readOnly={readOnly || !sameInstance || !authenticated}\n              onUpdate={(newPoll) => {\n                states.statuses[sKey].poll = newPoll;\n              }}\n              refresh={() => {\n                return masto.v1.polls\n                  .fetch(poll.id)\n                  .then((pollResponse) => {\n                    states.statuses[sKey].poll = pollResponse;\n                  })\n                  .catch((e) => {}); // Silently fail\n              }}\n              votePoll={(choices) => {\n                return masto.v1.polls\n                  .vote(poll.id, {\n                    choices,\n                  })\n                  .then((pollResponse) => {\n                    states.statuses[sKey].poll = pollResponse;\n                  })\n                  .catch((e) => {}); // Silently fail\n              }}\n            />\n          )}\n          {(((enableTranslate || inlineTranslate) &&\n            !!content.trim() &&\n            differentLanguage) ||\n            forceTranslate) && (\n            <TranslationBlock\n              forceTranslate={forceTranslate || inlineTranslate}\n              mini={!isSizeLarge && !withinContext}\n              sourceLanguage={language}\n              text={\n                (spoilerText ? `${spoilerText}\\n\\n` : '') +\n                getHTMLText(content) +\n                (poll?.options?.length\n                  ? `\\n\\nPoll:\\n${poll.options\n                      .map(\n                        (option) =>\n                          `- ${option.title}${\n                            option.votesCount >= 0\n                              ? ` (${option.votesCount})`\n                              : ''\n                          }`,\n                      )\n                      .join('\\n')}`\n                  : '')\n              }\n            />\n          )}\n          {!spoilerText && sensitive && !!mediaAttachments.length && (\n            <button\n              class={`plain spoiler ${showSpoiler ? 'spoiling' : ''}`}\n              type=\"button\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (showSpoiler) {\n                  delete states.spoilers[id];\n                } else {\n                  states.spoilers[id] = true;\n                }\n              }}\n            >\n              <Icon icon={showSpoiler ? 'eye-open' : 'eye-close'} /> Sensitive\n              content\n            </button>\n          )}\n          {!!mediaAttachments.length && (\n            <div\n              class={`media-container media-eq${mediaAttachments.length} ${\n                mediaAttachments.length > 2 ? 'media-gt2' : ''\n              } ${mediaAttachments.length > 4 ? 'media-gt4' : ''}`}\n            >\n              {mediaAttachments\n                .slice(0, isSizeLarge ? undefined : 4)\n                .map((media, i) => (\n                  <Media\n                    key={media.id}\n                    media={media}\n                    autoAnimate={isSizeLarge}\n                    to={`/${instance}/s/${id}?${\n                      withinContext ? 'media' : 'media-only'\n                    }=${i + 1}`}\n                    onClick={\n                      onMediaClick\n                        ? (e) => {\n                            onMediaClick(e, i, media, status);\n                          }\n                        : undefined\n                    }\n                  />\n                ))}\n            </div>\n          )}\n          {!!card &&\n            card?.url !== status.url &&\n            card?.url !== status.uri &&\n            /^https/i.test(card?.url) &&\n            !sensitive &&\n            !spoilerText &&\n            !poll &&\n            !mediaAttachments.length &&\n            !snapStates.statusQuotes[sKey] && (\n              <Card card={card} instance={currentInstance} />\n            )}\n        </div>\n        {isSizeLarge && (\n          <>\n            <div class=\"extra-meta\">\n              {_deleted ? (\n                <span class=\"status-deleted-tag\">Deleted</span>\n              ) : (\n                <>\n                  <Icon\n                    icon={visibilityIconsMap[visibility]}\n                    alt={visibilityText[visibility]}\n                  />{' '}\n                  <a href={url} target=\"_blank\">\n                    <time\n                      class=\"created\"\n                      datetime={createdAtDate.toISOString()}\n                    >\n                      {createdDateText}\n                    </time>\n                  </a>\n                  {editedAt && (\n                    <>\n                      {' '}\n                      &bull; <Icon icon=\"pencil\" alt=\"Edited\" />{' '}\n                      <time\n                        class=\"edited\"\n                        datetime={editedAtDate.toISOString()}\n                        onClick={() => {\n                          setShowEdited(id);\n                        }}\n                      >\n                        {editedDateText}\n                      </time>\n                    </>\n                  )}\n                </>\n              )}\n            </div>\n            <div class={`actions ${_deleted ? 'disabled' : ''}`}>\n              <div class=\"action has-count\">\n                <StatusButton\n                  title=\"Reply\"\n                  alt=\"Comments\"\n                  class=\"reply-button\"\n                  icon=\"comment\"\n                  count={repliesCount}\n                  onClick={replyStatus}\n                />\n              </div>\n              {/* <div class=\"action has-count\">\n                <StatusButton\n                  checked={reblogged}\n                  title={['Boost', 'Unboost']}\n                  alt={['Boost', 'Boosted']}\n                  class=\"reblog-button\"\n                  icon=\"rocket\"\n                  count={reblogsCount}\n                  onClick={boostStatus}\n                  disabled={!canBoost}\n                />\n              </div> */}\n              <MenuConfirm\n                disabled={!canBoost}\n                onClick={confirmBoostStatus}\n                confirmLabel={\n                  <>\n                    <Icon icon=\"rocket\" />\n                    <span>{reblogged ? 'Unboost?' : 'Boost to everyone?'}</span>\n                  </>\n                }\n                menuFooter={\n                  mediaNoDesc &&\n                  !reblogged && (\n                    <div class=\"footer\">\n                      <Icon icon=\"alert\" />\n                      Some media have no descriptions.\n                    </div>\n                  )\n                }\n              >\n                <div class=\"action has-count\">\n                  <StatusButton\n                    checked={reblogged}\n                    title={['Boost', 'Unboost']}\n                    alt={['Boost', 'Boosted']}\n                    class=\"reblog-button\"\n                    icon=\"rocket\"\n                    count={reblogsCount}\n                    // onClick={boostStatus}\n                    disabled={!canBoost}\n                  />\n                </div>\n              </MenuConfirm>\n              <div class=\"action has-count\">\n                <StatusButton\n                  checked={favourited}\n                  title={['Favourite', 'Unfavourite']}\n                  alt={['Favourite', 'Favourited']}\n                  class=\"favourite-button\"\n                  icon=\"heart\"\n                  count={favouritesCount}\n                  onClick={favouriteStatus}\n                />\n              </div>\n              <div class=\"action\">\n                <StatusButton\n                  checked={bookmarked}\n                  title={['Bookmark', 'Unbookmark']}\n                  alt={['Bookmark', 'Bookmarked']}\n                  class=\"bookmark-button\"\n                  icon=\"bookmark\"\n                  onClick={bookmarkStatus}\n                />\n              </div>\n              <Menu\n                portal={{\n                  target:\n                    document.querySelector('.status-deck') || document.body,\n                }}\n                align=\"end\"\n                gap={4}\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                boundingBoxPadding=\"8 8 8 8\"\n                menuButton={\n                  <div class=\"action\">\n                    <button\n                      type=\"button\"\n                      title=\"More\"\n                      class=\"plain more-button\"\n                    >\n                      <Icon icon=\"more\" size=\"l\" alt=\"More\" />\n                    </button>\n                  </div>\n                }\n              >\n                {StatusMenuItems}\n              </Menu>\n            </div>\n          </>\n        )}\n      </div>\n      {!!showEdited && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowEdited(false);\n              statusRef.current?.focus();\n            }\n          }}\n        >\n          <EditedAtModal\n            statusID={showEdited}\n            instance={instance}\n            fetchStatusHistory={() => {\n              return masto.v1.statuses.listHistory(showEdited);\n            }}\n            onClose={() => {\n              setShowEdited(false);\n              statusRef.current?.focus();\n            }}\n          />\n        </Modal>\n      )}\n      {showReactions && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowReactions(false);\n            }\n          }}\n        >\n          <ReactionsModal\n            statusID={id}\n            instance={instance}\n            onClose={() => setShowReactions(false)}\n          />\n        </Modal>\n      )}\n    </article>\n  );\n}\n\nfunction Card({ card, instance }) {\n  const snapStates = useSnapshot(states);\n  const {\n    blurhash,\n    title,\n    description,\n    html,\n    providerName,\n    authorName,\n    width,\n    height,\n    image,\n    url,\n    type,\n    embedUrl,\n  } = card;\n\n  /* type\n  link = Link OEmbed\n  photo = Photo OEmbed\n  video = Video OEmbed\n  rich = iframe OEmbed. Not currently accepted, so won’t show up in practice.\n  */\n\n  const hasText = title || providerName || authorName;\n  const isLandscape = width / height >= 1.2;\n  const size = isLandscape ? 'large' : '';\n\n  const [cardStatusURL, setCardStatusURL] = useState(null);\n  // const [cardStatusID, setCardStatusID] = useState(null);\n  useEffect(() => {\n    if (hasText && image && isMastodonLinkMaybe(url)) {\n      unfurlMastodonLink(instance, url).then((result) => {\n        if (!result) return;\n        const { id, url } = result;\n        setCardStatusURL('#' + url);\n\n        // NOTE: This is for quote post\n        // (async () => {\n        //   const { masto } = api({ instance });\n        //   const status = await masto.v1.statuses.fetch(id);\n        //   saveStatus(status, instance);\n        //   setCardStatusID(id);\n        // })();\n      });\n    }\n  }, [hasText, image]);\n\n  // if (cardStatusID) {\n  //   return (\n  //     <Status statusID={cardStatusID} instance={instance} size=\"s\" readOnly />\n  //   );\n  // }\n\n  if (snapStates.unfurledLinks[url]) return null;\n\n  if (hasText && (image || (type === 'photo' && blurhash))) {\n    const domain = new URL(url).hostname.replace(/^www\\./, '');\n    let blurhashImage;\n    if (!image) {\n      const w = 44;\n      const h = 44;\n      const blurhashPixels = decodeBlurHash(blurhash, w, h);\n      const canvas = document.createElement('canvas');\n      canvas.width = w;\n      canvas.height = h;\n      const ctx = canvas.getContext('2d');\n      const imageData = ctx.createImageData(w, h);\n      imageData.data.set(blurhashPixels);\n      ctx.putImageData(imageData, 0, 0);\n      blurhashImage = canvas.toDataURL();\n    }\n    return (\n      <a\n        href={cardStatusURL || url}\n        target={cardStatusURL ? null : '_blank'}\n        rel=\"nofollow noopener noreferrer\"\n        class={`card link ${blurhashImage ? '' : size}`}\n      >\n        <div class=\"card-image\">\n          <img\n            src={image || blurhashImage}\n            width={width}\n            height={height}\n            loading=\"lazy\"\n            alt=\"\"\n            onError={(e) => {\n              try {\n                e.target.style.display = 'none';\n              } catch (e) {}\n            }}\n          />\n        </div>\n        <div class=\"meta-container\">\n          <p class=\"meta domain\">{domain}</p>\n          <p class=\"title\">{title}</p>\n          <p class=\"meta\">{description || providerName || authorName}</p>\n        </div>\n      </a>\n    );\n  } else if (type === 'photo') {\n    return (\n      <a\n        href={url}\n        target=\"_blank\"\n        rel=\"nofollow noopener noreferrer\"\n        class=\"card photo\"\n      >\n        <img\n          src={embedUrl}\n          width={width}\n          height={height}\n          alt={title || description}\n          loading=\"lazy\"\n          style={{\n            height: 'auto',\n            aspectRatio: `${width}/${height}`,\n          }}\n        />\n      </a>\n    );\n  } else if (type === 'video') {\n    if (/youtube/i.test(providerName)) {\n      // Get ID from e.g. https://www.youtube.com/watch?v=[VIDEO_ID]\n      const videoID = url.match(/watch\\?v=([^&]+)/)?.[1];\n      if (videoID) {\n        return <lite-youtube videoid={videoID} nocookie></lite-youtube>;\n      }\n    }\n    return (\n      <div\n        class=\"card video\"\n        style={{\n          aspectRatio: `${width}/${height}`,\n        }}\n        dangerouslySetInnerHTML={{ __html: html }}\n      />\n    );\n  } else if (hasText && !image) {\n    const domain = new URL(url).hostname.replace(/^www\\./, '');\n    return (\n      <a\n        href={cardStatusURL || url}\n        target={cardStatusURL ? null : '_blank'}\n        rel=\"nofollow noopener noreferrer\"\n        class={`card link no-image`}\n      >\n        <div class=\"meta-container\">\n          <p class=\"meta domain\">\n            <Icon icon=\"link\" size=\"s\" /> <span>{domain}</span>\n          </p>\n          <p class=\"title\">{title}</p>\n          <p class=\"meta\">{description || providerName || authorName}</p>\n        </div>\n      </a>\n    );\n  }\n}\n\nfunction EditedAtModal({\n  statusID,\n  instance,\n  fetchStatusHistory = () => {},\n  onClose,\n}) {\n  const [uiState, setUIState] = useState('default');\n  const [editHistory, setEditHistory] = useState([]);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const editHistory = await fetchStatusHistory();\n        console.log(editHistory);\n        setEditHistory(editHistory);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"edit-history\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <h2>Edit History</h2>\n        {uiState === 'error' && <p>Failed to load history</p>}\n        {uiState === 'loading' && (\n          <p>\n            <Loader abrupt /> Loading&hellip;\n          </p>\n        )}\n      </header>\n      <main tabIndex=\"-1\">\n        {editHistory.length > 0 && (\n          <ol>\n            {editHistory.map((status) => {\n              const { createdAt } = status;\n              const createdAtDate = new Date(createdAt);\n              return (\n                <li key={createdAt} class=\"history-item\">\n                  <h3>\n                    <time>\n                      {niceDateTime(createdAtDate, {\n                        formatOpts: {\n                          weekday: 'short',\n                          second: 'numeric',\n                        },\n                      })}\n                    </time>\n                  </h3>\n                  <Status\n                    status={status}\n                    instance={instance}\n                    size=\"s\"\n                    withinContext\n                    readOnly\n                    previewMode\n                  />\n                </li>\n              );\n            })}\n          </ol>\n        )}\n      </main>\n    </div>\n  );\n}\n\nconst REACTIONS_LIMIT = 80;\nfunction ReactionsModal({ statusID, instance, onClose }) {\n  const { masto } = api({ instance });\n  const [uiState, setUIState] = useState('default');\n  const [accounts, setAccounts] = useState([]);\n  const [showMore, setShowMore] = useState(false);\n\n  const reblogIterator = useRef();\n  const favouriteIterator = useRef();\n\n  async function fetchAccounts(firstLoad) {\n    setShowMore(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        if (firstLoad) {\n          reblogIterator.current = masto.v1.statuses.listRebloggedBy(statusID, {\n            limit: REACTIONS_LIMIT,\n          });\n          favouriteIterator.current = masto.v1.statuses.listFavouritedBy(\n            statusID,\n            {\n              limit: REACTIONS_LIMIT,\n            },\n          );\n        }\n        const [{ value: reblogResults }, { value: favouriteResults }] =\n          await Promise.allSettled([\n            reblogIterator.current.next(),\n            favouriteIterator.current.next(),\n          ]);\n        if (reblogResults.value?.length || favouriteResults.value?.length) {\n          if (reblogResults.value?.length) {\n            for (const account of reblogResults.value) {\n              const theAccount = accounts.find((a) => a.id === account.id);\n              if (!theAccount) {\n                accounts.push({\n                  ...account,\n                  _types: ['reblog'],\n                });\n              } else {\n                theAccount._types.push('reblog');\n              }\n            }\n          }\n          if (favouriteResults.value?.length) {\n            for (const account of favouriteResults.value) {\n              const theAccount = accounts.find((a) => a.id === account.id);\n              if (!theAccount) {\n                accounts.push({\n                  ...account,\n                  _types: ['favourite'],\n                });\n              } else {\n                theAccount._types.push('favourite');\n              }\n            }\n          }\n          setAccounts(accounts);\n          setShowMore(!reblogResults.done || !favouriteResults.done);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }\n\n  useEffect(() => {\n    fetchAccounts(true);\n  }, []);\n\n  return (\n    <div id=\"reactions-container\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <h2>Boosted/Favourited by…</h2>\n      </header>\n      <main>\n        {accounts.length > 0 ? (\n          <>\n            <ul class=\"reactions-list\">\n              {accounts.map((account) => {\n                const { _types } = account;\n                return (\n                  <li key={account.id + _types}>\n                    <div class=\"reactions-block\">\n                      {_types.map((type) => (\n                        <Icon\n                          icon={\n                            {\n                              reblog: 'rocket',\n                              favourite: 'heart',\n                            }[type]\n                          }\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                    <AccountBlock account={account} instance={instance} />\n                  </li>\n                );\n              })}\n            </ul>\n            {uiState === 'default' ? (\n              showMore ? (\n                <InView\n                  onChange={(inView) => {\n                    if (inView) {\n                      fetchAccounts();\n                    }\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain block\"\n                    onClick={() => fetchAccounts()}\n                  >\n                    Show more&hellip;\n                  </button>\n                </InView>\n              ) : (\n                <p class=\"ui-state insignificant\">The end.</p>\n              )\n            ) : (\n              uiState === 'loading' && (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              )\n            )}\n          </>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">Unable to load accounts</p>\n        ) : (\n          <p class=\"ui-state insignificant\">No one yet.</p>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction StatusButton({\n  checked,\n  count,\n  class: className,\n  title,\n  alt,\n  icon,\n  onClick,\n  ...props\n}) {\n  if (typeof title === 'string') {\n    title = [title, title];\n  }\n  if (typeof alt === 'string') {\n    alt = [alt, alt];\n  }\n\n  const [buttonTitle, setButtonTitle] = useState(title[0] || '');\n  const [iconAlt, setIconAlt] = useState(alt[0] || '');\n\n  useEffect(() => {\n    if (checked) {\n      setButtonTitle(title[1] || '');\n      setIconAlt(alt[1] || '');\n    } else {\n      setButtonTitle(title[0] || '');\n      setIconAlt(alt[0] || '');\n    }\n  }, [checked, title, alt]);\n\n  return (\n    <button\n      type=\"button\"\n      title={buttonTitle}\n      class={`plain ${className} ${checked ? 'checked' : ''}`}\n      onClick={(e) => {\n        if (!onClick) return;\n        e.preventDefault();\n        e.stopPropagation();\n        onClick(e);\n      }}\n      {...props}\n    >\n      <Icon icon={icon} size=\"l\" alt={iconAlt} />\n      {!!count && (\n        <>\n          {' '}\n          <small title={count}>{shortenNumber(count)}</small>\n        </>\n      )}\n    </button>\n  );\n}\n\nexport function formatDuration(time) {\n  if (!time) return;\n  let hours = Math.floor(time / 3600);\n  let minutes = Math.floor((time % 3600) / 60);\n  let seconds = Math.round(time % 60);\n\n  if (hours === 0) {\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  } else {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds\n      .toString()\n      .padStart(2, '0')}`;\n  }\n}\n\nconst denylistDomains = /(twitter|github)\\.com/i;\nconst failedUnfurls = {};\n\nfunction _unfurlMastodonLink(instance, url) {\n  const snapStates = snapshot(states);\n  if (denylistDomains.test(url)) {\n    return;\n  }\n  if (failedUnfurls[url]) {\n    return;\n  }\n  const instanceRegex = new RegExp(instance + '/');\n  if (instanceRegex.test(snapStates.unfurledLinks[url]?.url)) {\n    return Promise.resolve(snapStates.unfurledLinks[url]);\n  }\n  console.debug('🦦 Unfurling URL', url);\n\n  let remoteInstanceFetch;\n  let theURL = url;\n  if (/\\/\\/elk\\.[^\\/]+\\/[^.]+\\.[^.]+/i.test(theURL)) {\n    // E.g. https://elk.zone/domain.com/@stest/123 -> https://domain.com/@stest/123\n    theURL = theURL.replace(/elk\\.[^\\/]+\\//i, '');\n  }\n  const urlObj = new URL(theURL);\n  const domain = urlObj.hostname;\n  const path = urlObj.pathname;\n  // Regex /:username/:id, where username = @username or @username@domain, id = number\n  const statusRegex = /\\/@([^@\\/]+)@?([^\\/]+)?\\/(\\d+)$/i;\n  const statusMatch = statusRegex.exec(path);\n  if (statusMatch) {\n    const id = statusMatch[3];\n    const { masto } = api({ instance: domain });\n    remoteInstanceFetch = masto.v1.statuses.fetch(id).then((status) => {\n      if (status?.id) {\n        return {\n          status,\n          instance: domain,\n        };\n      } else {\n        throw new Error('No results');\n      }\n    });\n  }\n\n  const { masto } = api({ instance });\n  const mastoSearchFetch = masto.v2\n    .search({\n      q: url,\n      type: 'statuses',\n      resolve: true,\n      limit: 1,\n    })\n    .then((results) => {\n      if (results.statuses.length > 0) {\n        const status = results.statuses[0];\n        return {\n          status,\n          instance,\n        };\n      } else {\n        throw new Error('No results');\n      }\n    });\n\n  function handleFulfill(result) {\n    const { status, instance } = result;\n    const { id } = status;\n    const selfURL = `/${instance}/s/${id}`;\n    console.debug('🦦 Unfurled URL', url, id, selfURL);\n    const data = {\n      id,\n      instance,\n      url: selfURL,\n    };\n    states.unfurledLinks[url] = data;\n    saveStatus(status, instance, {\n      skipThreading: true,\n    });\n    return data;\n  }\n  function handleCatch(e) {\n    failedUnfurls[url] = true;\n  }\n\n  if (remoteInstanceFetch) {\n    return Promise.any([remoteInstanceFetch, mastoSearchFetch])\n      .then(handleFulfill)\n      .catch(handleCatch);\n  } else {\n    return mastoSearchFetch.then(handleFulfill).catch(handleCatch);\n  }\n}\n\nfunction nicePostURL(url) {\n  if (!url) return;\n  const urlObj = new URL(url);\n  const { host, pathname } = urlObj;\n  const path = pathname.replace(/\\/$/, '');\n  // split only first slash\n  const [_, username, restPath] = path.match(/\\/(@[^\\/]+)\\/(.*)/) || [];\n  return (\n    <>\n      {host}\n      {username ? (\n        <>\n          /{username}\n          <wbr />\n          <span class=\"more-insignificant\">/{restPath}</span>\n        </>\n      ) : (\n        <span class=\"more-insignificant\">{path}</span>\n      )}\n    </>\n  );\n}\n\nconst unfurlMastodonLink = throttle(\n  mem(_unfurlMastodonLink, {\n    cacheKey: (instance, url) => `${instance}:${url}`,\n  }),\n);\n\nfunction FilteredStatus({ status, filterInfo, instance, containerProps = {} }) {\n  const {\n    account: { avatar, avatarStatic, bot, group },\n    createdAt,\n    visibility,\n    reblog,\n  } = status;\n  const isReblog = !!reblog;\n  const filterTitleStr = filterInfo?.titlesStr || '';\n  const createdAtDate = new Date(createdAt);\n  const statusPeekText = statusPeek(status.reblog || status);\n\n  const [showPeek, setShowPeek] = useState(false);\n  const bindLongPressPeek = useLongPress(\n    () => {\n      setShowPeek(true);\n    },\n    {\n      threshold: 600,\n      captureEvent: true,\n      detect: 'touch',\n      cancelOnMovement: 4, // true allows movement of up to 25 pixels\n    },\n  );\n\n  return (\n    <div\n      class={isReblog ? (group ? 'status-group' : 'status-reblog') : ''}\n      {...containerProps}\n      title={statusPeekText}\n      onContextMenu={(e) => {\n        e.preventDefault();\n        setShowPeek(true);\n      }}\n      {...bindLongPressPeek()}\n    >\n      <article class=\"status filtered\" tabindex=\"-1\">\n        <b\n          class=\"status-filtered-badge clickable badge-meta\"\n          title={filterTitleStr}\n          onClick={(e) => {\n            e.preventDefault();\n            setShowPeek(true);\n          }}\n        >\n          <span>Filtered</span>\n          <span>{filterTitleStr}</span>\n        </b>{' '}\n        <Avatar url={avatarStatic || avatar} squircle={bot} />\n        <span class=\"status-filtered-info\">\n          <span class=\"status-filtered-info-1\">\n            <NameText account={status.account} instance={instance} />{' '}\n            <Icon\n              icon={visibilityIconsMap[visibility]}\n              alt={visibilityText[visibility]}\n              size=\"s\"\n            />{' '}\n            {isReblog ? (\n              'boosted'\n            ) : (\n              <RelativeTime datetime={createdAtDate} format=\"micro\" />\n            )}\n          </span>\n          <span class=\"status-filtered-info-2\">\n            {isReblog && (\n              <>\n                <Avatar\n                  url={reblog.account.avatarStatic || reblog.account.avatar}\n                  squircle={bot}\n                />{' '}\n              </>\n            )}\n            {statusPeekText}\n          </span>\n        </span>\n      </article>\n      {!!showPeek && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowPeek(false);\n            }\n          }}\n        >\n          <div id=\"filtered-status-peek\" class=\"sheet\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowPeek(false)}\n            >\n              <Icon icon=\"x\" />\n            </button>\n            <header>\n              <b class=\"status-filtered-badge\">Filtered</b> {filterTitleStr}\n            </header>\n            <main tabIndex=\"-1\">\n              <Link\n                class=\"status-link\"\n                to={`/${instance}/s/${status.id}`}\n                onClick={() => {\n                  setShowPeek(false);\n                }}\n              >\n                <Status status={status} instance={instance} size=\"s\" readOnly />\n                <button type=\"button\" class=\"status-post-link plain3\">\n                  See post &raquo;\n                </button>\n              </Link>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst QuoteStatuses = memo(({ id, instance, level = 0 }) => {\n  if (!id || !instance) return;\n  const snapStates = useSnapshot(states);\n  const sKey = statusKey(id, instance);\n  const quotes = snapStates.statusQuotes[sKey];\n  const uniqueQuotes = quotes?.filter(\n    (q, i, arr) => arr.findIndex((q2) => q2.url === q.url) === i,\n  );\n\n  if (!uniqueQuotes?.length) return;\n  if (level > 2) return;\n\n  return uniqueQuotes.map((q) => {\n    return (\n      <Link\n        key={q.instance + q.id}\n        to={`${q.instance ? `/${q.instance}` : ''}/s/${q.id}`}\n        class=\"status-card-link\"\n      >\n        <Status\n          statusID={q.id}\n          instance={q.instance}\n          size=\"s\"\n          quoted={level + 1}\n        />\n      </Link>\n    );\n  });\n});\n\nexport default memo(Status);\n","import './compose.css';\n\nimport '@github/text-expander-element';\nimport equal from 'fast-deep-equal';\nimport { forwardRef } from 'preact/compat';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport stringLength from 'string-length';\nimport { uid } from 'uid/single';\nimport { useDebouncedCallback } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport supportedLanguages from '../data/status-supported-languages';\nimport urlRegex from '../data/url-regex';\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport emojifyText from '../utils/emojify-text';\nimport localeMatch from '../utils/locale-match';\nimport openCompose from '../utils/open-compose';\nimport states, { saveStatus } from '../utils/states';\nimport store from '../utils/store';\nimport {\n  getCurrentAccount,\n  getCurrentAccountNS,\n  getCurrentInstance,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport useInterval from '../utils/useInterval';\nimport visibilityIconsMap from '../utils/visibility-icons-map';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Loader from './loader';\nimport Modal from './modal';\nimport Status from './status';\n\nconst supportedLanguagesMap = supportedLanguages.reduce((acc, l) => {\n  const [code, common, native] = l;\n  acc[code] = {\n    common,\n    native,\n  };\n  return acc;\n}, {});\n\n/* NOTES:\n  - Max character limit includes BOTH status text and Content Warning text\n*/\n\nconst expiryOptions = {\n  '5 minutes': 5 * 60,\n  '30 minutes': 30 * 60,\n  '1 hour': 60 * 60,\n  '6 hours': 6 * 60 * 60,\n  '12 hours': 12 * 60 * 60,\n  '1 day': 24 * 60 * 60,\n  '3 days': 3 * 24 * 60 * 60,\n  '7 days': 7 * 24 * 60 * 60,\n};\nconst expirySeconds = Object.values(expiryOptions);\nconst oneDay = 24 * 60 * 60;\n\nconst expiresInFromExpiresAt = (expiresAt) => {\n  if (!expiresAt) return oneDay;\n  const delta = (new Date(expiresAt).getTime() - Date.now()) / 1000;\n  return expirySeconds.find((s) => s >= delta) || oneDay;\n};\n\nconst menu = document.createElement('ul');\nmenu.role = 'listbox';\nmenu.className = 'text-expander-menu';\n\n// Set IntersectionObserver on menu, reposition it because text-expander doesn't handle it\nconst windowMargin = 16;\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach((entry) => {\n    if (entry.isIntersecting) {\n      const { left, width } = entry.boundingClientRect;\n      const { innerWidth } = window;\n      if (left + width > innerWidth) {\n        menu.style.left = innerWidth - width - windowMargin + 'px';\n      }\n    }\n  });\n});\nobserver.observe(menu);\n\nconst DEFAULT_LANG = localeMatch(\n  [new Intl.DateTimeFormat().resolvedOptions().locale, ...navigator.languages],\n  supportedLanguages.map((l) => l[0]),\n  'en',\n);\n\n// https://github.com/mastodon/mastodon/blob/c4a429ed47e85a6bbf0d470a41cc2f64cf120c19/app/javascript/mastodon/features/compose/util/counter.js\nconst urlRegexObj = new RegExp(urlRegex.source, urlRegex.flags);\nconst usernameRegex = /(^|[^\\/\\w])@(([a-z0-9_]+)@[a-z0-9\\.\\-]+[a-z0-9]+)/gi;\nconst urlPlaceholder = '$2xxxxxxxxxxxxxxxxxxxxxxx';\nfunction countableText(inputText) {\n  return inputText\n    .replace(urlRegexObj, urlPlaceholder)\n    .replace(usernameRegex, '$1@$3');\n}\n\nfunction Compose({\n  onClose,\n  replyToStatus,\n  editStatus,\n  draftStatus,\n  standalone,\n  hasOpener,\n}) {\n  console.warn('RENDER COMPOSER');\n  const { masto, instance } = api();\n  const [uiState, setUIState] = useState('default');\n  const UID = useRef(draftStatus?.uid || uid());\n  console.log('Compose UID', UID.current);\n\n  const currentAccount = getCurrentAccount();\n  const currentAccountInfo = currentAccount.info;\n\n  const { configuration } = getCurrentInstance();\n  console.log('⚙️ Configuration', configuration);\n\n  const {\n    statuses: { maxCharacters, maxMediaAttachments, charactersReservedPerUrl },\n    mediaAttachments: {\n      supportedMimeTypes,\n      imageSizeLimit,\n      imageMatrixLimit,\n      videoSizeLimit,\n      videoMatrixLimit,\n      videoFrameRateLimit,\n    },\n    polls: { maxOptions, maxCharactersPerOption, maxExpiration, minExpiration },\n  } = configuration;\n\n  const textareaRef = useRef();\n  const spoilerTextRef = useRef();\n  const [visibility, setVisibility] = useState('public');\n  const [sensitive, setSensitive] = useState(false);\n  const [language, setLanguage] = useState(\n    store.session.get('currentLanguage') || DEFAULT_LANG,\n  );\n  const prevLanguage = useRef(language);\n  const [mediaAttachments, setMediaAttachments] = useState([]);\n  const [poll, setPoll] = useState(null);\n\n  const prefs = store.account.get('preferences') || {};\n\n  const oninputTextarea = () => {\n    if (!textareaRef.current) return;\n    textareaRef.current.dispatchEvent(new Event('input'));\n  };\n  const focusTextarea = () => {\n    setTimeout(() => {\n      console.debug('FOCUS textarea');\n      textareaRef.current?.focus();\n    }, 300);\n  };\n\n  useEffect(() => {\n    if (replyToStatus) {\n      const { spoilerText, visibility, language, sensitive } = replyToStatus;\n      if (spoilerText && spoilerTextRef.current) {\n        spoilerTextRef.current.value = spoilerText;\n      }\n      const mentions = new Set([\n        replyToStatus.account.acct,\n        ...replyToStatus.mentions.map((m) => m.acct),\n      ]);\n      const allMentions = [...mentions].filter(\n        (m) => m !== currentAccountInfo.acct,\n      );\n      if (allMentions.length > 0) {\n        textareaRef.current.value = `${allMentions\n          .map((m) => `@${m}`)\n          .join(' ')} `;\n        oninputTextarea();\n      }\n      focusTextarea();\n      setVisibility(\n        visibility === 'public' && prefs['posting:default:visibility']\n          ? prefs['posting:default:visibility']\n          : visibility,\n      );\n      setLanguage(language || prefs.postingDefaultLanguage || DEFAULT_LANG);\n      setSensitive(sensitive);\n    } else if (editStatus) {\n      const { visibility, language, sensitive, poll, mediaAttachments } =\n        editStatus;\n      const composablePoll = !!poll?.options && {\n        ...poll,\n        options: poll.options.map((o) => o?.title || o),\n        expiresIn: poll?.expiresIn || expiresInFromExpiresAt(poll.expiresAt),\n      };\n      setUIState('loading');\n      (async () => {\n        try {\n          const statusSource = await masto.v1.statuses.fetchSource(\n            editStatus.id,\n          );\n          console.log({ statusSource });\n          const { text, spoilerText } = statusSource;\n          textareaRef.current.value = text;\n          textareaRef.current.dataset.source = text;\n          oninputTextarea();\n          focusTextarea();\n          spoilerTextRef.current.value = spoilerText;\n          setVisibility(visibility);\n          setLanguage(language || presf.postingDefaultLanguage || DEFAULT_LANG);\n          setSensitive(sensitive);\n          setPoll(composablePoll);\n          setMediaAttachments(mediaAttachments);\n          setUIState('default');\n        } catch (e) {\n          console.error(e);\n          alert(e?.reason || e);\n          setUIState('error');\n        }\n      })();\n    } else {\n      focusTextarea();\n      console.log('Apply prefs', prefs);\n      if (prefs['posting:default:visibility']) {\n        setVisibility(prefs['posting:default:visibility']);\n      }\n      if (prefs['posting:default:language']) {\n        setLanguage(prefs['posting:default:language']);\n      }\n      if (prefs['posting:default:sensitive']) {\n        setSensitive(prefs['posting:default:sensitive']);\n      }\n    }\n    if (draftStatus) {\n      const {\n        status,\n        spoilerText,\n        visibility,\n        language,\n        sensitive,\n        poll,\n        mediaAttachments,\n      } = draftStatus;\n      const composablePoll = !!poll?.options && {\n        ...poll,\n        options: poll.options.map((o) => o?.title || o),\n        expiresIn: poll?.expiresIn || expiresInFromExpiresAt(poll.expiresAt),\n      };\n      textareaRef.current.value = status;\n      oninputTextarea();\n      focusTextarea();\n      if (spoilerText) spoilerTextRef.current.value = spoilerText;\n      if (visibility) setVisibility(visibility);\n      setLanguage(language || prefs.postingDefaultLanguage || DEFAULT_LANG);\n      if (sensitive !== null) setSensitive(sensitive);\n      if (composablePoll) setPoll(composablePoll);\n      if (mediaAttachments) setMediaAttachments(mediaAttachments);\n    }\n  }, [draftStatus, editStatus, replyToStatus]);\n\n  const formRef = useRef();\n\n  const beforeUnloadCopy = 'You have unsaved changes. Discard this post?';\n  const canClose = () => {\n    const { value, dataset } = textareaRef.current;\n\n    // check if loading\n    if (uiState === 'loading') {\n      console.log('canClose', { uiState });\n      return false;\n    }\n\n    // check for status and media attachments\n    const hasMediaAttachments = mediaAttachments.length > 0;\n    if (!value && !hasMediaAttachments) {\n      console.log('canClose', { value, mediaAttachments });\n      return true;\n    }\n\n    // check if all media attachments have IDs\n    const hasIDMediaAttachments =\n      mediaAttachments.length > 0 &&\n      mediaAttachments.every((media) => media.id);\n    if (hasIDMediaAttachments) {\n      console.log('canClose', { hasIDMediaAttachments });\n      return true;\n    }\n\n    // check if status contains only \"@acct\", if replying\n    const isSelf = replyToStatus?.account.id === currentAccountInfo.id;\n    const hasOnlyAcct =\n      replyToStatus && value.trim() === `@${replyToStatus.account.acct}`;\n    // TODO: check for mentions, or maybe just generic \"@username<space>\", including multiple mentions like \"@username1<space>@username2<space>\"\n    if (!isSelf && hasOnlyAcct) {\n      console.log('canClose', { isSelf, hasOnlyAcct });\n      return true;\n    }\n\n    // check if status is same with source\n    const sameWithSource = value === dataset?.source;\n    if (sameWithSource) {\n      console.log('canClose', { sameWithSource });\n      return true;\n    }\n\n    console.log('canClose', {\n      value,\n      hasMediaAttachments,\n      hasIDMediaAttachments,\n      poll,\n      isSelf,\n      hasOnlyAcct,\n      sameWithSource,\n      uiState,\n    });\n\n    return false;\n  };\n\n  const confirmClose = () => {\n    if (!canClose()) {\n      const yes = confirm(beforeUnloadCopy);\n      return yes;\n    }\n    return true;\n  };\n\n  useEffect(() => {\n    // Show warning if user tries to close window with unsaved changes\n    const handleBeforeUnload = (e) => {\n      if (!canClose()) {\n        e.preventDefault();\n        e.returnValue = beforeUnloadCopy;\n      }\n    };\n    window.addEventListener('beforeunload', handleBeforeUnload, {\n      capture: true,\n    });\n    return () =>\n      window.removeEventListener('beforeunload', handleBeforeUnload, {\n        capture: true,\n      });\n  }, []);\n\n  const getCharCount = () => {\n    const { value } = textareaRef.current;\n    const { value: spoilerText } = spoilerTextRef.current;\n    return stringLength(countableText(value)) + stringLength(spoilerText);\n  };\n  const updateCharCount = () => {\n    const count = getCharCount();\n    states.composerCharacterCount = count;\n  };\n  useEffect(updateCharCount, []);\n\n  const escDownRef = useRef(false);\n  useHotkeys(\n    'esc',\n    () => {\n      escDownRef.current = true;\n      // This won't be true if this event is already handled and not propagated 🤞\n    },\n    {\n      enableOnFormTags: true,\n    },\n  );\n  useHotkeys(\n    'esc',\n    () => {\n      if (!standalone && escDownRef.current && confirmClose()) {\n        onClose();\n      }\n      escDownRef.current = false;\n    },\n    {\n      enableOnFormTags: true,\n      // Use keyup because Esc keydown will close the confirm dialog on Safari\n      keyup: true,\n    },\n  );\n\n  const prevBackgroundDraft = useRef({});\n  const draftKey = () => {\n    const ns = getCurrentAccountNS();\n    return `${ns}#${UID.current}`;\n  };\n  const saveUnsavedDraft = () => {\n    // Not enabling this for editing status\n    // I don't think this warrant a draft mode for a status that's already posted\n    // Maybe it could be a big edit change but it should be rare\n    if (editStatus) return;\n    const key = draftKey();\n    const backgroundDraft = {\n      key,\n      replyTo: replyToStatus\n        ? {\n            /* Smaller payload of replyToStatus. Reasons:\n              - No point storing whole thing\n              - Could have media attachments\n              - Could be deleted/edited later\n            */\n            id: replyToStatus.id,\n            account: {\n              id: replyToStatus.account.id,\n              username: replyToStatus.account.username,\n              acct: replyToStatus.account.acct,\n            },\n          }\n        : null,\n      draftStatus: {\n        uid: UID.current,\n        status: textareaRef.current.value,\n        spoilerText: spoilerTextRef.current.value,\n        visibility,\n        language,\n        sensitive,\n        poll,\n        mediaAttachments,\n      },\n    };\n    if (!equal(backgroundDraft, prevBackgroundDraft.current) && !canClose()) {\n      console.debug('not equal', backgroundDraft, prevBackgroundDraft.current);\n      db.drafts\n        .set(key, {\n          ...backgroundDraft,\n          state: 'unsaved',\n          updatedAt: Date.now(),\n        })\n        .then(() => {\n          console.debug('DRAFT saved', key, backgroundDraft);\n        })\n        .catch((e) => {\n          console.error('DRAFT failed', key, e);\n        });\n      prevBackgroundDraft.current = structuredClone(backgroundDraft);\n    }\n  };\n  useInterval(saveUnsavedDraft, 5000); // background save every 5s\n  useEffect(() => {\n    saveUnsavedDraft();\n    // If unmounted, means user discarded the draft\n    // Also means pop-out 🙈, but it's okay because the pop-out will persist the ID and re-create the draft\n    return () => {\n      db.drafts.del(draftKey());\n    };\n  }, []);\n\n  useEffect(() => {\n    const handleItems = (e) => {\n      const { items } = e.clipboardData || e.dataTransfer;\n      const files = [];\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        if (item.kind === 'file') {\n          const file = item.getAsFile();\n          if (file && supportedMimeTypes.includes(file.type)) {\n            files.push(file);\n          }\n        }\n      }\n      if (files.length > 0 && mediaAttachments.length >= maxMediaAttachments) {\n        alert(`You can only attach up to ${maxMediaAttachments} files.`);\n        return;\n      }\n      console.log({ files });\n      if (files.length > 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        // Auto-cut-off files to avoid exceeding maxMediaAttachments\n        const max = maxMediaAttachments - mediaAttachments.length;\n        const allowedFiles = files.slice(0, max);\n        if (allowedFiles.length <= 0) {\n          alert(`You can only attach up to ${maxMediaAttachments} files.`);\n          return;\n        }\n        const mediaFiles = allowedFiles.map((file) => ({\n          file,\n          type: file.type,\n          size: file.size,\n          url: URL.createObjectURL(file),\n          id: null,\n          description: null,\n        }));\n        setMediaAttachments([...mediaAttachments, ...mediaFiles]);\n      }\n    };\n    window.addEventListener('paste', handleItems);\n    const handleDragover = (e) => {\n      // Prevent default if there's files\n      if (e.dataTransfer.items.length > 0) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n    window.addEventListener('dragover', handleDragover);\n    window.addEventListener('drop', handleItems);\n    return () => {\n      window.removeEventListener('paste', handleItems);\n      window.removeEventListener('dragover', handleDragover);\n      window.removeEventListener('drop', handleItems);\n    };\n  }, [mediaAttachments]);\n\n  const [showEmoji2Picker, setShowEmoji2Picker] = useState(false);\n\n  return (\n    <div id=\"compose-container-outer\">\n      <div id=\"compose-container\" class={standalone ? 'standalone' : ''}>\n        <div class=\"compose-top\">\n          {currentAccountInfo?.avatarStatic && (\n            <Avatar\n              url={currentAccountInfo.avatarStatic}\n              size=\"xl\"\n              alt={currentAccountInfo.username}\n              squircle={currentAccountInfo?.bot}\n            />\n          )}\n          {!standalone ? (\n            <span>\n              <button\n                type=\"button\"\n                class=\"light pop-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  // If there are non-ID media attachments (not yet uploaded), show confirmation dialog because they are not going to be passed to the new window\n                  // const containNonIDMediaAttachments =\n                  //   mediaAttachments.length > 0 &&\n                  //   mediaAttachments.some((media) => !media.id);\n                  // if (containNonIDMediaAttachments) {\n                  //   const yes = confirm(\n                  //     'You have media attachments that are not yet uploaded. Opening a new window will discard them and you will need to re-attach them. Are you sure you want to continue?',\n                  //   );\n                  //   if (!yes) {\n                  //     return;\n                  //   }\n                  // }\n\n                  // const mediaAttachmentsWithIDs = mediaAttachments.filter(\n                  //   (media) => media.id,\n                  // );\n\n                  const newWin = openCompose({\n                    editStatus,\n                    replyToStatus,\n                    draftStatus: {\n                      uid: UID.current,\n                      status: textareaRef.current.value,\n                      spoilerText: spoilerTextRef.current.value,\n                      visibility,\n                      language,\n                      sensitive,\n                      poll,\n                      mediaAttachments,\n                    },\n                  });\n\n                  if (!newWin) {\n                    alert('Looks like your browser is blocking popups.');\n                    return;\n                  }\n\n                  onClose();\n                }}\n              >\n                <Icon icon=\"popout\" alt=\"Pop out\" />\n              </button>{' '}\n              <button\n                type=\"button\"\n                class=\"light close-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  if (confirmClose()) {\n                    onClose();\n                  }\n                }}\n              >\n                <Icon icon=\"x\" />\n              </button>\n            </span>\n          ) : (\n            hasOpener && (\n              <button\n                type=\"button\"\n                class=\"light pop-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  // If there are non-ID media attachments (not yet uploaded), show confirmation dialog because they are not going to be passed to the new window\n                  // const containNonIDMediaAttachments =\n                  //   mediaAttachments.length > 0 &&\n                  //   mediaAttachments.some((media) => !media.id);\n                  // if (containNonIDMediaAttachments) {\n                  //   const yes = confirm(\n                  //     'You have media attachments that are not yet uploaded. Opening a new window will discard them and you will need to re-attach them. Are you sure you want to continue?',\n                  //   );\n                  //   if (!yes) {\n                  //     return;\n                  //   }\n                  // }\n\n                  if (!window.opener) {\n                    alert('Looks like you closed the parent window.');\n                    return;\n                  }\n\n                  if (window.opener.__STATES__.showCompose) {\n                    const yes = confirm(\n                      'Looks like you already have a compose field open in the parent window. Popping in this window will discard the changes you made in the parent window. Continue?',\n                    );\n                    if (!yes) return;\n                  }\n\n                  // const mediaAttachmentsWithIDs = mediaAttachments.filter(\n                  //   (media) => media.id,\n                  // );\n\n                  onClose({\n                    fn: () => {\n                      const passData = {\n                        editStatus,\n                        replyToStatus,\n                        draftStatus: {\n                          uid: UID.current,\n                          status: textareaRef.current.value,\n                          spoilerText: spoilerTextRef.current.value,\n                          visibility,\n                          language,\n                          sensitive,\n                          poll,\n                          mediaAttachments,\n                        },\n                      };\n                      window.opener.__COMPOSE__ = passData; // Pass it here instead of `showCompose` due to some weird proxy issue again\n                      window.opener.__STATES__.showCompose = true;\n                    },\n                  });\n                }}\n              >\n                <Icon icon=\"popin\" alt=\"Pop in\" />\n              </button>\n            )\n          )}\n        </div>\n        {!!replyToStatus && (\n          <div class=\"status-preview\">\n            <Status status={replyToStatus} size=\"s\" previewMode />\n            <div class=\"status-preview-legend reply-to\">\n              Replying to @\n              {replyToStatus.account.acct || replyToStatus.account.username}\n              &rsquo;s post\n            </div>\n          </div>\n        )}\n        {!!editStatus && (\n          <div class=\"status-preview\">\n            <Status status={editStatus} size=\"s\" previewMode />\n            <div class=\"status-preview-legend\">Editing source post</div>\n          </div>\n        )}\n        <form\n          ref={formRef}\n          class={`form-visibility-${visibility}`}\n          style={{\n            pointerEvents: uiState === 'loading' ? 'none' : 'auto',\n            opacity: uiState === 'loading' ? 0.5 : 1,\n          }}\n          onKeyDown={(e) => {\n            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n              formRef.current.dispatchEvent(\n                new Event('submit', { cancelable: true }),\n              );\n            }\n          }}\n          onSubmit={(e) => {\n            e.preventDefault();\n\n            const formData = new FormData(e.target);\n            const entries = Object.fromEntries(formData.entries());\n            console.log('ENTRIES', entries);\n            let { status, visibility, sensitive, spoilerText } = entries;\n\n            // Pre-cleanup\n            sensitive = sensitive === 'on'; // checkboxes return \"on\" if checked\n\n            // Validation\n            /* Let the backend validate this\n          if (stringLength(status) > maxCharacters) {\n            alert(`Status is too long! Max characters: ${maxCharacters}`);\n            return;\n          }\n          if (\n            sensitive &&\n            stringLength(status) + stringLength(spoilerText) > maxCharacters\n          ) {\n            alert(\n              `Status and content warning is too long! Max characters: ${maxCharacters}`,\n            );\n            return;\n          }\n          */\n            if (poll) {\n              if (poll.options.length < 2) {\n                alert('Poll must have at least 2 options');\n                return;\n              }\n              if (poll.options.some((option) => option === '')) {\n                alert('Some poll choices are empty');\n                return;\n              }\n            }\n            // TODO: check for URLs and use `charactersReservedPerUrl` to calculate max characters\n\n            if (mediaAttachments.length > 0) {\n              // If there are media attachments, check if they have no descriptions\n              const hasNoDescriptions = mediaAttachments.some(\n                (media) => !media.description?.trim?.(),\n              );\n              if (hasNoDescriptions) {\n                const yes = confirm(\n                  'Some media have no descriptions. Continue?',\n                );\n                if (!yes) return;\n              }\n            }\n\n            // Post-cleanup\n            spoilerText = (sensitive && spoilerText) || undefined;\n            status = status === '' ? undefined : status;\n\n            setUIState('loading');\n            (async () => {\n              try {\n                console.log('MEDIA ATTACHMENTS', mediaAttachments);\n                if (mediaAttachments.length > 0) {\n                  // Upload media attachments first\n                  const mediaPromises = mediaAttachments.map((attachment) => {\n                    const { file, description, id } = attachment;\n                    console.log('UPLOADING', attachment);\n                    if (id) {\n                      // If already uploaded\n                      return attachment;\n                    } else {\n                      const params = removeNullUndefined({\n                        file,\n                        description,\n                      });\n                      return masto.v2.mediaAttachments\n                        .create(params)\n                        .then((res) => {\n                          if (res.id) {\n                            attachment.id = res.id;\n                          }\n                          return res;\n                        });\n                    }\n                  });\n                  const results = await Promise.allSettled(mediaPromises);\n\n                  // If any failed, return\n                  if (\n                    results.some((result) => {\n                      return result.status === 'rejected' || !result.value?.id;\n                    })\n                  ) {\n                    setUIState('error');\n                    // Alert all the reasons\n                    results.forEach((result) => {\n                      if (result.status === 'rejected') {\n                        console.error(result);\n                        alert(result.reason || `Attachment #${i} failed`);\n                      }\n                    });\n                    return;\n                  }\n\n                  console.log({ results, mediaAttachments });\n                }\n\n                /* NOTE:\n                Using snakecase here because masto.js's `isObject` returns false for `params`, ONLY happens when opening in pop-out window. This is maybe due to `window.masto` variable being passed from the parent window. The check that failed is `x.constructor === Object`, so maybe the `Object` in new window is different than parent window's?\n                Code: https://github.com/neet/masto.js/blob/dd0d649067b6a2b6e60fbb0a96597c373a255b00/src/serializers/is-object.ts#L2\n              */\n                let params = {\n                  status,\n                  // spoilerText,\n                  spoiler_text: spoilerText,\n                  language,\n                  sensitive,\n                  poll,\n                  // mediaIds: mediaAttachments.map((attachment) => attachment.id),\n                  media_ids: mediaAttachments.map(\n                    (attachment) => attachment.id,\n                  ),\n                };\n                if (editStatus && supports('@mastodon/edit-media-attributes')) {\n                  params.media_attributes = mediaAttachments.map(\n                    (attachment) => {\n                      return {\n                        id: attachment.id,\n                        description: attachment.description,\n                        // focus\n                        // thumbnail\n                      };\n                    },\n                  );\n                } else if (!editStatus) {\n                  params.visibility = visibility;\n                  // params.inReplyToId = replyToStatus?.id || undefined;\n                  params.in_reply_to_id = replyToStatus?.id || undefined;\n                }\n                params = removeNullUndefined(params);\n                console.log('POST', params);\n\n                let newStatus;\n                if (editStatus) {\n                  newStatus = await masto.v1.statuses.update(\n                    editStatus.id,\n                    params,\n                  );\n                  saveStatus(newStatus, instance, {\n                    skipThreading: true,\n                  });\n                } else {\n                  try {\n                    newStatus = await masto.v1.statuses.create(params, {\n                      idempotencyKey: UID.current,\n                    });\n                  } catch (_) {\n                    // If idempotency key fails, try again without it\n                    newStatus = await masto.v1.statuses.create(params);\n                  }\n                }\n                setUIState('default');\n\n                // Close\n                onClose({\n                  newStatus,\n                  instance,\n                });\n              } catch (e) {\n                console.error(e);\n                alert(e?.reason || e);\n                setUIState('error');\n              }\n            })();\n          }}\n        >\n          <div class=\"toolbar stretch\">\n            <input\n              ref={spoilerTextRef}\n              type=\"text\"\n              name=\"spoilerText\"\n              placeholder=\"Content warning\"\n              disabled={uiState === 'loading'}\n              class=\"spoiler-text-field\"\n              lang={language}\n              spellCheck=\"true\"\n              dir=\"auto\"\n              style={{\n                opacity: sensitive ? 1 : 0,\n                pointerEvents: sensitive ? 'auto' : 'none',\n              }}\n              onInput={() => {\n                updateCharCount();\n              }}\n            />\n            <label\n              class={`toolbar-button ${sensitive ? 'highlight' : ''}`}\n              title=\"Content warning or sensitive media\"\n            >\n              <input\n                name=\"sensitive\"\n                type=\"checkbox\"\n                checked={sensitive}\n                disabled={uiState === 'loading'}\n                onChange={(e) => {\n                  const sensitive = e.target.checked;\n                  setSensitive(sensitive);\n                  if (sensitive) {\n                    spoilerTextRef.current?.focus();\n                  } else {\n                    textareaRef.current?.focus();\n                  }\n                }}\n              />\n              <Icon icon={`eye-${sensitive ? 'close' : 'open'}`} />\n            </label>{' '}\n            <label\n              class={`toolbar-button ${\n                visibility !== 'public' && !sensitive ? 'show-field' : ''\n              } ${visibility !== 'public' ? 'highlight' : ''}`}\n              title={`Visibility: ${visibility}`}\n            >\n              <Icon icon={visibilityIconsMap[visibility]} alt={visibility} />\n              <select\n                name=\"visibility\"\n                value={visibility}\n                onChange={(e) => {\n                  setVisibility(e.target.value);\n                }}\n                disabled={uiState === 'loading' || !!editStatus}\n              >\n                <option value=\"public\">\n                  Public <Icon icon=\"earth\" />\n                </option>\n                <option value=\"unlisted\">Unlisted</option>\n                <option value=\"private\">Followers only</option>\n                <option value=\"direct\">Private mention</option>\n              </select>\n            </label>{' '}\n          </div>\n          <Textarea\n            ref={textareaRef}\n            placeholder={\n              replyToStatus\n                ? 'Post your reply'\n                : editStatus\n                ? 'Edit your post'\n                : 'What are you doing?'\n            }\n            required={mediaAttachments?.length === 0}\n            disabled={uiState === 'loading'}\n            lang={language}\n            onInput={() => {\n              updateCharCount();\n            }}\n            maxCharacters={maxCharacters}\n            performSearch={(params) => {\n              return masto.v2.search(params);\n            }}\n          />\n          {mediaAttachments?.length > 0 && (\n            <div class=\"media-attachments\">\n              {mediaAttachments.map((attachment, i) => {\n                const { id, file } = attachment;\n                const fileID = file?.size + file?.type + file?.name;\n                return (\n                  <MediaAttachment\n                    key={id || fileID || i}\n                    attachment={attachment}\n                    disabled={uiState === 'loading'}\n                    lang={language}\n                    onDescriptionChange={(value) => {\n                      setMediaAttachments((attachments) => {\n                        const newAttachments = [...attachments];\n                        newAttachments[i].description = value;\n                        return newAttachments;\n                      });\n                    }}\n                    onRemove={() => {\n                      setMediaAttachments((attachments) => {\n                        return attachments.filter((_, j) => j !== i);\n                      });\n                    }}\n                  />\n                );\n              })}\n              <label class=\"media-sensitive\">\n                <input\n                  name=\"sensitive\"\n                  type=\"checkbox\"\n                  checked={sensitive}\n                  disabled={uiState === 'loading'}\n                  onChange={(e) => {\n                    const sensitive = e.target.checked;\n                    setSensitive(sensitive);\n                  }}\n                />{' '}\n                <span>Mark media as sensitive</span>{' '}\n                <Icon icon={`eye-${sensitive ? 'close' : 'open'}`} />\n              </label>\n            </div>\n          )}\n          {!!poll && (\n            <Poll\n              lang={language}\n              maxOptions={maxOptions}\n              maxExpiration={maxExpiration}\n              minExpiration={minExpiration}\n              maxCharactersPerOption={maxCharactersPerOption}\n              poll={poll}\n              disabled={uiState === 'loading'}\n              onInput={(poll) => {\n                if (poll) {\n                  const newPoll = { ...poll };\n                  setPoll(newPoll);\n                } else {\n                  setPoll(null);\n                }\n              }}\n            />\n          )}\n          <div\n            class=\"toolbar wrap\"\n            style={{\n              justifyContent: 'flex-end',\n            }}\n          >\n            <span>\n              <label class=\"toolbar-button\">\n                <input\n                  type=\"file\"\n                  accept={supportedMimeTypes.join(',')}\n                  multiple={mediaAttachments.length < maxMediaAttachments - 1}\n                  disabled={\n                    uiState === 'loading' ||\n                    mediaAttachments.length >= maxMediaAttachments ||\n                    !!poll\n                  }\n                  onChange={(e) => {\n                    const files = e.target.files;\n                    if (!files) return;\n\n                    const mediaFiles = Array.from(files).map((file) => ({\n                      file,\n                      type: file.type,\n                      size: file.size,\n                      url: URL.createObjectURL(file),\n                      id: null, // indicate uploaded state\n                      description: null,\n                    }));\n                    console.log('MEDIA ATTACHMENTS', files, mediaFiles);\n\n                    // Validate max media attachments\n                    if (\n                      mediaAttachments.length + mediaFiles.length >\n                      maxMediaAttachments\n                    ) {\n                      alert(\n                        `You can only attach up to ${maxMediaAttachments} files.`,\n                      );\n                    } else {\n                      setMediaAttachments((attachments) => {\n                        return attachments.concat(mediaFiles);\n                      });\n                    }\n                    // Reset\n                    e.target.value = '';\n                  }}\n                />\n                <Icon icon=\"attachment\" />\n              </label>{' '}\n              <button\n                type=\"button\"\n                class=\"toolbar-button\"\n                disabled={\n                  uiState === 'loading' || !!poll || !!mediaAttachments.length\n                }\n                onClick={() => {\n                  setPoll({\n                    options: ['', ''],\n                    expiresIn: 24 * 60 * 60, // 1 day\n                    multiple: false,\n                  });\n                }}\n              >\n                <Icon icon=\"poll\" alt=\"Add poll\" />\n              </button>{' '}\n              <button\n                type=\"button\"\n                class=\"toolbar-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  setShowEmoji2Picker(true);\n                }}\n              >\n                <Icon icon=\"emoji2\" />\n              </button>\n            </span>\n            <div class=\"spacer\" />\n            {uiState === 'loading' ? (\n              <Loader abrupt />\n            ) : (\n              <CharCountMeter\n                maxCharacters={maxCharacters}\n                hidden={uiState === 'loading'}\n              />\n            )}\n            <label\n              class={`toolbar-button ${\n                language !== prevLanguage.current ? 'highlight' : ''\n              }`}\n            >\n              <span class=\"icon-text\">\n                {supportedLanguagesMap[language]?.native}\n              </span>\n              <select\n                name=\"language\"\n                value={language}\n                onChange={(e) => {\n                  const { value } = e.target;\n                  setLanguage(value || DEFAULT_LANG);\n                  store.session.set('currentLanguage', value || DEFAULT_LANG);\n                }}\n                disabled={uiState === 'loading'}\n              >\n                {supportedLanguages\n                  .sort(([codeA, commonA], [codeB, commonB]) => {\n                    const { contentTranslationHideLanguages = [] } =\n                      states.settings;\n                    // Sort codes that same as language, prevLanguage, DEFAULT_LANGUAGE and all the ones in states.settings.contentTranslationHideLanguages, to the top\n                    if (\n                      codeA === language ||\n                      codeA === prevLanguage ||\n                      codeA === DEFAULT_LANG ||\n                      contentTranslationHideLanguages?.includes(codeA)\n                    )\n                      return -1;\n                    if (\n                      codeB === language ||\n                      codeB === prevLanguage ||\n                      codeB === DEFAULT_LANG ||\n                      contentTranslationHideLanguages?.includes(codeB)\n                    )\n                      return 1;\n                    return commonA.localeCompare(commonB);\n                  })\n                  .map(([code, common, native]) => (\n                    <option value={code}>\n                      {common} ({native})\n                    </option>\n                  ))}\n              </select>\n            </label>{' '}\n            <button\n              type=\"submit\"\n              class=\"large\"\n              disabled={uiState === 'loading'}\n            >\n              {replyToStatus ? 'Reply' : editStatus ? 'Update' : 'Post'}\n            </button>\n          </div>\n        </form>\n      </div>\n      {showEmoji2Picker && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowEmoji2Picker(false);\n            }\n          }}\n        >\n          <CustomEmojisModal\n            masto={masto}\n            instance={instance}\n            onClose={() => {\n              setShowEmoji2Picker(false);\n            }}\n            onSelect={(emoji) => {\n              const emojiWithSpace = ` ${emoji} `;\n              const textarea = textareaRef.current;\n              if (!textarea) return;\n              const { selectionStart, selectionEnd } = textarea;\n              const text = textarea.value;\n              const newText =\n                text.slice(0, selectionStart) +\n                emojiWithSpace +\n                text.slice(selectionEnd);\n              textarea.value = newText;\n              textarea.selectionStart = textarea.selectionEnd =\n                selectionEnd + emojiWithSpace.length;\n              textarea.focus();\n              textarea.dispatchEvent(new Event('input'));\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst Textarea = forwardRef((props, ref) => {\n  const { masto } = api();\n  const [text, setText] = useState(ref.current?.value || '');\n  const { maxCharacters, performSearch = () => {}, ...textareaProps } = props;\n  const snapStates = useSnapshot(states);\n  const charCount = snapStates.composerCharacterCount;\n\n  const customEmojis = useRef();\n  useEffect(() => {\n    (async () => {\n      try {\n        const emojis = await masto.v1.customEmojis.list();\n        console.log({ emojis });\n        customEmojis.current = emojis;\n      } catch (e) {\n        // silent fail\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  const textExpanderRef = useRef();\n  const textExpanderTextRef = useRef('');\n  useEffect(() => {\n    let handleChange, handleValue, handleCommited;\n    if (textExpanderRef.current) {\n      handleChange = (e) => {\n        // console.log('text-expander-change', e);\n        const { key, provide, text } = e.detail;\n        textExpanderTextRef.current = text;\n\n        if (text === '') {\n          provide(\n            Promise.resolve({\n              matched: false,\n            }),\n          );\n          return;\n        }\n\n        if (key === ':') {\n          // const emojis = customEmojis.current.filter((emoji) =>\n          //   emoji.shortcode.startsWith(text),\n          // );\n          const emojis = filterShortcodes(customEmojis.current, text);\n          let html = '';\n          emojis.forEach((emoji) => {\n            const { shortcode, url } = emoji;\n            html += `\n                <li role=\"option\" data-value=\"${encodeHTML(shortcode)}\">\n                <img src=\"${encodeHTML(\n                  url,\n                )}\" width=\"16\" height=\"16\" alt=\"\" loading=\"lazy\" /> \n                :${encodeHTML(shortcode)}:\n              </li>`;\n          });\n          // console.log({ emojis, html });\n          menu.innerHTML = html;\n          provide(\n            Promise.resolve({\n              matched: emojis.length > 0,\n              fragment: menu,\n            }),\n          );\n          return;\n        }\n\n        const type = {\n          '@': 'accounts',\n          '#': 'hashtags',\n        }[key];\n        provide(\n          new Promise((resolve) => {\n            const searchResults = performSearch({\n              type,\n              q: text,\n              limit: 5,\n            });\n            searchResults.then((value) => {\n              if (text !== textExpanderTextRef.current) {\n                return;\n              }\n              console.log({ value, type, v: value[type] });\n              const results = value[type];\n              console.log('RESULTS', value, results);\n              let html = '';\n              results.forEach((result) => {\n                const {\n                  name,\n                  avatarStatic,\n                  displayName,\n                  username,\n                  acct,\n                  emojis,\n                } = result;\n                const displayNameWithEmoji = emojifyText(displayName, emojis);\n                // const item = menuItem.cloneNode();\n                if (acct) {\n                  html += `\n                    <li role=\"option\" data-value=\"${encodeHTML(acct)}\">\n                      <span class=\"avatar\">\n                        <img src=\"${encodeHTML(\n                          avatarStatic,\n                        )}\" width=\"16\" height=\"16\" alt=\"\" loading=\"lazy\" />\n                      </span>\n                      <span>\n                        <b>${displayNameWithEmoji || username}</b>\n                        <br>@${encodeHTML(acct)}\n                      </span>\n                    </li>\n                  `;\n                } else {\n                  html += `\n                    <li role=\"option\" data-value=\"${encodeHTML(name)}\">\n                      <span>#<b>${encodeHTML(name)}</b></span>\n                    </li>\n                  `;\n                }\n                menu.innerHTML = html;\n              });\n              console.log('MENU', results, menu);\n              resolve({\n                matched: results.length > 0,\n                fragment: menu,\n              });\n            });\n          }),\n        );\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-change',\n        handleChange,\n      );\n\n      handleValue = (e) => {\n        const { key, item } = e.detail;\n        if (key === ':') {\n          e.detail.value = `:${item.dataset.value}:`;\n        } else {\n          e.detail.value = `${key}${item.dataset.value}`;\n        }\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-value',\n        handleValue,\n      );\n\n      handleCommited = (e) => {\n        const { input } = e.detail;\n        setText(input.value);\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-committed',\n        handleCommited,\n      );\n    }\n\n    return () => {\n      if (textExpanderRef.current) {\n        textExpanderRef.current.removeEventListener(\n          'text-expander-change',\n          handleChange,\n        );\n        textExpanderRef.current.removeEventListener(\n          'text-expander-value',\n          handleValue,\n        );\n        textExpanderRef.current.removeEventListener(\n          'text-expander-committed',\n          handleCommited,\n        );\n      }\n    };\n  }, []);\n\n  return (\n    <text-expander ref={textExpanderRef} keys=\"@ # :\">\n      <textarea\n        autoCapitalize=\"sentences\"\n        autoComplete=\"on\"\n        autoCorrect=\"on\"\n        spellCheck=\"true\"\n        dir=\"auto\"\n        rows=\"6\"\n        cols=\"50\"\n        {...textareaProps}\n        ref={ref}\n        name=\"status\"\n        value={text}\n        onInput={(e) => {\n          const { scrollHeight, offsetHeight, clientHeight, value } = e.target;\n          setText(value);\n          const offset = offsetHeight - clientHeight;\n          e.target.style.height = value ? scrollHeight + offset + 'px' : null;\n          props.onInput?.(e);\n        }}\n        style={{\n          width: '100%',\n          height: '4em',\n          '--text-weight': (1 + charCount / 140).toFixed(1) || 1,\n        }}\n      />\n    </text-expander>\n  );\n});\n\nfunction CharCountMeter({ maxCharacters = 500, hidden }) {\n  const snapStates = useSnapshot(states);\n  const charCount = snapStates.composerCharacterCount;\n  const leftChars = maxCharacters - charCount;\n  if (hidden) {\n    return <meter class=\"donut\" hidden />;\n  }\n  return (\n    <meter\n      class={`donut ${\n        leftChars <= -10\n          ? 'explode'\n          : leftChars <= 0\n          ? 'danger'\n          : leftChars <= 20\n          ? 'warning'\n          : ''\n      }`}\n      value={charCount}\n      max={maxCharacters}\n      data-left={leftChars}\n      title={`${leftChars}/${maxCharacters}`}\n      style={{\n        '--percentage': (charCount / maxCharacters) * 100,\n      }}\n    />\n  );\n}\n\nfunction MediaAttachment({\n  attachment,\n  disabled,\n  lang,\n  onDescriptionChange = () => {},\n  onRemove = () => {},\n}) {\n  const supportsEdit = supports('@mastodon/edit-media-attributes');\n  const { url, type, id } = attachment;\n  console.log({ attachment });\n  const [description, setDescription] = useState(attachment.description);\n  const suffixType = type.split('/')[0];\n  const debouncedOnDescriptionChange = useDebouncedCallback(\n    onDescriptionChange,\n    250,\n  );\n\n  const [showModal, setShowModal] = useState(false);\n  const textareaRef = useRef(null);\n  useEffect(() => {\n    let timer;\n    if (showModal && textareaRef.current) {\n      timer = setTimeout(() => {\n        textareaRef.current.focus();\n      }, 100);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [showModal]);\n\n  const descTextarea = (\n    <>\n      {!!id && !supportsEdit ? (\n        <div class=\"media-desc\">\n          <span class=\"tag\">Uploaded</span>\n          <p title={description}>\n            {attachment.description || <i>No description</i>}\n          </p>\n        </div>\n      ) : (\n        <textarea\n          ref={textareaRef}\n          value={description || ''}\n          lang={lang}\n          placeholder={\n            {\n              image: 'Image description',\n              video: 'Video description',\n              audio: 'Audio description',\n            }[suffixType]\n          }\n          autoCapitalize=\"sentences\"\n          autoComplete=\"on\"\n          autoCorrect=\"on\"\n          spellCheck=\"true\"\n          dir=\"auto\"\n          disabled={disabled}\n          maxlength=\"1500\" // Not unicode-aware :(\n          // TODO: Un-hard-code this maxlength, ref: https://github.com/mastodon/mastodon/blob/b59fb28e90bc21d6fd1a6bafd13cfbd81ab5be54/app/models/media_attachment.rb#L39\n          onInput={(e) => {\n            const { value } = e.target;\n            setDescription(value);\n            debouncedOnDescriptionChange(value);\n          }}\n        ></textarea>\n      )}\n    </>\n  );\n\n  return (\n    <>\n      <div class=\"media-attachment\">\n        <div\n          class=\"media-preview\"\n          onClick={() => {\n            setShowModal(true);\n          }}\n        >\n          {suffixType === 'image' ? (\n            <img src={url} alt=\"\" />\n          ) : suffixType === 'video' || suffixType === 'gifv' ? (\n            <video src={url} playsinline muted />\n          ) : suffixType === 'audio' ? (\n            <audio src={url} controls />\n          ) : null}\n        </div>\n        {descTextarea}\n        <div class=\"media-aside\">\n          <button\n            type=\"button\"\n            class=\"plain close-button\"\n            disabled={disabled}\n            onClick={onRemove}\n          >\n            <Icon icon=\"x\" />\n          </button>\n        </div>\n      </div>\n      {showModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowModal(false);\n            }\n          }}\n        >\n          <div id=\"media-sheet\" class=\"sheet sheet-max\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => {\n                setShowModal(false);\n              }}\n            >\n              <Icon icon=\"x\" />\n            </button>\n            <header>\n              <h2>\n                {\n                  {\n                    image: 'Edit image description',\n                    video: 'Edit video description',\n                    audio: 'Edit audio description',\n                  }[suffixType]\n                }\n              </h2>\n            </header>\n            <main tabIndex=\"-1\">\n              <div class=\"media-preview\">\n                {suffixType === 'image' ? (\n                  <img src={url} alt=\"\" />\n                ) : suffixType === 'video' || suffixType === 'gifv' ? (\n                  <video src={url} playsinline controls />\n                ) : suffixType === 'audio' ? (\n                  <audio src={url} controls />\n                ) : null}\n              </div>\n              {descTextarea}\n            </main>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction Poll({\n  lang,\n  poll,\n  disabled,\n  onInput = () => {},\n  maxOptions,\n  maxExpiration,\n  minExpiration,\n  maxCharactersPerOption,\n}) {\n  const { options, expiresIn, multiple } = poll;\n\n  return (\n    <div class={`poll ${multiple ? 'multiple' : ''}`}>\n      <div class=\"poll-choices\">\n        {options.map((option, i) => (\n          <div class=\"poll-choice\" key={i}>\n            <input\n              required\n              type=\"text\"\n              value={option}\n              disabled={disabled}\n              maxlength={maxCharactersPerOption}\n              placeholder={`Choice ${i + 1}`}\n              lang={lang}\n              spellCheck=\"true\"\n              dir=\"auto\"\n              onInput={(e) => {\n                const { value } = e.target;\n                options[i] = value;\n                onInput(poll);\n              }}\n            />\n            <button\n              type=\"button\"\n              class=\"plain2 poll-button\"\n              disabled={disabled || options.length <= 1}\n              onClick={() => {\n                options.splice(i, 1);\n                onInput(poll);\n              }}\n            >\n              <Icon icon=\"x\" size=\"s\" />\n            </button>\n          </div>\n        ))}\n      </div>\n      <div class=\"poll-toolbar\">\n        <button\n          type=\"button\"\n          class=\"plain2 poll-button\"\n          disabled={disabled || options.length >= maxOptions}\n          onClick={() => {\n            options.push('');\n            onInput(poll);\n          }}\n        >\n          +\n        </button>{' '}\n        <label class=\"multiple-choices\">\n          <input\n            type=\"checkbox\"\n            checked={multiple}\n            disabled={disabled}\n            onChange={(e) => {\n              const { checked } = e.target;\n              poll.multiple = checked;\n              onInput(poll);\n            }}\n          />{' '}\n          Multiple choices\n        </label>\n        <label class=\"expires-in\">\n          Duration{' '}\n          <select\n            value={expiresIn}\n            disabled={disabled}\n            onChange={(e) => {\n              const { value } = e.target;\n              poll.expiresIn = value;\n              onInput(poll);\n            }}\n          >\n            {Object.entries(expiryOptions)\n              .filter(([label, value]) => {\n                return value >= minExpiration && value <= maxExpiration;\n              })\n              .map(([label, value]) => (\n                <option value={value} key={value}>\n                  {label}\n                </option>\n              ))}\n          </select>\n        </label>\n      </div>\n      <div class=\"poll-toolbar\">\n        <button\n          type=\"button\"\n          class=\"plain remove-poll-button\"\n          disabled={disabled}\n          onClick={() => {\n            onInput(null);\n          }}\n        >\n          Remove poll\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction filterShortcodes(emojis, searchTerm) {\n  searchTerm = searchTerm.toLowerCase();\n\n  // Return an array of shortcodes that start with or contain the search term, sorted by relevance and limited to the first 5\n  return emojis\n    .sort((a, b) => {\n      let aLower = a.shortcode.toLowerCase();\n      let bLower = b.shortcode.toLowerCase();\n\n      let aStartsWith = aLower.startsWith(searchTerm);\n      let bStartsWith = bLower.startsWith(searchTerm);\n      let aContains = aLower.includes(searchTerm);\n      let bContains = bLower.includes(searchTerm);\n      let bothStartWith = aStartsWith && bStartsWith;\n      let bothContain = aContains && bContains;\n\n      return bothStartWith\n        ? a.length - b.length\n        : aStartsWith\n        ? -1\n        : bStartsWith\n        ? 1\n        : bothContain\n        ? a.length - b.length\n        : aContains\n        ? -1\n        : bContains\n        ? 1\n        : 0;\n    })\n    .slice(0, 5);\n}\n\nfunction encodeHTML(str) {\n  return str.replace(/[&<>\"']/g, function (char) {\n    return '&#' + char.charCodeAt(0) + ';';\n  });\n}\n\nfunction removeNullUndefined(obj) {\n  for (let key in obj) {\n    if (obj[key] === null || obj[key] === undefined) {\n      delete obj[key];\n    }\n  }\n  return obj;\n}\n\nfunction CustomEmojisModal({\n  masto,\n  instance,\n  onClose = () => {},\n  onSelect = () => {},\n}) {\n  const [uiState, setUIState] = useState('default');\n  const customEmojisList = useRef([]);\n  const [customEmojis, setCustomEmojis] = useState({});\n  const recentlyUsedCustomEmojis = useMemo(\n    () => store.account.get('recentlyUsedCustomEmojis') || [],\n  );\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const emojis = await masto.v1.customEmojis.list();\n        // Group emojis by category\n        const emojisCat = {\n          '--recent--': recentlyUsedCustomEmojis.filter((emoji) =>\n            emojis.find((e) => e.shortcode === emoji.shortcode),\n          ),\n        };\n        const othersCat = [];\n        emojis.forEach((emoji) => {\n          if (!emoji.visibleInPicker) return;\n          customEmojisList.current?.push?.(emoji);\n          if (!emoji.category) {\n            othersCat.push(emoji);\n            return;\n          }\n          if (!emojisCat[emoji.category]) {\n            emojisCat[emoji.category] = [];\n          }\n          emojisCat[emoji.category].push(emoji);\n        });\n        if (othersCat.length) {\n          emojisCat['--others--'] = othersCat;\n        }\n        setCustomEmojis(emojisCat);\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"custom-emojis-sheet\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <b>Custom emojis</b>{' '}\n        {uiState === 'loading' ? (\n          <Loader />\n        ) : (\n          <small class=\"insignificant\"> • {instance}</small>\n        )}\n      </header>\n      <main>\n        <div class=\"custom-emojis-list\">\n          {uiState === 'error' && (\n            <div class=\"ui-state\">\n              <p>Error loading custom emojis</p>\n            </div>\n          )}\n          {uiState === 'default' &&\n            Object.entries(customEmojis).map(\n              ([category, emojis]) =>\n                !!emojis?.length && (\n                  <>\n                    <div class=\"section-header\">\n                      {{\n                        '--recent--': 'Recently used',\n                        '--others--': 'Others',\n                      }[category] || category}\n                    </div>\n                    <section>\n                      {emojis.map((emoji) => (\n                        <button\n                          key={emoji}\n                          type=\"button\"\n                          class=\"plain4\"\n                          onClick={() => {\n                            onClose();\n                            requestAnimationFrame(() => {\n                              onSelect(`:${emoji.shortcode}:`);\n                            });\n                            let recentlyUsedCustomEmojis =\n                              store.account.get('recentlyUsedCustomEmojis') ||\n                              [];\n                            const recentlyUsedEmojiIndex =\n                              recentlyUsedCustomEmojis.findIndex(\n                                (e) => e.shortcode === emoji.shortcode,\n                              );\n                            if (recentlyUsedEmojiIndex !== -1) {\n                              // Move emoji to index 0\n                              recentlyUsedCustomEmojis.splice(\n                                recentlyUsedEmojiIndex,\n                                1,\n                              );\n                              recentlyUsedCustomEmojis.unshift(emoji);\n                            } else {\n                              recentlyUsedCustomEmojis.unshift(emoji);\n                              // Remove unavailable ones\n                              recentlyUsedCustomEmojis =\n                                recentlyUsedCustomEmojis.filter((e) =>\n                                  customEmojisList.current?.find?.(\n                                    (emoji) => emoji.shortcode === e.shortcode,\n                                  ),\n                                );\n                              // Limit to 10\n                              recentlyUsedCustomEmojis =\n                                recentlyUsedCustomEmojis.slice(0, 10);\n                            }\n\n                            // Store back\n                            store.account.set(\n                              'recentlyUsedCustomEmojis',\n                              recentlyUsedCustomEmojis,\n                            );\n                          }}\n                          title={`:${emoji.shortcode}:`}\n                        >\n                          <img\n                            src={emoji.url || emoji.staticUrl}\n                            alt={emoji.shortcode}\n                            width=\"16\"\n                            height=\"16\"\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                          />\n                        </button>\n                      ))}\n                    </section>\n                  </>\n                ),\n            )}\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default Compose;\n","import { useLayoutEffect } from 'preact/hooks';\nimport { matchPath } from 'react-router-dom';\nimport { subscribeKey } from 'valtio/utils';\n\nimport states from './states';\n\nconst { VITE_CLIENT_NAME: CLIENT_NAME } = import.meta.env;\n\nexport default function useTitle(title, path) {\n  function setTitle() {\n    const { currentLocation } = states;\n    const hasPaths = Array.isArray(path);\n    let paths = hasPaths ? path : [];\n    // Workaround for matchPath not working for optional path segments\n    // https://github.com/remix-run/react-router/discussions/9862\n    if (!hasPaths && /:?\\w+\\?/.test(path)) {\n      paths.push(path.replace(/(:\\w+)\\?/g, '$1'));\n      paths.push(path.replace(/\\/?:\\w+\\?/g, ''));\n    }\n    let matched = false;\n    if (paths.length) {\n      matched = paths.some((p) => matchPath(p, currentLocation));\n    } else if (path) {\n      matched = matchPath(path, currentLocation);\n    }\n    console.debug('setTitle', { title, path, currentLocation, paths, matched });\n    if (matched) {\n      document.title = title ? `${title} / ${CLIENT_NAME}` : CLIENT_NAME;\n    }\n  }\n\n  useLayoutEffect(() => {\n    setTitle();\n    return subscribeKey(states, 'currentLocation', setTitle);\n  }, [title, path]);\n}\n"],"file":"assets/useTitle-af4239f1.js"}